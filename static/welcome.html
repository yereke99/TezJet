<!DOCTYPE html>
<html lang="kz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <title>TezJet - Тез жеткізу қызметі</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      /* Uber-inspired minimal color palette */
      --bg-primary: #000000;
      --bg-secondary: #ffffff;
      --bg-card: #f8f9fa;
      --text-primary: #000000;
      --text-secondary: #666666;
      --text-muted: #999999;
      --text-white: #ffffff;
      --accent-primary: #000000;
      --accent-secondary: #007AFF;
      --border: #e5e5e5;
      --border-light: #f0f0f0;
      --shadow-subtle: 0 2px 8px rgba(0, 0, 0, 0.08);
      --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.12);
      --shadow-strong: 0 8px 32px rgba(0, 0, 0, 0.16);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      height: 100vh;
      height: 100dvh;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', 'Inter', sans-serif;
      background: var(--bg-secondary);
      color: var(--text-primary);
      position: fixed;
      width: 100%;
      top: 0;
      left: 0;
      
      /* TELEGRAM WEBAPP OPTIMIZATION */
      height: var(--tg-viewport-stable-height, 100vh);
      padding-top: max(15px, env(safe-area-inset-top, 15px));
      padding-bottom: max(20px, env(safe-area-inset-bottom, 20px));
      padding-left: max(20px, env(safe-area-inset-left, 20px));
      padding-right: max(20px, env(safe-area-inset-right, 20px));
    }

    /* Minimal background with subtle texture */
    .background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg-secondary);
      z-index: -2;
    }

    .background::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.02) 0%, transparent 50%);
      z-index: -1;
    }

    /* Loading overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 24px;
      z-index: 9999;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .loading-overlay.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .loading-spinner {
      width: 32px;
      height: 32px;
      border: 2px solid var(--border-light);
      border-top: 2px solid var(--accent-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .loading-text {
      font-size: 16px;
      font-weight: 500;
      color: var(--text-secondary);
      text-align: center;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* FIXED: Language switch - positioned lower on right to avoid Telegram system buttons */
    .lang-switch {
      position: absolute;
      top: max(70px, calc(env(safe-area-inset-top, 20px) + 50px));
      right: 20px;
      display: flex;
      background: var(--bg-card);
      border-radius: 24px;
      padding: 4px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-subtle);
      z-index: 1000;
    }

    .lang-btn {
      background: transparent;
      color: var(--text-secondary);
      border: none;
      border-radius: 20px;
      padding: 8px 16px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s ease;
      min-width: 48px;
    }

    .lang-btn.active {
      background: var(--accent-primary);
      color: var(--text-white);
      transform: scale(1.02);
    }

    .lang-btn:hover:not(.active) {
      color: var(--text-primary);
      background: var(--border-light);
    }

    /* FIXED: Main container with better layout for full screen */
    .main-container {
      height: calc(100vh - max(35px, env(safe-area-inset-top, 35px)) - max(20px, env(safe-area-inset-bottom, 20px)));
      height: calc(100dvh - max(35px, env(safe-area-inset-top, 35px)) - max(20px, env(safe-area-inset-bottom, 20px)));
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      margin: 0 auto;
      max-width: 400px;
      width: 100%;
      /* CRITICAL: Remove padding here since body has it */
      padding: 0;
    }

    /* FIXED: Header section with constrained growth */
    .header-section {
      /* REMOVED: flex: 1 - this was causing the expansion issue */
      flex-grow: 1;
      flex-shrink: 1;
      /* CRITICAL: Add max-height to prevent over-expansion */
      max-height: calc(100vh - 200px); /* Reserve 200px for buttons */
      max-height: calc(100dvh - 200px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 20px 0;
      position: relative;
      /* CRITICAL: Ensure minimum space for buttons */
      min-height: 200px;
    }

    /* Logo - minimal Uber style */
    .logo-container {
      position: relative;
      margin-bottom: 32px;
      flex-shrink: 0;
    }

    .logo {
      width: 72px;
      height: 72px;
      background: var(--accent-primary);
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      font-weight: 700;
      color: var(--text-white);
      margin: 0 auto;
      position: relative;
      box-shadow: var(--shadow-medium);
      animation: logoFloat 6s ease-in-out infinite;
    }

    @keyframes logoFloat {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-6px); }
    }

    /* Brand text - Uber typography with better spacing */
    .brand-text {
      margin-bottom: 20px;
      flex-shrink: 0;
    }

    .brand-name {
      font-size: 36px;
      font-weight: 800;
      color: var(--text-primary);
      letter-spacing: -1px;
      margin-bottom: 8px;
      text-transform: none;
      opacity: 0;
      animation: fadeInUp 0.6s ease-out 0.3s forwards;
    }

    .brand-slogan {
      font-size: 16px;
      font-weight: 500;
      color: var(--text-secondary);
      letter-spacing: 0px;
      opacity: 0;
      animation: fadeInUp 0.6s ease-out 0.5s forwards;
      margin-bottom: 6px;
    }

    .brand-description {
      font-size: 14px;
      color: var(--text-muted);
      max-width: 320px;
      line-height: 1.4;
      opacity: 0;
      animation: fadeInUp 0.6s ease-out 0.7s forwards;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* FIXED: Action buttons section with guaranteed space */
    .action-section {
      /* CRITICAL: Prevent shrinking and ensure visibility */
      flex-shrink: 0;
      flex-grow: 0;
      padding: 16px 0 0 0;
      width: 100%;
      /* CRITICAL: Reserve minimum space */
      min-height: 180px;
      /* CRITICAL: Ensure it's always at bottom */
      margin-top: auto;
    }

    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .action-btn {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 16px 18px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      overflow: hidden;
      text-decoration: none;
      color: inherit;
      box-shadow: var(--shadow-subtle);
      /* CRITICAL: Fixed height to prevent layout shifts */
      min-height: 70px;
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
      border-color: var(--text-muted);
    }

    .action-btn:active {
      transform: translateY(0);
      transition-duration: 0.1s;
    }

    .action-btn-content {
      display: flex;
      align-items: center;
      gap: 14px;
      flex: 1;
    }

    .action-btn-icon {
      width: 44px;
      height: 44px;
      background: var(--accent-primary);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: var(--text-white);
      flex-shrink: 0;
    }

    .action-btn-text {
      flex: 1;
      text-align: left;
    }

    .action-btn-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 3px;
      line-height: 1.2;
    }

    .action-btn-subtitle {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.3;
    }

    .action-btn-arrow {
      font-size: 16px;
      color: var(--text-muted);
      transition: transform 0.2s ease;
      flex-shrink: 0;
    }

    .action-btn:hover .action-btn-arrow {
      transform: translateX(4px);
      color: var(--text-secondary);
    }

    /* Primary button - Uber black style */
    .action-btn.primary {
      background: var(--accent-primary);
      border: 1px solid var(--accent-primary);
      box-shadow: var(--shadow-medium);
    }

    .action-btn.primary .action-btn-icon {
      background: rgba(255, 255, 255, 0.15);
    }

    .action-btn.primary .action-btn-title {
      color: var(--text-white);
    }

    .action-btn.primary .action-btn-subtitle {
      color: rgba(255, 255, 255, 0.8);
    }

    .action-btn.primary .action-btn-arrow {
      color: var(--text-white);
    }

    .action-btn.primary:hover {
      background: #1a1a1a;
      border-color: #1a1a1a;
    }

    /* Animations on load */
    .action-btn {
      opacity: 0;
      transform: translateY(20px);
      animation: slideInUp 0.4s ease-out forwards;
    }

    .action-btn:nth-child(1) {
      animation-delay: 0.9s;
    }

    .action-btn:nth-child(2) {
      animation-delay: 1.1s;
    }

    @keyframes slideInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Driver redirect message */
    .driver-redirect {
      background: var(--accent-primary);
      color: var(--text-white);
      padding: 16px;
      border-radius: var(--radius-md);
      text-align: center;
      margin-bottom: 12px;
      box-shadow: var(--shadow-medium);
      animation: fadeInUp 0.4s ease-out;
    }

    .driver-redirect h3 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .driver-redirect p {
      font-size: 13px;
      opacity: 0.9;
      line-height: 1.4;
    }

    /* CRITICAL: Enhanced responsive design for full screen */
    @media (max-width: 480px) {
      html, body {
        padding-left: max(16px, env(safe-area-inset-left, 16px));
        padding-right: max(16px, env(safe-area-inset-right, 16px));
      }

      .brand-name {
        font-size: 32px;
      }

      .brand-slogan {
        font-size: 15px;
      }

      .brand-description {
        font-size: 13px;
      }

      .logo {
        width: 68px;
        height: 68px;
        font-size: 26px;
      }

      .action-btn {
        padding: 15px 16px;
        min-height: 68px;
      }

      .action-btn-title {
        font-size: 15px;
      }

      .action-btn-subtitle {
        font-size: 12px;
      }

      .action-btn-icon {
        width: 42px;
        height: 42px;
        font-size: 17px;
      }
    }

    /* CRITICAL: Better height-based responsive design */
    @media (max-height: 700px) {
      .header-section {
        padding: 15px 0;
        max-height: calc(100vh - 160px);
        max-height: calc(100dvh - 160px);
        min-height: 150px;
      }

      .logo {
        width: 60px;
        height: 60px;
        font-size: 22px;
      }

      .logo-container {
        margin-bottom: 24px;
      }

      .brand-name {
        font-size: 28px;
        margin-bottom: 6px;
      }

      .brand-slogan {
        font-size: 14px;
      }

      .brand-text {
        margin-bottom: 16px;
      }

      .action-section {
        min-height: 150px;
      }

      .action-btn {
        min-height: 60px;
        padding: 12px 16px;
      }
    }

    /* CRITICAL: Very short screens (landscape phones) */
    @media (max-height: 500px) {
      .header-section {
        padding: 10px 0;
        max-height: calc(100vh - 140px);
        max-height: calc(100dvh - 140px);
        min-height: 120px;
      }

      .logo {
        width: 50px;
        height: 50px;
        font-size: 18px;
      }

      .logo-container {
        margin-bottom: 16px;
      }

      .brand-name {
        font-size: 24px;
        margin-bottom: 4px;
      }

      .brand-slogan {
        font-size: 13px;
      }

      .brand-description {
        font-size: 12px;
      }

      .brand-text {
        margin-bottom: 12px;
      }

      .action-section {
        min-height: 130px;
      }

      .action-btn {
        min-height: 55px;
        padding: 10px 14px;
      }

      .action-btn-title {
        font-size: 14px;
      }

      .action-btn-subtitle {
        font-size: 11px;
      }

      .action-btn-icon {
        width: 38px;
        height: 38px;
        font-size: 16px;
      }
    }

    /* CRITICAL: Ultra short screens */
    @media (max-height: 400px) {
      .main-container {
        justify-content: space-between;
      }

      .header-section {
        flex-grow: 0;
        padding: 5px 0;
        min-height: auto;
        max-height: none;
      }

      .logo-container {
        margin-bottom: 8px;
      }

      .brand-text {
        margin-bottom: 8px;
      }

      .action-section {
        min-height: 120px;
      }
    }

    /* Prevent text selection */
    .brand-name,
    .brand-slogan,
    .action-btn {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    /* Enhanced focus states for accessibility */
    .action-btn:focus,
    .lang-btn:focus {
      outline: 2px solid var(--accent-secondary);
      outline-offset: 2px;
    }

    /* Welcome sequence animation */
    .welcome-sequence {
      opacity: 0;
      animation: welcomeSequence 0.8s ease-out 0.1s forwards;
    }

    @keyframes welcomeSequence {
      0% {
        opacity: 0;
        transform: scale(0.98);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Smooth transitions for language changes */
    .brand-text,
    .action-buttons {
      transition: transform 0.15s ease;
    }

    /* Clean loading state */
    .loading-spinner {
      border-width: 2px;
    }

    /* Better button touch targets */
    .action-btn {
      min-height: 70px;
    }

    .lang-btn {
      min-height: 40px;
    }

    /* Improved contrast for better readability */
    .action-btn-subtitle {
      color: #666666;
    }

    .brand-description {
      color: #888888;
    }

    /* Refined shadows for depth */
    .action-btn.primary {
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    .action-btn.primary:hover {
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    /* CRITICAL: Force GPU acceleration for smooth animations */
    .main-container,
    .action-btn,
    .logo {
      transform: translateZ(0);
      -webkit-transform: translateZ(0);
      will-change: transform;
    }

    /* CRITICAL: Prevent overflow issues in full screen */
    body {
      overscroll-behavior: contain;
      -webkit-overflow-scrolling: touch;
    }

    /* CRITICAL: Ensure buttons are always visible */
    .action-section {
      position: relative;
      z-index: 10;
    }
  </style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text" data-kz="Жүктелуде..." data-ru="Загрузка...">Жүктелуде...</div>
  </div>

  <!-- Minimal Background -->
  <div class="background"></div>

  <!-- Language Switch -->
  <div class="lang-switch">
    <button class="lang-btn active" onclick="setLang('kz')" id="lang-kz">ҚАЗ</button>
    <button class="lang-btn" onclick="setLang('ru')" id="lang-ru">РУС</button>
  </div>

  <!-- Main Container -->
  <div class="main-container welcome-sequence">
    <!-- Header Section -->
    <div class="header-section">
      <div class="logo-container">
        <div class="logo">T</div>
      </div>
      
      <div class="brand-text">
        <h1 class="brand-name">TezJet</h1>
        <p class="brand-slogan" data-kz="Тез жеткізу қызметі" data-ru="Быстрая доставка">Тез жеткізу қызметі</p>
        <p class="brand-description" data-kz="Алматы қаласында сенімді және тез жеткізу" data-ru="Надежная и быстрая доставка по Алматы">Алматы қаласында сенімді және тез жеткізу</p>
      </div>
    </div>

    <!-- Action Section -->
    <div class="action-section">
      <div class="action-buttons">
        <!-- Driver Redirect Message (hidden by default) -->
        <div class="driver-redirect" id="driverRedirectMessage" style="display: none;">
          <h3 data-kz="Қош келдіңіз!" data-ru="Добро пожаловать!">Қош келдіңіз!</h3>
          <p data-kz="Жүргізуші ретінде тапсырыстар тізіміне бағыттаймыз..." data-ru="Перенаправляем в список заказов как водителя...">Жүргізуші ретінде тапсырыстар тізіміне бағыттаймыз...</p>
        </div>

        <!-- Delivery Button -->
        <a href="/delivery" class="action-btn primary" id="deliveryBtn">
          <div class="action-btn-content">
            <div class="action-btn-icon">📦</div>
            <div class="action-btn-text">
              <div class="action-btn-title" data-kz="Жеткізу тапсырысы" data-ru="Заказать доставку">Жеткізу тапсырысы</div>
              <div class="action-btn-subtitle" data-kz="Жүкті тез әрі қауіпсіз жеткіземіз" data-ru="Быстро и безопасно доставим ваш груз">Жүкті тез әрі қауіпсіз жеткіземіз</div>
            </div>
          </div>
          <div class="action-btn-arrow">→</div>
        </a>

        <!-- Driver Button -->
        <a href="/register" class="action-btn" id="driverBtn">
          <div class="action-btn-content">
            <div class="action-btn-icon">🚗</div>
            <div class="action-btn-text">
              <div class="action-btn-title" data-kz="Жүргізуші болу" data-ru="Стать водителем">Жүргізуші болу</div>
              <div class="action-btn-subtitle" data-kz="Бізге қосылып табыс табыңыз" data-ru="Присоединяйтесь и зарабатывайте с нами">Бізге қосылып табыс табыңыз</div>
            </div>
          </div>
          <div class="action-btn-arrow">→</div>
        </a>
      </div>
    </div>
  </div>

  <script>
    // Global variables - Kazakh as default
    let currentLang = 'kz'; // DEFAULT TO KAZAKH
    let isChecking = false;
    let isRedirecting = false;

    // Translations
    const translations = {
      kz: {
        loading: 'Жүктелуде...',
        checkingUser: 'Пайдаланушыны тексеру...',
        redirecting: 'Бағыттау...',
        redirectingDriver: 'Жүргізуші ретінде тапсырыстарға бағыттау...',
        error: 'Қате пайда болды',
        brandSlogan: 'Тез жеткізу қызметі',
        brandDescription: 'Алматы қаласында сенімді және тез жеткізу',
        deliveryTitle: 'Жеткізу тапсырысы',
        deliverySubtitle: 'Жүкті тез әрі қауіпсіз жеткіземіз',
        driverTitle: 'Жүргізуші болу',
        driverSubtitle: 'Бізге қосылып табыс табыңыз',
        welcomeBack: 'Қош келдіңіз!',
        redirectingToOrders: 'Тапсырыстарға бағыттау...'
      },
      ru: {
        loading: 'Загрузка...',
        checkingUser: 'Проверка пользователя...',
        redirecting: 'Перенаправление...',
        redirectingDriver: 'Перенаправление к заказам как водителя...',
        error: 'Произошла ошибка',
        brandSlogan: 'Быстрая доставка',
        brandDescription: 'Надежная и быстрая доставка по Алматы',
        deliveryTitle: 'Заказать доставку',
        deliverySubtitle: 'Быстро и безопасно доставим ваш груз',
        driverTitle: 'Стать водителем',
        driverSubtitle: 'Присоединяйтесь и зарабатывайте с нами',
        welcomeBack: 'Добро пожаловать!',
        redirectingToOrders: 'Перенаправление к заказам...'
      }
    };

    // ENHANCED: Dynamic viewport height management for full screen
    function updateViewportHeight() {
      console.log('📱 Updating viewport height for full screen optimization');
      
      let vh = window.innerHeight;
      let vw = window.innerWidth;
      
      // Use Telegram WebApp viewport if available
      if (window.Telegram && Telegram.WebApp) {
        vh = Telegram.WebApp.viewportHeight || vh;
        const stableHeight = Telegram.WebApp.viewportStableHeight || vh;
        
        console.log(`📐 Telegram viewport - Height: ${vh}px, Stable: ${stableHeight}px`);
        
        // Set CSS custom properties for Telegram
        document.documentElement.style.setProperty('--tg-viewport-height', `${vh}px`);
        document.documentElement.style.setProperty('--tg-viewport-stable-height', `${stableHeight}px`);
      }
      
      // Set universal viewport custom properties
      document.documentElement.style.setProperty('--actual-vh', `${vh}px`);
      document.documentElement.style.setProperty('--actual-vw', `${vw}px`);
      
      // Ensure body height matches viewport
      document.body.style.height = `${vh}px`;
      document.documentElement.style.height = `${vh}px`;
      
      console.log(`📐 Updated viewport - Width: ${vw}px, Height: ${vh}px`);
    }

    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🚀 TezJet Uber-Style Welcome Page loaded - FULL SCREEN OPTIMIZED');
      
      // CRITICAL: Update viewport first for full screen
      updateViewportHeight();
      
      initializeTelegram();
      setupEventListeners();
      
      // Ensure Kazakh is active by default
      setLang('kz');
      
      // Start user check after UI is ready
      setTimeout(() => {
        checkUserTypeAndRedirect();
      }, 800);
    });

    // ENHANCED: Initialize Telegram WebApp with full screen handling
    function initializeTelegram() {
      if (window.Telegram && Telegram.WebApp) {
        console.log('📱 Initializing Telegram WebApp for full screen');
        
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        Telegram.WebApp.disableVerticalSwipes();

        // Handle theme (adjust for Uber-style)
        const theme = Telegram.WebApp.colorScheme;
        console.log('🎨 Telegram theme:', theme);

        // CRITICAL: Handle viewport changes for full screen
        Telegram.WebApp.onEvent('viewportChanged', () => {
          console.log('📱 Telegram viewport changed - updating...');
          updateViewportHeight();
        });

        console.log('✅ Telegram WebApp initialized with full screen support');
      } else {
        console.log('⚠️ Telegram WebApp not available - running in browser mode');
      }
    }

    // Setup event listeners
    function setupEventListeners() {
      // ENHANCED: Handle window resize for full screen
      window.addEventListener('resize', () => {
        console.log('📐 Window resized - updating layout');
        updateViewportHeight();
      });

      window.addEventListener('orientationchange', () => {
        console.log('📱 Orientation changed - updating layout');
        setTimeout(() => {
          updateViewportHeight();
        }, 100);
      });

      // ENHANCED: Handle fullscreen changes
      document.addEventListener('fullscreenchange', () => {
        console.log('🖥️ Fullscreen state changed');
        setTimeout(() => {
          updateViewportHeight();
        }, 100);
      });

      // Prevent double-clicks during checking
      document.getElementById('deliveryBtn').addEventListener('click', function(e) {
        if (isChecking || isRedirecting) {
          e.preventDefault();
          console.log('🛑 Click prevented - checking/redirecting in progress');
          return false;
        }
      });

      document.getElementById('driverBtn').addEventListener('click', function(e) {
        if (isChecking || isRedirecting) {
          e.preventDefault();
          console.log('🛑 Click prevented - checking/redirecting in progress');
          return false;
        }
      });
    }

    // Enhanced user checking with proper redirect logic
    async function checkUserTypeAndRedirect() {
      const telegramId = getTelegramId();
      
      if (!telegramId) {
        console.log('⚠️ No Telegram ID available, showing welcome page');
        hideLoading();
        return;
      }

      try {
        isChecking = true;
        isRedirecting = false;
        updateLoadingText('checkingUser');
        
        console.log('🔍 Checking user type for Telegram ID:', telegramId);

        const response = await fetch('/api/check/who', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            telegram_id: parseInt(telegramId)
          })
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const result = await response.json();
        console.log('📊 API Response:', result);

        // Proper driver detection and redirect
        if (result.success && result.data) {
          const userData = result.data;
          
          // Check if user exists and is a driver
          if (userData.exists === true && userData.user_type === 'driver') {
            console.log('🚗 DRIVER DETECTED! Redirecting to delivery list...');
            console.log('👤 Driver data:', userData.driver_data);
            
            // Show driver redirect message
            showDriverRedirectMessage();
            
            // Set redirecting state
            isRedirecting = true;
            updateLoadingText('redirectingDriver');
            
            // Use Telegram haptic feedback if available
            if (window.Telegram && Telegram.WebApp && Telegram.WebApp.HapticFeedback) {
              Telegram.WebApp.HapticFeedback.notificationOccurred('success');
            }
            
            // Force redirect after 2 seconds
            setTimeout(() => {
              console.log('🔄 FORCED REDIRECT to /delivery-list');
              window.location.replace('/delivery-list');
            }, 2000);
            
            return;
          }
          
          // Check if user exists as client
          if (userData.exists === true && userData.user_type === 'client') {
            console.log('👤 Existing client detected, showing welcome page');
          } else {
            console.log('👤 New user detected, showing welcome page');
          }
        } else {
          console.log('👤 No user data or unsuccessful response, showing welcome page');
        }

        // If we reach here, show welcome page
        hideLoading();
        
      } catch (error) {
        console.error('❌ Error checking user type:', error);
        
        // Show error briefly, then show welcome page
        updateLoadingText('error');
        setTimeout(() => {
          console.log('🔄 Showing welcome page after error');
          hideLoading();
        }, 2000);
      } finally {
        isChecking = false;
      }
    }

    // Show driver redirect message
    function showDriverRedirectMessage() {
      const message = document.getElementById('driverRedirectMessage');
      if (message) {
        message.style.display = 'block';
        console.log('📢 Driver redirect message shown');
      }
    }

    // Get Telegram ID with enhanced logging
    function getTelegramId() {
      // Try to get from Telegram WebApp
      if (window.Telegram && Telegram.WebApp) {
        console.log('📱 Telegram WebApp available');
        
        if (Telegram.WebApp.initDataUnsafe?.user) {
          const id = Telegram.WebApp.initDataUnsafe.user.id;
          console.log('✅ Got Telegram ID from WebApp:', id);
          return id;
        } else {
          console.log('⚠️ No user data in initDataUnsafe');
        }
      } else {
        console.log('⚠️ Telegram WebApp not available');
      }
      
      // For testing outside Telegram
      const urlParams = new URLSearchParams(window.location.search);
      const testId = urlParams.get('test_id');
      if (testId) {
        console.log('🧪 Using test Telegram ID:', testId);
        return testId;
      }
      
      console.log('❌ No Telegram ID available from any source');
      return null;
    }

    // Update loading text
    function updateLoadingText(key) {
      const loadingText = document.querySelector('.loading-text');
      if (loadingText && translations[currentLang][key]) {
        loadingText.textContent = translations[currentLang][key];
      }
    }

    // Hide loading overlay
    function hideLoading() {
      const overlay = document.getElementById('loadingOverlay');
      overlay.classList.add('hidden');
      
      // Start welcome animations
      setTimeout(() => {
        document.querySelector('.main-container').style.opacity = '1';
      }, 200);
    }

    // Language switching with Kazakh as default
    function setLang(lang) {
      if (isChecking || isRedirecting) {
        console.log('🛑 Language change prevented - checking/redirecting in progress');
        return;
      }

      currentLang = lang;
      console.log('🌐 Language changed to:', lang);
      
      // Update active language button
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById('lang-' + lang).classList.add('active');
      
      // Update all translatable elements
      document.querySelectorAll('[data-kz]').forEach(el => {
        const text = el.getAttribute('data-' + lang);
        if (text) {
          el.textContent = text;
        }
      });

      // Smooth transition animation
      document.querySelector('.brand-text').style.transform = 'scale(0.99)';
      document.querySelector('.action-buttons').style.transform = 'scale(0.99)';
      
      setTimeout(() => {
        document.querySelector('.brand-text').style.transform = 'scale(1)';
        document.querySelector('.action-buttons').style.transform = 'scale(1)';
      }, 100);
    }

    // Navigation with transition
    function navigateWithTransition(url) {
      if (isChecking || isRedirecting) {
        console.log('🛑 Navigation prevented - checking/redirecting in progress');
        return false;
      }

      console.log('🔄 Navigating to:', url);
      
      // Add loading state
      isRedirecting = true;
      updateLoadingText('redirecting');
      document.getElementById('loadingOverlay').classList.remove('hidden');
      
      // Navigate after brief delay
      setTimeout(() => {
        window.location.href = url;
      }, 200);
      
      return true;
    }

    // Update action buttons with transition navigation
    document.addEventListener('DOMContentLoaded', function() {
      const deliveryBtn = document.getElementById('deliveryBtn');
      const driverBtn = document.getElementById('driverBtn');
      
      if (deliveryBtn) {
        deliveryBtn.addEventListener('click', function(e) {
          e.preventDefault();
          navigateWithTransition('/delivery');
        });
      }
      
      if (driverBtn) {
        driverBtn.addEventListener('click', function(e) {
          e.preventDefault();
          navigateWithTransition('/register');
        });
      }
    });

    // Debug function
    async function debugCheckWho() {
      const telegramId = getTelegramId();
      
      if (!telegramId) {
        console.log('❌ No Telegram ID for testing');
        return;
      }

      try {
        console.log('🧪 Testing /api/check/who endpoint...');
        
        const response = await fetch('/api/check/who', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            telegram_id: parseInt(telegramId)
          })
        });

        console.log('📡 Response status:', response.status);
        const result = await response.json();
        console.log('📊 Raw response:', result);

      } catch (error) {
        console.error('❌ Debug test failed:', error);
      }
    }

    // Force redirect for testing
    function forceRedirectToDeliveryList() {
      console.log('🔧 FORCE REDIRECT - Testing redirect to delivery list');
      isRedirecting = true;
      showDriverRedirectMessage();
      updateLoadingText('redirectingDriver');
      document.getElementById('loadingOverlay').classList.remove('hidden');
      
      setTimeout(() => {
        console.log('🔄 EXECUTING FORCE REDIRECT');
        window.location.replace('/delivery-list');
      }, 2000);
    }

    // ENHANCED: Debug layout info
    function debugLayout() {
      console.log('=== LAYOUT DEBUG INFO ===');
      console.log('Window size:', window.innerWidth + 'x' + window.innerHeight);
      console.log('Screen size:', screen.width + 'x' + screen.height);
      console.log('Viewport units:', document.documentElement.style.getPropertyValue('--actual-vh'));
      
      const container = document.querySelector('.main-container');
      const header = document.querySelector('.header-section');
      const actions = document.querySelector('.action-section');
      
      if (container) {
        const rect = container.getBoundingClientRect();
        console.log('Container:', rect.width + 'x' + rect.height);
      }
      
      if (header) {
        const rect = header.getBoundingClientRect();
        console.log('Header:', rect.width + 'x' + rect.height);
      }
      
      if (actions) {
        const rect = actions.getBoundingClientRect();
        console.log('Actions:', rect.width + 'x' + rect.height, 'top:', rect.top);
      }
      
      console.log('Actions visible:', actions && actions.getBoundingClientRect().bottom <= window.innerHeight);
      console.log('========================');
    }

    // Make functions globally available
    window.setLang = setLang;
    window.debugCheckWho = debugCheckWho;
    window.forceRedirectToDeliveryList = forceRedirectToDeliveryList;
    window.debugLayout = debugLayout;
    window.updateViewportHeight = updateViewportHeight;

    // Performance monitoring
    window.addEventListener('load', function() {
      console.log('⚡ Uber-Style TezJet page fully loaded - FULL SCREEN READY');
      // Final layout update after everything is loaded
      setTimeout(() => {
        updateViewportHeight();
        debugLayout();
      }, 100);
    });

    // Handle page visibility changes
    document.addEventListener('visibilitychange', function() {
      if (document.hidden) {
        console.log('👁️ Page hidden');
      } else {
        console.log('👁️ Page visible');
        // Update layout when page becomes visible
        setTimeout(updateViewportHeight, 100);
      }
    });

    // Keyboard navigation support
    document.addEventListener('keydown', function(e) {
      if (isChecking || isRedirecting) return;
      
      switch(e.key) {
        case '1':
          navigateWithTransition('/delivery');
          break;
        case '2':
          navigateWithTransition('/register');
          break;
        case 'd':
          debugCheckWho();
          break;
        case 'f':
          forceRedirectToDeliveryList();
          break;
        case 'l':
          debugLayout();
          break;
        case 'v':
          updateViewportHeight();
          break;
        case 'Escape':
          if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.close();
          }
          break;
      }
    });

    // Error handling for network issues
    window.addEventListener('online', function() {
      console.log('🌐 Connection restored');
      if (!isChecking && !isRedirecting) {
        checkUserTypeAndRedirect();
      }
    });

    window.addEventListener('offline', function() {
      console.log('📵 Connection lost');
      updateLoadingText('error');
    });

    // Prevent context menu
    document.addEventListener('contextmenu', function(e) {
      e.preventDefault();
    });

    // Add haptic feedback for Telegram
    function addHapticFeedback() {
      if (window.Telegram && Telegram.WebApp && Telegram.WebApp.HapticFeedback) {
        Telegram.WebApp.HapticFeedback.impactOccurred('light');
      }
    }

    // Add haptic feedback to buttons
    document.querySelectorAll('.action-btn, .lang-btn').forEach(btn => {
      btn.addEventListener('click', addHapticFeedback);
    });

    console.log('🎉 Uber-Style TezJet Welcome Page initialized successfully - FULL SCREEN OPTIMIZED');
    console.log('🗣️ Default language: Kazakh (ҚАЗ)');
    console.log('🔧 Debug commands: debugCheckWho(), forceRedirectToDeliveryList(), debugLayout(), updateViewportHeight()');
    console.log('⌨️ Keyboard shortcuts: 1=delivery, 2=driver, d=debug, f=force, l=layout, v=viewport');
  </script>
</body>
</html>