<!DOCTYPE html>
<html lang="kz">
<head>
  <meta charset="UTF-8">
  <title>Alash-Go ”ò–∫—ñ–º—à—ñ –ü–∞–Ω–µ–ª—ñ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script defer src="https://api-maps.yandex.ru/v3/?apikey=8a3e4da0-9ef2-4176-9203-e7014c1dba6f&lang=ru_RU"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    /* ==================== LIGHT THEME (Uber-style) ==================== */
    :root {
      --primary: #020617;
      --primary-dark: #000000;
      --primary-light: #111827;
      --primary-ultra-light: #e5e7eb;
      
      --bg-main: #f3f4f6;
      --bg-secondary: #ffffff;
      --bg-tertiary: #e5e7eb;
      --bg-card: #ffffff;
      
      --text-primary: #020617;
      --text-secondary: #4b5563;
      --text-muted: #9ca3af;
      
      --border: #e5e7eb;
      --border-light: #f3f4f6;
      
      --danger: #ef4444;
      --warning: #f59e0b;
      --success: #22c55e;
      --info: #3b82f6;
      
      --shadow-sm: 0 1px 2px 0 rgb(15 23 42 / 0.04);
      --shadow-md: 0 4px 8px -2px rgb(15 23 42 / 0.08);
      --shadow-lg: 0 12px 20px -4px rgb(15 23 42 / 0.12);
      --shadow-xl: 0 20px 30px -6px rgb(15 23 42 / 0.18);
      --shadow-card: 0 1px 3px 0 rgb(15 23 42 / 0.06), 0 1px 2px -1px rgb(15 23 42 / 0.04);
      
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      
      --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      
      --gradient-primary: linear-gradient(135deg, #020617 0%, #111827 100%);
      --gradient-card: linear-gradient(135deg, rgba(15, 23, 42, 0.03) 0%, rgba(30, 64, 175, 0.04) 100%);
    }

    /* ==================== DARK THEME ==================== */
    [data-theme="dark"] {
      --bg-main: #020617;
      --bg-secondary: #030712;
      --bg-tertiary: #111827;
      --bg-card: #020617;
      
      --text-primary: #e5e7eb;
      --text-secondary: #9ca3af;
      --text-muted: #6b7280;
      
      --border: #111827;
      --border-light: #1f2937;
      
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.4);
      --shadow-md: 0 4px 8px -2px rgb(0 0 0 / 0.6);
      --shadow-lg: 0 12px 20px -4px rgb(0 0 0 / 0.7);
      --shadow-xl: 0 20px 30px -6px rgb(0 0 0 / 0.8);
      --shadow-card: 0 1px 3px 0 rgb(0 0 0 / 0.5), 0 1px 2px -1px rgb(0 0 0 / 0.4);
      
      --gradient-card: linear-gradient(135deg, rgba(15, 23, 42, 0.6) 0%, rgba(15, 23, 42, 0.9) 100%);
    }

    html, body {
      width: 100%;
      height: 100vh;
      height: var(--tg-viewport-stable-height, 100vh);
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg-main);
      color: var(--text-primary);
      font-size: 14px;
      line-height: 1.5;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    body {
      padding: env(safe-area-inset-top, 0) env(safe-area-inset-right, 0) env(safe-area-inset-bottom, 0) env(safe-area-inset-left, 0);
    }

    /* ==================== THEME TOGGLE ==================== */
    .theme-toggle {
      width: 40px;
      height: 40px;
      border: none;
      background: var(--bg-card);
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      font-size: 18px;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-sm);
    }

    .theme-toggle:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      transform: scale(1.05);
    }

    /* ==================== MAIN LAYOUT ==================== */
    .dashboard {
      display: flex;
      height: 100vh;
      height: var(--tg-viewport-stable-height, 100vh);
      overflow: hidden;
    }

    /* ==================== SIDEBAR ==================== */
    .sidebar {
      width: 280px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      overflow-y: auto;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }

    .sidebar-header {
      padding: 24px 20px;
      border-bottom: 1px solid var(--border);
      background: var(--gradient-card);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .logo-icon {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-icon svg {
      width: 100%;
      height: 100%;
      filter: drop-shadow(0 4px 12px rgba(15, 23, 42, 0.45));
    }

    .logo-text {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: -0.5px;
    }

    .admin-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(15, 23, 42, 0.05);
      border: 1px solid rgba(15, 23, 42, 0.12);
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .sidebar-nav {
      flex: 1;
      padding: 16px 12px;
    }

    .nav-section {
      margin-bottom: 24px;
    }

    .nav-section-title {
      padding: 0 12px 8px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      text-decoration: none;
      transition: var(--transition);
      cursor: pointer;
      margin-bottom: 4px;
      position: relative;
      overflow: hidden;
      font-weight: 500;
    }

    .nav-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 3px;
      height: 100%;
      background: var(--primary);
      transform: scaleY(0);
      transition: var(--transition);
    }

    .nav-item:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .nav-item.active {
      background: rgba(15, 23, 42, 0.06);
      color: var(--text-primary);
      font-weight: 600;
      box-shadow: var(--shadow-sm);
    }

    .nav-item.active::before {
      transform: scaleY(1);
    }

    .nav-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .nav-badge {
      margin-left: auto;
      padding: 2px 8px;
      background: #111827;
      color: white;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      box-shadow: var(--shadow-sm);
    }

    .sidebar-footer {
      padding: 16px;
      border-top: 1px solid var(--border);
    }

    .status-card {
      padding: 12px;
      background: var(--gradient-card);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.2);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* ==================== MAIN CONTENT ==================== */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: var(--bg-main);
    }

    /* ==================== HEADER ==================== */
    .header {
      height: 72px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      flex-shrink: 0;
      box-shadow: var(--shadow-sm);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .menu-toggle {
      display: none;
      width: 40px;
      height: 40px;
      border: none;
      background: transparent;
      color: var(--text-primary);
      font-size: 20px;
      cursor: pointer;
      border-radius: var(--radius-md);
      transition: var(--transition);
    }

    .menu-toggle:hover {
      background: var(--bg-tertiary);
    }

    .page-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .search-box {
      position: relative;
      width: 300px;
    }

    .search-input {
      width: 100%;
      padding: 10px 16px 10px 42px;
      background: var(--bg-main);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 14px;
      transition: var(--transition);
    }

    .search-input:focus {
      outline: none;
      border-color: #111827;
      box-shadow: 0 0 0 3px rgba(15, 23, 42, 0.1);
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    .search-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      font-size: 16px;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .icon-button {
      width: 40px;
      height: 40px;
      border: none;
      background: var(--bg-main);
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      font-size: 18px;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      box-shadow: var(--shadow-sm);
    }

    .icon-button:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      transform: scale(1.05);
    }

    .icon-button .badge {
      position: absolute;
      top: -4px;
      right: -4px;
      width: 18px;
      height: 18px;
      background: #111827;
      color: white;
      border-radius: 50%;
      font-size: 10px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid var(--bg-secondary);
      box-shadow: var(--shadow-sm);
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 12px;
      background: var(--bg-main);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }

    .user-menu:hover {
      background: var(--bg-tertiary);
      transform: scale(1.02);
    }

    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: white;
      box-shadow: var(--shadow-sm);
    }

    .user-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .user-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .user-role {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* ==================== CONTENT AREA ==================== */
    .content-area {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
      background: var(--bg-main);
    }

    /* ==================== STATS GRID ==================== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 24px;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-card);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: var(--gradient-primary);
      transform: scaleX(0);
      transform-origin: left;
      transition: var(--transition);
    }

    .stat-card:hover {
      border-color: #111827;
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }

    .stat-card:hover::before {
      transform: scaleX(1);
    }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      background: rgba(15, 23, 42, 0.04);
      box-shadow: var(--shadow-sm);
    }

    .stat-trend {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      box-shadow: var(--shadow-sm);
    }

    .stat-trend.up {
      background: rgba(34, 197, 94, 0.08);
      color: var(--success);
    }

    .stat-trend.down {
      background: rgba(239, 68, 68, 0.08);
      color: var(--danger);
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
      line-height: 1;
      color: var(--text-primary);
    }

    .stat-label {
      font-size: 14px;
      color: var(--text-secondary);
      font-weight: 600;
      margin-bottom: 4px;
    }

    .stat-sublabel {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 8px;
    }

    /* ==================== CONTENT GRID ==================== */
    .content-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      margin-bottom: 24px;
    }

    /* ==================== CARD ==================== */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-card);
      transition: var(--transition);
    }

    .card:hover {
      box-shadow: var(--shadow-md);
    }

    .card-header {
      padding: 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--gradient-card);
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-primary);
    }

    .card-actions {
      display: flex;
      gap: 8px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: var(--radius-md);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: var(--shadow-sm);
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--bg-main);
      transform: translateY(-1px);
    }

    .btn-danger {
      background: #ef4444;
      color: #ffffff;
      border: 1px solid #ef4444;
    }

    .btn-danger:hover {
      background: #dc2626;
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn-success {
      background: #22c55e;
      color: #ffffff;
      border: 1px solid #22c55e;
    }

    .btn-success:hover {
      background: #16a34a;
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
    }

    /* ==================== MAP CONTAINER ==================== */
    .map-container {
      height: 500px;
      background: var(--bg-tertiary);
      position: relative;
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    #map {
      width: 100%;
      height: 100%;
    }

    .map-overlay {
      position: absolute;
      top: 16px;
      right: 16px;
      background: var(--bg-card);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 12px 16px;
      z-index: 10;
      box-shadow: var(--shadow-lg);
    }

    .map-overlay-title {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .map-overlay-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }

    /* ==================== TABLE ==================== */
    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border);
    }

    th {
      padding: 12px 16px;
      text-align: left;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
    }

    td {
      padding: 16px;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
      color: var(--text-primary);
    }

    tbody tr {
      transition: var(--transition);
    }

    tbody tr:hover {
      background: var(--bg-tertiary);
    }

    .table-user {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .table-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: white;
      flex-shrink: 0;
      overflow: hidden;
      box-shadow: var(--shadow-sm);
    }

    .table-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .table-user-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .table-user-name {
      font-weight: 600;
      color: var(--text-primary);
    }

    .table-user-meta {
      font-size: 12px;
      color: var(--text-muted);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      box-shadow: var(--shadow-sm);
    }

    .badge-success {
      background: rgba(34, 197, 94, 0.1);
      color: var(--success);
      border: 1px solid rgba(34, 197, 94, 0.2);
    }

    .badge-warning {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
      border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .badge-danger {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .badge-info {
      background: rgba(59, 130, 246, 0.1);
      color: var(--info);
      border: 1px solid rgba(59, 130, 246, 0.2);
    }

    /* ==================== ACTIVITY LIST ==================== */
    .activity-list {
      padding: 20px;
    }

    .activity-item {
      display: flex;
      gap: 16px;
      padding: 16px 0;
      border-bottom: 1px solid var(--border);
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-icon {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
      box-shadow: var(--shadow-sm);
    }

    .activity-icon.success {
      background: rgba(34, 197, 94, 0.1);
      color: var(--success);
    }

    .activity-icon.warning {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
    }

    .activity-icon.info {
      background: rgba(59, 130, 246, 0.1);
      color: var(--info);
    }

    .activity-content {
      flex: 1;
    }

    .activity-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--text-primary);
    }

    .activity-description {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }

    .activity-time {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* ==================== CHARTS ==================== */
    .chart-container {
      padding: 20px;
      height: 350px;
    }

    canvas {
      max-width: 100%;
      max-height: 100%;
    }

    .chart-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    /* ==================== ANALYTICS VIEW ==================== */
    #analyticsView {
      display: none;
    }

    /* ==================== LOADING STATE ==================== */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: var(--text-muted);
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: #111827;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ==================== EMPTY STATE ==================== */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 20px;
      text-align: center;
    }

    .empty-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.3;
    }

    .empty-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .empty-description {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 20px;
    }

    /* ==================== MODAL ==================== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-xl);
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow-xl);
    }

    .modal-header {
      padding: 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--gradient-card);
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .modal-close {
      width: 36px;
      height: 36px;
      border: none;
      background: var(--bg-tertiary);
      border-radius: 50%;
      color: var(--text-secondary);
      font-size: 18px;
      cursor: pointer;
      transition: var(--transition);
    }

    .modal-close:hover {
      background: var(--danger);
      color: white;
      transform: scale(1.1);
    }

    .modal-body {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }

    .modal-footer {
      padding: 24px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    /* ==================== BLOCK REASON MODAL ==================== */
    .block-reason-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .block-reason-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      border: 2px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      background: var(--bg-secondary);
    }

    .block-reason-option:hover {
      border-color: var(--danger);
      background: rgba(239, 68, 68, 0.05);
    }

    .block-reason-option input[type="radio"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      flex-shrink: 0;
    }

    .block-reason-option input[type="radio"]:checked + .reason-content {
      color: var(--danger);
    }

    .block-reason-option:has(input:checked) {
      border-color: var(--danger);
      background: rgba(239, 68, 68, 0.08);
    }

    .reason-content {
      flex: 1;
    }

    .reason-title {
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 4px;
    }

    .reason-subtitle {
      font-size: 13px;
      color: var(--text-muted);
    }

    #blockReasonModal .modal {
      max-width: 600px;
    }

    /* ==================== DRIVER DETAILS ==================== */
    .driver-details {
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 24px;
    }

    .driver-photo-section {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .driver-photo {
      width: 160px;
      height: 160px;
      border-radius: var(--radius-lg);
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      font-weight: 700;
      color: white;
      overflow: hidden;
      border: 3px solid var(--border);
      box-shadow: var(--shadow-lg);
    }

    .driver-photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .driver-docs {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .doc-link {
      padding: 8px 12px;
      background: var(--bg-main);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      text-decoration: none;
      color: var(--text-primary);
      font-size: 12px;
      text-align: center;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }

    .doc-link:hover {
      border-color: #111827;
      color: #111827;
      transform: translateY(-1px);
    }

    .driver-info-section {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .info-group {
      display: grid;
      grid-template-columns: 140px 1fr;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }

    .info-group:last-child {
      border-bottom: none;
    }

    .info-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-muted);
    }

    .info-value {
      font-size: 14px;
      color: var(--text-primary);
    }

    /* ==================== SIDEBAR BACKDROP ==================== */
    .sidebar-backdrop {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 99;
    }

    .sidebar-backdrop.active {
      display: block;
    }

    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 1024px) {
      .content-grid {
        grid-template-columns: 1fr;
      }

      .search-box {
        display: none;
      }

      .chart-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        height: 100vh;
        z-index: 100;
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .menu-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .header-right {
        gap: 4px;
      }

      .user-info {
        display: none;
      }

      .driver-details {
        grid-template-columns: 1fr;
      }

      .driver-photo {
        width: 120px;
        height: 120px;
        margin: 0 auto;
      }
    }

    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }

      .content-area {
        padding: 16px;
      }

      .header {
        padding: 0 16px;
      }
    }
  </style>
</head>
<body>
  <div class="sidebar-backdrop" id="sidebarBackdrop"></div>
  
  <div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <div class="logo-icon">
            <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect width="48" height="48" rx="12" fill="url(#gradient)"/>
              <path d="M12 30L18 18H22L16 30H12Z" fill="white" opacity="0.9"/>
              <path d="M22 30L26 18H30L26 30H22Z" fill="white" opacity="0.9"/>
              <path d="M30 30H36V18H32L30 30Z" fill="white" opacity="0.9"/>
              <defs>
                <linearGradient id="gradient" x1="0" y1="0" x2="48" y2="48" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#020617"/>
                  <stop offset="1" stop-color="#111827"/>
                </linearGradient>
              </defs>
            </svg>
          </div>
          <div class="logo-text">Alash-Go</div>
        </div>
        <span class="admin-badge">
          <span>üëë</span>
          ”ò–∫—ñ–º—à—ñ –ü–∞–Ω–µ–ª—ñ
        </span>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">–®–æ–ª—É</div>
          <a href="#" class="nav-item active" data-view="dashboard">
            <span class="nav-icon">üìä</span>
            <span>–ë–∞—Å—Ç–∞–ø“õ—ã –±–µ—Ç</span>
          </a>
          <a href="#" class="nav-item" data-view="analytics">
            <span class="nav-icon">üìà</span>
            <span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">–ë–∞—Å“õ–∞—Ä—É</div>
          <a href="#" class="nav-item" data-view="drivers">
            <span class="nav-icon">üöö</span>
            <span>–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä</span>
            <span class="nav-badge" id="pendingDriversBadge">0</span>
          </a>
          <a href="#" class="nav-item" data-view="orders">
            <span class="nav-icon">üì¶</span>
            <span>–¢–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä</span>
            <span class="nav-badge" id="pendingOrdersBadge">0</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">–ñ“Ø–π–µ</div>
          <a href="#" class="nav-item" data-view="settings">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span>–ü–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä</span>
          </a>
        </div>
      </nav>

      <div class="sidebar-footer">
        <div class="status-card">
          <div class="status-indicator">
            <span class="status-dot"></span>
            <span>–ñ“Ø–π–µ –±–µ–ª—Å–µ–Ω–¥—ñ</span>
          </div>
          <div style="margin-top: 8px; font-size: 11px; color: var(--text-muted);">
            <span id="adminTelegramId">–ñ“Ø–∫—Ç–µ–ª—É–¥–µ...</span>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="header">
        <div class="header-left">
          <button class="menu-toggle" id="menuToggle">
            <span>‚ò∞</span>
          </button>
          <h1 class="page-title" id="pageTitle">–ë–∞—Å—Ç–∞–ø“õ—ã –±–µ—Ç</h1>
        </div>

        <div class="header-right">
          <div class="search-box">
            <span class="search-icon">üîç</span>
            <input type="text" class="search-input" placeholder="–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä–¥—ñ, —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä–¥—ã —ñ–∑–¥–µ—É...">
          </div>

          <div class="header-actions">
            <button class="icon-button">
              <span>üîî</span>
              <span class="badge">3</span>
            </button>
            <button class="theme-toggle" id="themeToggle" title="–¢“Ø–Ω–≥—ñ/–ö“Ø–Ω–¥—ñ–∑–≥—ñ —Ä–µ–∂–∏–º">
              <span id="themeIcon">üåô</span>
            </button>
          </div>

          <div class="user-menu">
            <div class="user-avatar">”ò</div>
            <div class="user-info">
              <div class="user-name">”ò–∫—ñ–º—à—ñ</div>
              <div class="user-role">–ë–∞—Å“õ–∞—Ä—É—à—ã</div>
            </div>
          </div>
        </div>
      </header>

      <!-- Content Area -->
      <div class="content-area" id="contentArea">
        <!-- Dashboard View (Default) -->
        <div id="dashboardView">
          <!-- Stats Grid -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon">üöö</div>
                <div class="stat-trend up">
                  <span>‚Üë</span>
                  <span>12%</span>
                </div>
              </div>
              <div class="stat-value" id="totalDrivers">-</div>
              <div class="stat-label">–ë–∞—Ä–ª—ã“õ –∂“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä</div>
              <div class="stat-sublabel">
                <span id="approvedDrivers">-</span> –º–∞“õ“±–ª–¥–∞–Ω“ì–∞–Ω, 
                <span id="pendingDrivers">-</span> –∫“Ø—Ç—É–¥–µ
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon">üì¶</div>
                <div class="stat-trend up">
                  <span>‚Üë</span>
                  <span>8%</span>
                </div>
              </div>
              <div class="stat-value" id="totalOrders">-</div>
              <div class="stat-label">–ë–∞—Ä–ª—ã“õ —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä</div>
              <div class="stat-sublabel">
                <span id="completedOrders">-</span> –∞—è“õ—Ç–∞–ª“ì–∞–Ω, 
                <span id="pendingOrders">-</span> –∫“Ø—Ç—É–¥–µ
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon">üí∞</div>
                <div class="stat-trend up">
                  <span>‚Üë</span>
                  <span>24%</span>
                </div>
              </div>
              <div class="stat-value">‚Ç∏<span id="totalRevenue">-</span></div>
              <div class="stat-label">–¢–∞–±—ã—Å</div>
              <div class="stat-sublabel">–û—Å—ã –∞–π–¥–∞ (–±–∞“ì–∞–ª–∞—É)</div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon">‚ö°</div>
                <div class="stat-trend up">
                  <span>‚Üë</span>
                  <span>5%</span>
                </div>
              </div>
              <div class="stat-value" id="activeNow">-</div>
              <div class="stat-label">“ö–∞–∑—ñ—Ä –±–µ–ª—Å–µ–Ω–¥—ñ</div>
              <div class="stat-sublabel">–û–Ω–ª–∞–π–Ω –∂“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä</div>
            </div>
          </div>

          <!-- Content Grid -->
          <div class="content-grid">
            <!-- Map Card -->
            <div class="card">
              <div class="card-header">
                <div class="card-title">
                  <span>üó∫Ô∏è</span>
                  <span>–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä–¥—ñ“£ –æ—Ä–Ω–∞–ª–∞—Å—É—ã</span>
                </div>
                <div class="card-actions">
                  <button class="btn btn-sm btn-secondary">
                    <span>üîÑ</span>
                    <span>–ñ–∞“£–∞—Ä—Ç—É</span>
                  </button>
                </div>
              </div>
              <div class="map-container">
                <div id="map"></div>
                <div class="map-overlay">
                  <div class="map-overlay-title">–ë–µ–ª—Å–µ–Ω–¥—ñ –∂“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä</div>
                  <div class="map-overlay-value" id="mapActiveDrivers">0</div>
                </div>
              </div>
            </div>

            <!-- Activity Card -->
            <div class="card">
              <div class="card-header">
                <div class="card-title">
                  <span>üìã</span>
                  <span>–°–æ“£“ì—ã ”ô—Ä–µ–∫–µ—Ç—Ç–µ—Ä</span>
                </div>
              </div>
              <div class="activity-list" id="activityList">
                <div class="loading">
                  <div class="spinner"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Orders Table -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <span>üì¶</span>
                <span>–°–æ“£“ì—ã —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä</span>
              </div>
              <div class="card-actions">
                <button class="btn btn-sm btn-secondary">–ë–∞—Ä–ª—ã“ì—ã–Ω –∫”©—Ä—É</button>
              </div>
            </div>
            <div class="table-container">
              <table id="recentOrdersTable">
                <thead>
                  <tr>
                    <th>–¢–∞–ø—Å—ã—Ä—ã—Å ‚Ññ</th>
                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                    <th>–ë–∞“ì—ã—Ç</th>
                    <th>–ë–∞“ì–∞—Å—ã</th>
                    <th>–ú”ô—Ä—Ç–µ–±–µ</th>
                    <th>–£–∞“õ—ã—Ç</th>
                  </tr>
                </thead>
                <tbody id="recentOrdersBody">
                  <tr>
                    <td colspan="6">
                      <div class="loading">
                        <div class="spinner"></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Analytics View -->
        <div id="analyticsView">
          <div class="chart-grid">
            <div class="card">
              <div class="card-header">
                <div class="card-title">
                  <span>üìä</span>
                  <span>–¢–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä –¥–∏–Ω–∞–º–∏–∫–∞—Å—ã</span>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="ordersChart"></canvas>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div class="card-title">
                  <span>üë•</span>
                  <span>–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞—Å—ã</span>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="driversChart"></canvas>
              </div>
            </div>
          </div>

          <div class="chart-grid">
            <div class="card">
              <div class="card-header">
                <div class="card-title">
                  <span>üí∞</span>
                  <span>–¢–∞–±—ã—Å –¥–∏–Ω–∞–º–∏–∫–∞—Å—ã</span>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="revenueChart"></canvas>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div class="card-title">
                  <span>üìà</span>
                  <span>–¢–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä –±–æ–π—ã–Ω—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="statusChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Drivers View -->
        <div id="driversView" style="display: none;">
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <span>üöö</span>
                <span>–ë–∞—Ä–ª—ã“õ –∂“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä</span>
              </div>
              <div class="card-actions">
                <button class="btn btn-sm btn-secondary">
                  <span>‚¨áÔ∏è</span>
                  <span>–≠–∫—Å–ø–æ—Ä—Ç</span>
                </button>
                <button class="btn btn-sm btn-primary">
                  <span>‚ûï</span>
                  <span>–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ “õ–æ—Å—É</span>
                </button>
              </div>
            </div>
            <div class="table-container">
              <table id="driversTable">
                <thead>
                  <tr>
                    <th>–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ</th>
                    <th>–ë–∞–π–ª–∞–Ω—ã—Å</th>
                    <th>“ö–∞–ª–∞</th>
                    <th>–ö”©–ª—ñ–∫ —Ç“Ø—Ä—ñ</th>
                    <th>–ú”ô—Ä—Ç–µ–±–µ</th>
                    <th>“ö–æ—Å—ã–ª–¥—ã</th>
                    <th>”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä</th>
                  </tr>
                </thead>
                <tbody id="driversTableBody">
                  <tr>
                    <td colspan="7">
                      <div class="loading">
                        <div class="spinner"></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Orders View -->
        <div id="ordersView" style="display: none;">
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <span>üì¶</span>
                <span>–ë–∞—Ä–ª—ã“õ —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä</span>
              </div>
              <div class="card-actions">
                <button class="btn btn-sm btn-secondary">
                  <span>üîç</span>
                  <span>–°“Ø–∑–≥—ñ</span>
                </button>
                <button class="btn btn-sm btn-secondary">
                  <span>‚¨áÔ∏è</span>
                  <span>–≠–∫—Å–ø–æ—Ä—Ç</span>
                </button>
              </div>
            </div>
            <div class="table-container">
              <table id="ordersTable">
                <thead>
                  <tr>
                    <th>–¢–∞–ø—Å—ã—Ä—ã—Å ‚Ññ</th>
                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                    <th>“ö–∞–π–¥–∞–Ω ‚Üí “ö–∞–π–¥–∞</th>
                    <th>“ö–∞—à—ã“õ—Ç—ã“õ</th>
                    <th>–ë–∞“ì–∞—Å—ã</th>
                    <th>–ú”ô—Ä—Ç–µ–±–µ</th>
                    <th>“ö“±—Ä—ã–ª–¥—ã</th>
                    <th>”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä</th>
                  </tr>
                </thead>
                <tbody id="ordersTableBody">
                  <tr>
                    <td colspan="8">
                      <div class="loading">
                        <div class="spinner"></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Driver Details Modal -->
  <div class="modal-overlay" id="driverModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —Ç—É—Ä–∞–ª—ã –º”ô–ª—ñ–º–µ—Ç</h3>
        <button class="modal-close" id="closeDriverModal">‚úï</button>
      </div>
      <div class="modal-body" id="driverModalBody">
        <div class="loading">
          <div class="spinner"></div>
        </div>
      </div>
      <div class="modal-footer" id="driverModalFooter">
        <button class="btn btn-secondary" id="closeDriverModalBtn">–ñ–∞–±—É</button>
        <button class="btn btn-danger" id="blockDriverBtn" style="display: none;">
          <span>üö´</span>
          <span>–ë–ª–æ–∫—Ç–∞—É</span>
        </button>
        <button class="btn btn-success" id="unblockDriverBtn" style="display: none;">
          <span>‚úÖ</span>
          <span>–ë–ª–æ–∫—Ç–∞–Ω —à—ã“ì–∞—Ä—É</span>
        </button>
        <button class="btn btn-primary" id="contactDriverBtn">
          <span>üí¨</span>
          <span>–•–∞–±–∞—Ä–ª–∞—Å—É</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Block Reason Modal -->
  <div class="modal-overlay" id="blockReasonModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">üö´ –ñ“Ø—Ä–≥—ñ–∑—É—à—ñ–Ω—ñ –±–ª–æ–∫—Ç–∞—É / –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–æ–¥–∏—Ç–µ–ª—è</h3>
        <button class="modal-close" onclick="closeBlockReasonModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div id="blockDriverInfo" style="margin-bottom: 20px; padding: 12px; background: var(--bg-tertiary); border-radius: 8px;">
          <!-- Driver info will be inserted here -->
        </div>
        
        <h4 style="margin-bottom: 12px; font-size: 16px;">–ë–ª–æ–∫—Ç–∞—É —Å–µ–±–µ–±—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑ / –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:</h4>
        
        <div class="block-reason-options">
          <label class="block-reason-option">
            <input type="radio" name="blockReason" value="incorrect_documents" checked>
            <div class="reason-content">
              <div class="reason-title">üìÑ “ö“±–∂–∞—Ç—Ç–∞—Ä –¥“±—Ä—ã—Å –µ–º–µ—Å</div>
              <div class="reason-subtitle">–î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º</div>
            </div>
          </label>

          <label class="block-reason-option">
            <input type="radio" name="blockReason" value="name_mismatch">
            <div class="reason-content">
              <div class="reason-title">üë§ –ê—Ç—ã-–∂”©–Ω—ñ “õ“±–∂–∞—Ç—Ç–∞—Ä–º–µ–Ω —Å”ô–π–∫–µ—Å –∫–µ–ª–º–µ–π–¥—ñ</div>
              <div class="reason-subtitle">–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏</div>
            </div>
          </label>

          <label class="block-reason-option">
            <input type="radio" name="blockReason" value="photo_mismatch">
            <div class="reason-content">
              <div class="reason-title">üì∏ –ü—Ä–æ—Ñ–∏–ª—å —Ñ–æ—Ç–æ—Å—ã “õ“±–∂–∞—Ç—Ç–∞—Ä–º–µ–Ω —Å”ô–π–∫–µ—Å –∫–µ–ª–º–µ–π–¥—ñ</div>
              <div class="reason-subtitle">–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏</div>
            </div>
          </label>

          <label class="block-reason-option">
            <input type="radio" name="blockReason" value="payment_required">
            <div class="reason-content">
              <div class="reason-title">üí≥ –¢”©–ª–µ–º —Ç”©–ª–µ–Ω–±–µ–≥–µ–Ω</div>
              <div class="reason-subtitle">–ù–µ –æ–ø–ª–∞—á–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ</div>
            </div>
          </label>

          <label class="block-reason-option">
            <input type="radio" name="blockReason" value="custom">
            <div class="reason-content">
              <div class="reason-title">‚úçÔ∏è –ë–∞—Å“õ–∞ —Å–µ–±–µ–ø</div>
              <div class="reason-subtitle">–î—Ä—É–≥–∞—è –ø—Ä–∏—á–∏–Ω–∞ (—É–∫–∞–∂–∏—Ç–µ –Ω–∏–∂–µ)</div>
            </div>
          </label>
        </div>

        <div id="customReasonField" style="display: none; margin-top: 16px;">
          <label style="display: block; margin-bottom: 8px; font-weight: 600;">
            –°–µ–±–µ–±—ñ–Ω –∂–∞–∑—ã“£—ã–∑ / –£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É:
          </label>
          <textarea 
            id="customReasonText" 
            style="width: 100%; min-height: 80px; padding: 10px; border: 2px solid var(--border); border-radius: 8px; font-size: 14px; resize: vertical; font-family: inherit; color: var(--text-primary); background: var(--bg-main);"
            placeholder="–ë–ª–æ–∫—Ç–∞—É —Å–µ–±–µ–±—ñ–Ω —Ç–æ–ª—ã“õ –∂–∞–∑—ã“£—ã–∑..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeBlockReasonModal()">
          –ë–æ–ª–¥—ã—Ä–º–∞—É / –û—Ç–º–µ–Ω–∞
        </button>
        <button class="btn btn-danger" id="confirmBlockBtn" onclick="confirmBlockDriver()">
          <span>üö´</span>
          <span>–ë–ª–æ–∫—Ç–∞—É / –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Admin Message Modal -->
  <div class="modal-overlay" id="adminMessageModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">üì¢ –ñ“Ø—Ä–≥—ñ–∑—É—à—ñ–≥–µ —Ö–∞–±–∞—Ä–ª–∞–º–∞ –∂—ñ–±–µ—Ä—É / –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—é</h3>
        <button class="modal-close" onclick="closeAdminMessageModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div id="messageDriverInfo" style="margin-bottom: 20px; padding: 12px; background: var(--bg-tertiary); border-radius: 8px;">
          <!-- Driver info will be inserted here -->
        </div>
        
        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">
            –•–∞–±–∞—Ä–ª–∞–º–∞“£—ã–∑–¥—ã –∂–∞–∑—ã“£—ã–∑ / –ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
          </label>
          <textarea 
            id="adminMessageText" 
            style="width: 100%; min-height: 120px; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 14px; resize: vertical; font-family: inherit; color: var(--text-primary); background: var(--bg-main); line-height: 1.5;"
            placeholder="–ú—ã—Å–∞–ª—ã: –°—ñ–∑–¥—ñ“£ ”©—Ç—ñ–Ω—ñ—à—ñ“£—ñ–∑ “õ–∞—Ä–∞–ª—É–¥–∞. –ñ–∞“õ—ã–Ω –∞—Ä–∞–¥–∞ –∂–∞—É–∞–ø –±–µ—Ä–µ–º—ñ–∑.

–ù–∞–ø—Ä–∏–º–µ—Ä: –í–∞—à–∞ –∑–∞—è–≤–∫–∞ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è."></textarea>
          <div style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
            üí° –•–∞–±–∞—Ä–ª–∞–º–∞ –∂“Ø—Ä–≥—ñ–∑—É—à—ñ–≥–µ ”ô–∫—ñ–º—à—ñ–¥–µ–Ω —Ä–µ—Å–º–∏ —Ö–∞–±–∞—Ä–ª–∞–º–∞ —Ä–µ—Ç—ñ–Ω–¥–µ –∂—ñ–±–µ—Ä—ñ–ª–µ–¥—ñ<br>
            üí° –°–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤–æ–¥–∏—Ç–µ–ª—é –∫–∞–∫ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeAdminMessageModal()">
          –ë–æ–ª–¥—ã—Ä–º–∞—É / –û—Ç–º–µ–Ω–∞
        </button>
        <button class="btn btn-primary" id="sendMessageBtn" onclick="confirmSendMessage()">
          <span>üì§</span>
          <span>–ñ—ñ–±–µ—Ä—É / –û—Ç–ø—Ä–∞–≤–∏—Ç—å</span>
        </button>
      </div>
    </div>
  </div>

  <script>
    // ==================== THEME MANAGEMENT ====================
    function initTheme() {
      const hour = new Date().getHours();
      const savedTheme = localStorage.getItem('theme');
      
      let theme;
      if (savedTheme) {
        theme = savedTheme;
      } else {
        theme = (hour >= 6 && hour < 20) ? 'light' : 'dark';
      }
      
      setTheme(theme);
    }

    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      const themeIcon = document.getElementById('themeIcon');
      if (themeIcon) {
        themeIcon.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      }
      localStorage.setItem('theme', theme);
    }

    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      setTheme(newTheme);
    }

    initTheme();
    document.getElementById('themeToggle')?.addEventListener('click', toggleTheme);

    // ==================== TELEGRAM WEBAPP ====================
    let tg = window.Telegram?.WebApp || null;
    let adminTelegramId = null;
    let ymap = null;
    let driverMarkers = [];

    let driversData = [];
    let ordersData = [];
    let summaryData = null;

    let ordersChart = null;
    let driversChart = null;
    let revenueChart = null;
    let statusChart = null;

    document.addEventListener('DOMContentLoaded', () => {
      initTelegram();
      initUI();
      checkAdminAccess();
    });

    function initTelegram() {
      if (tg) {
        tg.ready();
        tg.expand();
        if (tg.disableVerticalSwipes) tg.disableVerticalSwipes();
        adminTelegramId = tg.initDataUnsafe?.user?.id || null;
      }
    }

    function checkAdminAccess() {
      const adminIdDisplay = document.getElementById('adminTelegramId');
      
      if (!adminTelegramId) {
        adminIdDisplay.textContent = 'ID: –ë–µ–ª–≥—ñ—Å—ñ–∑';
        blockAccess('Telegram ID —Ç–∞–±—ã–ª–º–∞–¥—ã');
        return;
      }

      adminIdDisplay.textContent = `ID: ${adminTelegramId}`;

      if (parseInt(adminTelegramId, 10) !== 800703982) {
        blockAccess('“ö–æ–ª –∂–µ—Ç—ñ–º–¥—ñ–ª—ñ–∫ –∂–æ“õ: –¢–µ–∫ ”ô–∫—ñ–º—à—ñ–≥–µ');
        return;
      }

      loadAdminData();
      initMap();
    }

    function blockAccess(message) {
      document.body.innerHTML = `
        <div style="display:flex;align-items:center;justify-content:center;height:100vh;padding:40px;text-align:center;background:var(--bg-main);color:var(--text-primary);">
          <div>
            <div style="font-size:64px;margin-bottom:20px;">üîí</div>
            <h2 style="font-size:24px;margin-bottom:12px;">Alash-Go ”ò–∫—ñ–º—à—ñ –ü–∞–Ω–µ–ª—ñ</h2>
            <p style="color:var(--text-muted);">${message}</p>
          </div>
        </div>
      `;
    }

    // ==================== UI INITIALIZATION ====================
    function initUI() {
      const menuToggle = document.getElementById('menuToggle');
      const sidebar = document.getElementById('sidebar');
      const sidebarBackdrop = document.getElementById('sidebarBackdrop');

      menuToggle?.addEventListener('click', () => {
        sidebar.classList.toggle('open');
        sidebarBackdrop.classList.toggle('active');
      });

      sidebarBackdrop?.addEventListener('click', () => {
        sidebar.classList.remove('open');
        sidebarBackdrop.classList.remove('active');
      });

      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault();
          const view = item.dataset.view;
          switchView(view);
          
          document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
          item.classList.add('active');
          
          sidebar.classList.remove('open');
          sidebarBackdrop.classList.remove('active');
        });
      });

      const driverModal = document.getElementById('driverModal');
      const closeDriverModal = document.getElementById('closeDriverModal');
      const closeDriverModalBtn = document.getElementById('closeDriverModalBtn');

      closeDriverModal?.addEventListener('click', () => {
        driverModal.classList.remove('active');
      });

      closeDriverModalBtn?.addEventListener('click', () => {
        driverModal.classList.remove('active');
      });

      driverModal?.addEventListener('click', (e) => {
        if (e.target === driverModal) {
          driverModal.classList.remove('active');
        }
      });

      // Handle custom reason field visibility
      document.querySelectorAll('input[name="blockReason"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
          const customField = document.getElementById('customReasonField');
          if (e.target.value === 'custom') {
            customField.style.display = 'block';
          } else {
            customField.style.display = 'none';
          }
        });
      });
    }

    // ==================== VIEW SWITCHING ====================
    function switchView(view) {
      document.getElementById('dashboardView').style.display = 'none';
      document.getElementById('analyticsView').style.display = 'none';
      document.getElementById('driversView').style.display = 'none';
      document.getElementById('ordersView').style.display = 'none';

      const titles = {
        'dashboard': '–ë–∞—Å—Ç–∞–ø“õ—ã –±–µ—Ç',
        'analytics': '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞',
        'drivers': '–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä –±–∞—Å“õ–∞—Ä—É',
        'orders': '–¢–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä –±–∞—Å“õ–∞—Ä—É',
        'settings': '–ü–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä'
      };
      document.getElementById('pageTitle').textContent = titles[view] || '–ë–∞—Å—Ç–∞–ø“õ—ã –±–µ—Ç';

      switch(view) {
        case 'dashboard':
          document.getElementById('dashboardView').style.display = 'block';
          break;
        case 'analytics':
          document.getElementById('analyticsView').style.display = 'block';
          initCharts();
          break;
        case 'drivers':
          document.getElementById('driversView').style.display = 'block';
          loadDriversTable();
          break;
        case 'orders':
          document.getElementById('ordersView').style.display = 'block';
          loadOrdersTable();
          break;
      }
    }

    // ==================== DATA LOADING ====================
    async function loadAdminData() {
      try {
        const summaryRes = await fetch(`/api/admin/summary?telegram_id=${adminTelegramId}`);
        const summary = await summaryRes.json();
        
        if (summary.success || summary.data) {
          summaryData = summary.data || summary;
          updateDashboardStats(summaryData);
        }

        const driversRes = await fetch(`/api/admin/drivers?telegram_id=${adminTelegramId}`);
        const driversJson = await driversRes.json();
        driversData = driversJson.data?.drivers || driversJson.drivers || [];
        
        updateDriversOnMap();
        loadRecentActivity();

        const ordersRes = await fetch(`/api/admin/orders?telegram_id=${adminTelegramId}`);
        const ordersJson = await ordersRes.json();
        ordersData = ordersJson.data?.orders || ordersJson.orders || [];
        
        loadRecentOrders();

      } catch (error) {
        console.error('”ò–∫—ñ–º—à—ñ –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ–Ω –∂“Ø–∫—Ç–µ—É —Å”ô—Ç—Å—ñ–∑ –∞—è“õ—Ç–∞–ª–¥—ã:', error);
      }
    }

    function updateDashboardStats(data) {
      const drivers = data.drivers || {};
      const orders = data.orders || {};

      document.getElementById('totalDrivers').textContent = drivers.total || 0;
      document.getElementById('approvedDrivers').textContent = drivers.approved || 0;
      document.getElementById('pendingDrivers').textContent = drivers.pending || 0;
      
      document.getElementById('totalOrders').textContent = orders.total || 0;
      document.getElementById('completedOrders').textContent = orders.completed || 0;
      document.getElementById('pendingOrders').textContent = orders.pending || 0;

      document.getElementById('pendingDriversBadge').textContent = drivers.pending || 0;
      document.getElementById('pendingOrdersBadge').textContent = orders.pending || 0;

      const avgPrice = 5000;
      const revenue = ((orders.completed || 0) * avgPrice / 1000).toFixed(0);
      document.getElementById('totalRevenue').textContent = revenue + '–º—ã“£';

      const active = Math.ceil((drivers.approved || 0) * 0.3);
      document.getElementById('activeNow').textContent = active;
      document.getElementById('mapActiveDrivers').textContent = active;
    }

    // ==================== MAP INITIALIZATION ====================
    async function initMap() {
      if (!window.ymaps3) {
        setTimeout(initMap, 500);
        return;
      }

      await ymaps3.ready;
      const {YMap, YMapDefaultSchemeLayer, YMapDefaultFeaturesLayer, YMapMarker} = ymaps3;

      const mapElement = document.getElementById('map');
      if (!mapElement) return;

      ymap = new YMap(mapElement, {
        location: {
          center: [76.889709, 43.238949],
          zoom: 11
        },
        behaviors: ['drag', 'scrollZoom', 'dblClick', 'pinchZoom']
      });

      ymap.addChild(new YMapDefaultSchemeLayer());
      ymap.addChild(new YMapDefaultFeaturesLayer());

      updateDriversOnMap();
    }

    function updateDriversOnMap() {
      if (!ymap || !window.ymaps3) return;

      driverMarkers.forEach(m => ymap.removeChild(m));
      driverMarkers = [];

      const {YMapMarker} = ymaps3;

      driversData.forEach(driver => {
        if (!driver.latitude || !driver.longitude) return;

        const el = document.createElement('div');
        el.style.width = '16px';
        el.style.height = '16px';
        el.style.borderRadius = '50%';
        el.style.border = '3px solid white';
        el.style.boxShadow = '0 2px 8px rgba(0,0,0,0.18), 0 0 0 6px rgba(15,23,42,0.18)';
        el.style.background = driver.status === 'approved' ? '#facc15' : '#9ca3af';
        el.style.cursor = 'pointer';
        el.style.transition = 'all 0.2s';

        el.addEventListener('mouseenter', () => {
          el.style.transform = 'scale(1.3)';
          el.style.boxShadow = '0 4px 12px rgba(0,0,0,0.25), 0 0 0 8px rgba(15,23,42,0.25)';
        });

        el.addEventListener('mouseleave', () => {
          el.style.transform = 'scale(1)';
          el.style.boxShadow = '0 2px 8px rgba(0,0,0,0.18), 0 0 0 6px rgba(15,23,42,0.18)';
        });

        el.addEventListener('click', () => {
          showDriverDetails(driver.id);
        });

        const marker = new YMapMarker({coordinates: [driver.longitude, driver.latitude]}, el);
        ymap.addChild(marker);
        driverMarkers.push(marker);
      });
    }

    // ==================== RECENT ACTIVITY ====================
    function loadRecentActivity() {
      const activityList = document.getElementById('activityList');
      
      const activities = [
        {
          icon: 'success',
          emoji: '‚úÖ',
          title: '–ñ–∞“£–∞ –∂“Ø—Ä–≥—ñ–∑—É—à—ñ –º–∞“õ“±–ª–¥–∞–Ω–¥—ã',
          description: `${driversData[0]?.first_name || '–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ'} –º–∞“õ“±–ª–¥–∞–Ω–¥—ã`,
          time: '5 –º–∏–Ω—É—Ç –±“±—Ä—ã–Ω'
        },
        {
          icon: 'info',
          emoji: 'üì¶',
          title: '–¢–∞–ø—Å—ã—Ä—ã—Å –∞—è“õ—Ç–∞–ª–¥—ã',
          description: '–¢–∞–ø—Å—ã—Ä—ã—Å ‚Ññ' + (ordersData[0]?.id?.substring(0, 8) || 'XXX') + ' —Å”ô—Ç—Ç—ñ –∂–µ—Ç–∫—ñ–∑—ñ–ª–¥—ñ',
          time: '12 –º–∏–Ω—É—Ç –±“±—Ä—ã–Ω'
        },
        {
          icon: 'warning',
          emoji: '‚è≥',
          title: '–ú–∞“õ“±–ª–¥–∞—É–¥—ã –∫“Ø—Ç—É–¥–µ',
          description: '–ñ–∞“£–∞ –∂“Ø—Ä–≥—ñ–∑—É—à—ñ —Ç—ñ—Ä–∫–µ—É—ñ “õ–∞—Ä–∞–ª—É–¥—ã –∫“Ø—Ç—É–¥–µ',
          time: '25 –º–∏–Ω—É—Ç –±“±—Ä—ã–Ω'
        }
      ];

      activityList.innerHTML = activities.map(activity => `
        <div class="activity-item">
          <div class="activity-icon ${activity.icon}">
            <span>${activity.emoji}</span>
          </div>
          <div class="activity-content">
            <div class="activity-title">${activity.title}</div>
            <div class="activity-description">${activity.description}</div>
            <div class="activity-time">${activity.time}</div>
          </div>
        </div>
      `).join('');
    }

    // ==================== RECENT ORDERS TABLE ====================
    function loadRecentOrders() {
      const tbody = document.getElementById('recentOrdersBody');
      const recentOrders = ordersData.slice(0, 5);

      if (recentOrders.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6">
              <div class="empty-state">
                <div class="empty-icon">üì¶</div>
                <div class="empty-title">”ò–∑—ñ—Ä—à–µ —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä –∂–æ“õ</div>
                <div class="empty-description">–ö–ª–∏–µ–Ω—Ç—Ç–µ—Ä ”©—Ç—ñ–Ω—ñ—à –∂–∞—Å–∞“ì–∞–Ω–¥–∞ —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä –æ—Å—ã–Ω–¥–∞ –∫”©—Ä—Å–µ—Ç—ñ–ª–µ–¥—ñ</div>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = recentOrders.map(order => `
        <tr>
          <td><strong>#${order.id.substring(0, 8)}</strong></td>
          <td>
            <div class="table-user">
              <div class="table-avatar">üë§</div>
              <div class="table-user-info">
                <div class="table-user-name">–ö–ª–∏–µ–Ω—Ç</div>
                <div class="table-user-meta">${order.contact || '–ñ–æ“õ'}</div>
              </div>
            </div>
          </td>
          <td>
            <div>${order.from_address || '–ñ–æ“õ'}</div>
            <div style="font-size: 12px; color: var(--text-muted);">‚Üì ${order.to_address || '–ñ–æ“õ'}</div>
          </td>
          <td><strong>‚Ç∏${order.price || 0}</strong></td>
          <td>${getStatusBadge(order.status)}</td>
          <td>${formatDate(order.created_at)}</td>
        </tr>
      `).join('');
    }

    // ==================== DRIVERS TABLE ====================
    function loadDriversTable() {
      const tbody = document.getElementById('driversTableBody');

      if (driversData.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="7">
              <div class="empty-state">
                <div class="empty-icon">üöö</div>
                <div class="empty-title">–¢—ñ—Ä–∫–µ–ª–≥–µ–Ω –∂“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä –∂–æ“õ</div>
                <div class="empty-description">–¢—ñ—Ä–∫–µ–ª–≥–µ–Ω–Ω–µ–Ω –∫–µ–π—ñ–Ω –∂“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä –æ—Å—ã–Ω–¥–∞ –∫”©—Ä—Å–µ—Ç—ñ–ª–µ–¥—ñ</div>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = driversData.map(driver => {
        const isBlocked = driver.status === 'rejected' || driver.status === 'suspended';
        const actionButton = isBlocked 
          ? `<button class="btn btn-sm btn-success" onclick="openUnblockPrompt('${driver.id}')">
              ‚úÖ –ë–ª–æ–∫—Ç–∞–Ω —à—ã“ì–∞—Ä—É
            </button>`
          : `<button class="btn btn-sm btn-danger" onclick="openBlockPrompt('${driver.id}')">
              üö´ –ë–ª–æ–∫
            </button>`;

        return `
          <tr>
            <td>
              <div class="table-user">
                <div class="table-avatar">
                  ${driver.profile_photo ? 
                    `<img src="/ava/${driver.profile_photo}" alt="${driver.first_name}">` : 
                    (driver.first_name?.[0] || '?').toUpperCase()}
                </div>
                <div class="table-user-info">
                  <div class="table-user-name">${driver.first_name} ${driver.last_name}</div>
                  <div class="table-user-meta">ID: ${driver.telegram_id}</div>
                </div>
              </div>
            </td>
            <td>${driver.contact_number || '–ñ–æ“õ'}</td>
            <td>${driver.start_city || '–ñ–æ“õ'}</td>
            <td><span class="badge badge-info">${getTruckTypeName(driver.truck_type)}</span></td>
            <td>${getStatusBadge(driver.status)}</td>
            <td>${formatDate(driver.created_at)}</td>
            <td style="display:flex;gap:6px;flex-wrap:wrap;">
              <button class="btn btn-sm btn-secondary" onclick="showDriverDetails('${driver.id}')">
                üëÅÔ∏è –ö”©—Ä—É
              </button>
              <button class="btn btn-sm btn-primary" onclick="openAdminMessageModal('${driver.id}')" title="–•–∞–±–∞—Ä–ª–∞–º–∞ –∂—ñ–±–µ—Ä—É">
                üì¢ –•–∞–±–∞—Ä
              </button>
              ${actionButton}
            </td>
          </tr>
        `;
      }).join('');
    }

    // ==================== ORDERS TABLE ====================
    function loadOrdersTable() {
      const tbody = document.getElementById('ordersTableBody');

      if (ordersData.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8">
              <div class="empty-state">
                <div class="empty-icon">üì¶</div>
                <div class="empty-title">”ò–∑—ñ—Ä—à–µ —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä –∂–æ“õ</div>
                <div class="empty-description">–ö–ª–∏–µ–Ω—Ç—Ç–µ—Ä ”©—Ç—ñ–Ω—ñ—à –∂–∞—Å–∞“ì–∞–Ω–¥–∞ —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä –æ—Å—ã–Ω–¥–∞ –∫”©—Ä—Å–µ—Ç—ñ–ª–µ–¥—ñ</div>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = ordersData.map(order => `
        <tr>
          <td><strong>#${order.id.substring(0, 8)}</strong></td>
          <td>
            <div class="table-user">
              <div class="table-avatar">üë§</div>
              <div class="table-user-info">
                <div class="table-user-name">–ö–ª–∏–µ–Ω—Ç</div>
                <div class="table-user-meta">${order.contact || '–ñ–æ“õ'}</div>
              </div>
            </div>
          </td>
          <td>
            <div style="font-size: 13px;">${order.from_address || '–ñ–æ“õ'}</div>
            <div style="font-size: 12px; color: var(--text-muted);">‚Üì ${order.to_address || '–ñ–æ“õ'}</div>
          </td>
          <td>${order.distance_km ? order.distance_km.toFixed(1) + ' –∫–º' : '–ñ–æ“õ'}</td>
          <td><strong>‚Ç∏${order.price || 0}</strong></td>
          <td>${getStatusBadge(order.status)}</td>
          <td>${formatDate(order.created_at)}</td>
          <td>
            <button class="btn btn-sm btn-secondary">–¢–æ–ª—ã“õ</button>
          </td>
        </tr>
      `).join('');
    }

    // ==================== DRIVER DETAILS MODAL ====================
    function showDriverDetails(driverId) {
      const driver = driversData.find(d => d.id === driverId);
      if (!driver) return;

      const modal = document.getElementById('driverModal');
      const modalBody = document.getElementById('driverModalBody');

      modalBody.innerHTML = `
        <div class="driver-details">
          <div class="driver-photo-section">
            <div class="driver-photo">
              ${driver.profile_photo ? 
                `<img src="/ava/${driver.profile_photo}" alt="${driver.first_name}">` : 
                (driver.first_name?.[0] || '?').toUpperCase()}
            </div>
            <div class="driver-docs">
              ${driver.license_front ? `<a href="/documents/${driver.license_front}" target="_blank" class="doc-link">üìÑ –ö—É”ô–ª—ñ–∫ –∞–ª–¥—ã</a>` : ''}
              ${driver.license_back ? `<a href="/documents/${driver.license_back}" target="_blank" class="doc-link">üìÑ –ö—É”ô–ª—ñ–∫ –∞—Ä—Ç—ã</a>` : ''}
            </div>
          </div>
          <div class="driver-info-section">
            <div class="info-group">
              <div class="info-label">–¢–æ–ª—ã“õ –∞—Ç—ã</div>
              <div class="info-value">${driver.first_name} ${driver.last_name}</div>
            </div>
            <div class="info-group">
              <div class="info-label">–ë–∞–π–ª–∞–Ω—ã—Å</div>
              <div class="info-value">${driver.contact_number || '–ñ–æ“õ'}</div>
            </div>
            <div class="info-group">
              <div class="info-label">–¢—É“ì–∞–Ω –∫“Ø–Ω—ñ</div>
              <div class="info-value">${driver.birthday || '–ñ–æ“õ'}</div>
            </div>
            <div class="info-group">
              <div class="info-label">“ö–∞–ª–∞</div>
              <div class="info-value">${driver.start_city || '–ñ–æ“õ'}</div>
            </div>
            <div class="info-group">
              <div class="info-label">–ö”©–ª—ñ–∫ —Ç“Ø—Ä—ñ</div>
              <div class="info-value">${getTruckTypeName(driver.truck_type)}</div>
            </div>
            <div class="info-group">
              <div class="info-label">–ú”ô—Ä—Ç–µ–±–µ</div>
              <div class="info-value">${getStatusBadge(driver.status)}</div>
            </div>
            <div class="info-group">
              <div class="info-label">Telegram ID</div>
              <div class="info-value">${driver.telegram_id}</div>
            </div>
            <div class="info-group">
              <div class="info-label">–†–∞—Å—Ç–∞–ª“ì–∞–Ω</div>
              <div class="info-value">${driver.is_verified ? '‚úÖ –ò”ô' : '‚ùå –ñ–æ“õ'}</div>
            </div>
            <div class="info-group">
              <div class="info-label">–¢—ñ—Ä–∫–µ–ª–¥—ñ</div>
              <div class="info-value">${formatDate(driver.created_at)}</div>
            </div>
          </div>
        </div>
      `;

      modal.classList.add('active');

      // Show/hide buttons based on driver status
      const blockBtn = document.getElementById('blockDriverBtn');
      const unblockBtn = document.getElementById('unblockDriverBtn');
      const isBlocked = driver.status === 'rejected' || driver.status === 'suspended';

      blockBtn.style.display = isBlocked ? 'none' : 'inline-flex';
      unblockBtn.style.display = isBlocked ? 'inline-flex' : 'none';

      // Add message button if not already present
      const footer = document.getElementById('driverModalFooter');
      let messageBtn = footer.querySelector('.message-driver-btn');
      if (!messageBtn) {
        messageBtn = document.createElement('button');
        messageBtn.className = 'btn btn-primary message-driver-btn';
        messageBtn.innerHTML = '<span>üì¢</span><span>–•–∞–±–∞—Ä–ª–∞–º–∞ / –°–æ–æ–±—â–µ–Ω–∏–µ</span>';
        messageBtn.onclick = () => openAdminMessageModal(driverId);
        
        // Insert before contact button
        const contactBtn = document.getElementById('contactDriverBtn');
        footer.insertBefore(messageBtn, contactBtn);
      }

      // Contact button
      const contactBtn = document.getElementById('contactDriverBtn');
      contactBtn.onclick = () => {
        if (driver.contact_number) {
          const digits = driver.contact_number.replace(/\D/g, '');
          window.open(`https://wa.me/${digits}`, '_blank');
        }
      };

      // Block button
      blockBtn.onclick = () => {
        openBlockPrompt(driver.id);
      };

      // Unblock button
      unblockBtn.onclick = () => {
        openUnblockPrompt(driver.id);
      };
    }

    // ==================== BLOCK DRIVER FUNCTIONALITY ====================
    let currentBlockDriverId = null;
    let currentBlockDriverData = null;

    function openBlockPrompt(driverId) {
      const driver = driversData.find(d => d.id === driverId);
      if (!driver) {
        alert('–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —Ç–∞–±—ã–ª–º–∞–¥—ã / –í–æ–¥–∏—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
      }

      currentBlockDriverId = driverId;
      currentBlockDriverData = driver;

      document.getElementById('blockDriverInfo').innerHTML = `
        <div style="display: flex; align-items: center; gap: 12px;">
          <div class="table-avatar">
            ${driver.profile_photo ? 
              `<img src="/ava/${driver.profile_photo}" alt="${driver.first_name}">` : 
              (driver.first_name?.[0] || '?').toUpperCase()}
          </div>
          <div>
            <div style="font-weight: 600; font-size: 16px;">${driver.first_name} ${driver.last_name}</div>
            <div style="font-size: 13px; color: var(--text-muted);">
              üì± ${driver.contact_number || '–ñ–æ“õ'} ‚Ä¢ 
              üÜî ${driver.telegram_id}
            </div>
          </div>
        </div>
      `;

      document.querySelectorAll('input[name="blockReason"]')[0].checked = true;
      document.getElementById('customReasonText').value = '';
      document.getElementById('customReasonField').style.display = 'none';

      document.getElementById('blockReasonModal').classList.add('active');
      document.getElementById('driverModal').classList.remove('active');
    }

    function closeBlockReasonModal() {
      document.getElementById('blockReasonModal').classList.remove('active');
      currentBlockDriverId = null;
      currentBlockDriverData = null;
    }

    async function confirmBlockDriver() {
      if (!currentBlockDriverId) {
        alert('“ö–∞—Ç–µ / –û—à–∏–±–∫–∞');
        return;
      }

      const selectedReason = document.querySelector('input[name="blockReason"]:checked').value;
      let customReason = '';

      if (selectedReason === 'custom') {
        customReason = document.getElementById('customReasonText').value.trim();
        if (!customReason) {
          alert('–°–µ–±–µ–±—ñ–Ω –∂–∞–∑—ã“£—ã–∑ / –£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É');
          document.getElementById('customReasonText').focus();
          return;
        }
      }

      const confirmBtn = document.getElementById('confirmBlockBtn');
      confirmBtn.disabled = true;
      confirmBtn.innerHTML = '<span>‚è≥</span><span>”®“£–¥–µ–ª—É–¥–µ...</span>';

      try {
        const res = await fetch(
          `/api/admin/drivers/${currentBlockDriverId}/reject?telegram_id=${adminTelegramId}`,
          {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
              reason_type: selectedReason,
              custom_reason: customReason
            })
          }
        );

        const data = await res.json();

        if (!res.ok || !data.success) {
          throw new Error(data.message || '–ë–ª–æ–∫—Ç–∞—É —Å”ô—Ç—Å—ñ–∑ –∞—è“õ—Ç–∞–ª–¥—ã');
        }

        const idx = driversData.findIndex(d => d.id === currentBlockDriverId);
        if (idx !== -1) {
          driversData[idx].status = 'rejected';
          driversData[idx].is_verified = false;
        }

        loadDriversTable();
        updateDriversOnMap();
        closeBlockReasonModal();

        alert('‚úÖ –ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —Å”ô—Ç—Ç—ñ –±–ª–æ–∫—Ç–∞–ª–¥—ã –∂”ô–Ω–µ —Ö–∞–±–∞—Ä–ª–∞–º–∞ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ!\n\n–í–æ–¥–∏—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');

      } catch (err) {
        console.error('Block driver error:', err);
        alert('‚ùå “ö–∞—Ç–µ: ' + err.message + '\n\n–û—à–∏–±–∫–∞: ' + err.message);
      } finally {
        confirmBtn.disabled = false;
        confirmBtn.innerHTML = '<span>üö´</span><span>–ë–ª–æ–∫—Ç–∞—É / –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</span>';
      }
    }

    // ==================== UNBLOCK DRIVER FUNCTIONALITY ====================
    async function openUnblockPrompt(driverId) {
      const driver = driversData.find(d => d.id === driverId);
      if (!driver) {
        alert('–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —Ç–∞–±—ã–ª–º–∞–¥—ã / –í–æ–¥–∏—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
      }

      const confirmUnblock = confirm(
        `üîì –ñ“Ø—Ä–≥—ñ–∑—É—à—ñ–Ω—ñ –±–ª–æ–∫—Ç–∞–Ω —à—ã“ì–∞—Ä—É / –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è?\n\n` +
        `üë§ ${driver.first_name} ${driver.last_name}\n` +
        `üì± ${driver.contact_number || '–ñ–æ“õ'}\n` +
        `üÜî Telegram ID: ${driver.telegram_id}\n\n` +
        `–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ Alash-Go –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Å—ã–Ω–∞ “õ–∞–π—Ç–∞ “õ–æ–ª –∂–µ—Ç–∫—ñ–∑–µ –∞–ª–∞–¥—ã.\n` +
        `–í–æ–¥–∏—Ç–µ–ª—å —Å–Ω–æ–≤–∞ —Å–º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ Alash-Go.`
      );

      if (!confirmUnblock) return;

      try {
        const res = await fetch(
          `/api/admin/drivers/${driverId}/unblock?telegram_id=${adminTelegramId}`,
          {
            method: 'POST',
            headers: {'Content-Type': 'application/json'}
          }
        );

        const data = await res.json();

        if (!res.ok || !data.success) {
          throw new Error(data.message || '–ë–ª–æ–∫—Ç–∞–Ω —à—ã“ì–∞—Ä—É —Å”ô—Ç—Å—ñ–∑ –∞—è“õ—Ç–∞–ª–¥—ã');
        }

        // Update local data
        const idx = driversData.findIndex(d => d.id === driverId);
        if (idx !== -1) {
          driversData[idx].status = 'pending';
          driversData[idx].is_verified = false;
        }

        loadDriversTable();
        updateDriversOnMap();
        document.getElementById('driverModal').classList.remove('active');

        alert(
          '‚úÖ –ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —Å”ô—Ç—Ç—ñ –±–ª–æ–∫—Ç–∞–Ω —à—ã“ì–∞—Ä—ã–ª–¥—ã!\n\n' +
          '–í–æ–¥–∏—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!\n\n' +
          'üì© –ñ“Ø—Ä–≥—ñ–∑—É—à—ñ–≥–µ —Ö–∞–±–∞—Ä–ª–∞–º–∞ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ.\n' +
          '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤–æ–¥–∏—Ç–µ–ª—é.'
        );

      } catch (err) {
        console.error('Unblock driver error:', err);
        alert('‚ùå “ö–∞—Ç–µ: ' + err.message + '\n\n–û—à–∏–±–∫–∞: ' + err.message);
      }
    }

    document.getElementById('blockReasonModal')?.addEventListener('click', (e) => {
      if (e.target.id === 'blockReasonModal') {
        closeBlockReasonModal();
      }
    });

    // ==================== ADMIN MESSAGE FUNCTIONALITY ====================
    let currentMessageDriverId = null;
    let currentMessageDriverData = null;

    function openAdminMessageModal(driverId) {
      const driver = driversData.find(d => d.id === driverId);
      if (!driver) {
        alert('–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —Ç–∞–±—ã–ª–º–∞–¥—ã / –í–æ–¥–∏—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
      }

      currentMessageDriverId = driverId;
      currentMessageDriverData = driver;

      document.getElementById('messageDriverInfo').innerHTML = `
        <div style="display: flex; align-items: center; gap: 12px;">
          <div class="table-avatar">
            ${driver.profile_photo ? 
              `<img src="/ava/${driver.profile_photo}" alt="${driver.first_name}">` : 
              (driver.first_name?.[0] || '?').toUpperCase()}
          </div>
          <div>
            <div style="font-weight: 600; font-size: 16px;">${driver.first_name} ${driver.last_name}</div>
            <div style="font-size: 13px; color: var(--text-muted);">
              üì± ${driver.contact_number || '–ñ–æ“õ'} ‚Ä¢ 
              üÜî ${driver.telegram_id}
            </div>
          </div>
        </div>
      `;

      document.getElementById('adminMessageText').value = '';

      document.getElementById('adminMessageModal').classList.add('active');
      document.getElementById('driverModal').classList.remove('active');
      
      // Focus on textarea
      setTimeout(() => {
        document.getElementById('adminMessageText').focus();
      }, 300);
    }

    function closeAdminMessageModal() {
      document.getElementById('adminMessageModal').classList.remove('active');
      currentMessageDriverId = null;
      currentMessageDriverData = null;
    }

    async function confirmSendMessage() {
      if (!currentMessageDriverId || !currentMessageDriverData) {
        alert('“ö–∞—Ç–µ: –ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ –∂–æ“õ\n\n–û—à–∏–±–∫–∞: –î–∞–Ω–Ω—ã–µ –≤–æ–¥–∏—Ç–µ–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç');
        return;
      }

      const message = document.getElementById('adminMessageText').value.trim();

      if (!message) {
        alert('–•–∞–±–∞—Ä–ª–∞–º–∞ –±–æ—Å –±–æ–ª–º–∞—É—ã –∫–µ—Ä–µ–∫!\n\n–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º!');
        document.getElementById('adminMessageText').focus();
        return;
      }

      if (message.length < 10) {
        alert('–•–∞–±–∞—Ä–ª–∞–º–∞ —Ç—ã–º “õ—ã—Å“õ–∞ (–∫–µ–º—ñ–Ω–¥–µ 10 —Ç–∞“£–±–∞)!\n\n–°–æ–æ–±—â–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ (–º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤)!');
        document.getElementById('adminMessageText').focus();
        return;
      }

      if (message.length > 4000) {
        alert('–•–∞–±–∞—Ä–ª–∞–º–∞ —Ç—ã–º “±–∑—ã–Ω (–º–∞–∫—Å–∏–º—É–º 4000 —Ç–∞“£–±–∞)!\n\n–°–æ–æ–±—â–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (–º–∞–∫—Å–∏–º—É–º 4000 —Å–∏–º–≤–æ–ª–æ–≤)!');
        return;
      }

      // ‚úÖ CRITICAL FIX: Save driver info BEFORE any async operation
      const driverFirstName = currentMessageDriverData.first_name;
      const driverLastName = currentMessageDriverData.last_name;
      const driverFullName = `${driverFirstName} ${driverLastName}`;

      const sendBtn = document.getElementById('sendMessageBtn');
      sendBtn.disabled = true;
      sendBtn.innerHTML = '<span>‚è≥</span><span>–ñ—ñ–±–µ—Ä—ñ–ª—É–¥–µ...</span>';

      try {
        const res = await fetch(
          `/api/admin/drivers/${currentMessageDriverId}/message?telegram_id=${adminTelegramId}`,
          {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
              message: message
            })
          }
        );

        const data = await res.json();

        if (!res.ok || !data.success) {
          throw new Error(data.message || '–•–∞–±–∞—Ä–ª–∞–º–∞ –∂—ñ–±–µ—Ä—É —Å”ô—Ç—Å—ñ–∑ –∞—è“õ—Ç–∞–ª–¥—ã');
        }

        // Close modal AFTER successful send
        closeAdminMessageModal();

        // Use saved driver name (not currentMessageDriverData which is now null)
        alert(
          '‚úÖ –•–∞–±–∞—Ä–ª–∞–º–∞ —Å”ô—Ç—Ç—ñ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ!\n\n' +
          '–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!\n\n' +
          `üì© –ñ“Ø—Ä–≥—ñ–∑—É—à—ñ: ${driverFullName}\n` +
          `–í–æ–¥–∏—Ç–µ–ª—å: ${driverFullName}`
        );

      } catch (err) {
        console.error('Send message error:', err);
        alert('‚ùå “ö–∞—Ç–µ: ' + err.message + '\n\n–û—à–∏–±–∫–∞: ' + err.message);
      } finally {
        sendBtn.disabled = false;
        sendBtn.innerHTML = '<span>üì§</span><span>–ñ—ñ–±–µ—Ä—É / –û—Ç–ø—Ä–∞–≤–∏—Ç—å</span>';
      }
    }

    // Close modal on backdrop click
    document.getElementById('adminMessageModal')?.addEventListener('click', (e) => {
      if (e.target.id === 'adminMessageModal') {
        closeAdminMessageModal();
      }
    });

    // ==================== ANALYTICS CHARTS ====================
    function initCharts() {
      if (!summaryData) return;

      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      const textColor = isDark ? '#cbd5e1' : '#4b5563';
      const gridColor = isDark ? '#111827' : '#e5e7eb';

      const ordersChartData = summaryData.charts?.orders_by_day || [];
      if (ordersChart) ordersChart.destroy();
      ordersChart = new Chart(document.getElementById('ordersChart'), {
        type: 'line',
        data: {
          labels: ordersChartData.map(d => new Date(d.date).toLocaleDateString('kk-KZ', { month: 'short', day: 'numeric' })),
          datasets: [{
            label: '–¢–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä',
            data: ordersChartData.map(d => d.count),
            borderColor: '#111827',
            backgroundColor: 'rgba(15, 23, 42, 0.12)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { color: textColor },
              grid: { color: gridColor }
            },
            x: {
              ticks: { color: textColor },
              grid: { color: gridColor }
            }
          }
        }
      });

      const driversChartData = summaryData.charts?.drivers_by_day || [];
      if (driversChart) driversChart.destroy();
      driversChart = new Chart(document.getElementById('driversChart'), {
        type: 'bar',
        data: {
          labels: driversChartData.map(d => new Date(d.date).toLocaleDateString('kk-KZ', { month: 'short', day: 'numeric' })),
          datasets: [{
            label: '–ñ–∞“£–∞ –∂“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä',
            data: driversChartData.map(d => d.count),
            backgroundColor: 'rgba(15, 23, 42, 0.9)',
            borderRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { color: textColor },
              grid: { color: gridColor }
            },
            x: {
              ticks: { color: textColor },
              grid: { display: false }
            }
          }
        }
      });

      if (revenueChart) revenueChart.destroy();
      revenueChart = new Chart(document.getElementById('revenueChart'), {
        type: 'line',
        data: {
          labels: ordersChartData.map(d => new Date(d.date).toLocaleDateString('kk-KZ', { month: 'short', day: 'numeric' })),
          datasets: [{
            label: '–¢–∞–±—ã—Å (‚Ç∏)',
            data: ordersChartData.map(d => d.count * 5000),
            borderColor: '#111827',
            backgroundColor: 'rgba(15, 23, 42, 0.12)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { 
                color: textColor,
                callback: value => '‚Ç∏' + (value / 1000) + '–º—ã“£'
              },
              grid: { color: gridColor }
            },
            x: {
              ticks: { color: textColor },
              grid: { color: gridColor }
            }
          }
        }
      });

      const orders = summaryData.orders || {};
      if (statusChart) statusChart.destroy();
      statusChart = new Chart(document.getElementById('statusChart'), {
        type: 'doughnut',
        data: {
          labels: ['–ê—è“õ—Ç–∞–ª“ì–∞–Ω', '–ö“Ø—Ç—É–¥–µ', '–û—Ä—ã–Ω–¥–∞–ª—É–¥–∞', '–ë–∞—Å —Ç–∞—Ä—Ç—ã–ª“ì–∞–Ω'],
          datasets: [{
            data: [
              orders.completed || 0,
              orders.pending || 0,
              orders.in_progress || 0,
              orders.cancelled || 0
            ],
            backgroundColor: [
              'rgba(34, 197, 94, 0.9)',
              'rgba(245, 158, 11, 0.9)',
              'rgba(59, 130, 246, 0.9)',
              'rgba(239, 68, 68, 0.9)'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: { color: textColor }
            }
          }
        }
      });
    }

    // ==================== HELPER FUNCTIONS ====================
    function getStatusBadge(status) {
      const badges = {
        'approved': '<span class="badge badge-success">–ú–∞“õ“±–ª–¥–∞–Ω“ì–∞–Ω</span>',
        'pending': '<span class="badge badge-warning">–ö“Ø—Ç—É–¥–µ</span>',
        'rejected': '<span class="badge badge-danger">–ë–ª–æ–∫—Ç–∞–ª“ì–∞–Ω</span>',
        'suspended': '<span class="badge badge-danger">–¢–æ“õ—Ç–∞—Ç—ã–ª“ì–∞–Ω</span>',
        'completed': '<span class="badge badge-success">–ê—è“õ—Ç–∞–ª“ì–∞–Ω</span>',
        'in_progress': '<span class="badge badge-info">–û—Ä—ã–Ω–¥–∞–ª—É–¥–∞</span>',
        'matched': '<span class="badge badge-info">–°”ô–π–∫–µ—Å—Ç–µ–Ω–¥—ñ—Ä—ñ–ª–≥–µ–Ω</span>',
        'cancelled': '<span class="badge badge-danger">–ë–∞—Å —Ç–∞—Ä—Ç—ã–ª“ì–∞–Ω</span>'
      };
      return badges[status] || `<span class="badge">${status}</span>`;
    }

    function getTruckTypeName(type) {
      const names = {
        'intercity': '“ö–∞–ª–∞ –∞—Ä–∞–ª—ã“õ',
        'small': '–ö—ñ—à—ñ (1.5—Ç)',
        'medium': '–û—Ä—Ç–∞—à–∞ (5—Ç)',
        'large': '“Æ–ª–∫–µ–Ω (20—Ç)',
        'tow': '–≠–≤–∞–∫—É–∞—Ç–æ—Ä',
        'any': '–ö–µ–∑ –∫–µ–ª–≥–µ–Ω'
      };
      return names[type] || type || '–ö–µ–∑ –∫–µ–ª–≥–µ–Ω';
    }

    function formatDate(dateString) {
      if (!dateString) return '–ñ–æ“õ';
      const date = new Date(dateString);
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);

      if (diffMins < 1) return '–î”ô–ª “õ–∞–∑—ñ—Ä';
      if (diffMins < 60) return `${diffMins} –º–∏–Ω—É—Ç –±“±—Ä—ã–Ω`;
      if (diffHours < 24) return `${diffHours} —Å–∞“ì–∞—Ç –±“±—Ä—ã–Ω`;
      if (diffDays < 7) return `${diffDays} –∫“Ø–Ω –±“±—Ä—ã–Ω`;
      
      return date.toLocaleDateString('kk-KZ', { month: 'short', day: 'numeric' });
    }

    setInterval(() => {
      loadAdminData();
    }, 30000);

    setInterval(() => {
      if (!localStorage.getItem('theme')) {
        initTheme();
      }
    }, 60000);
  </script>
</body>
</html>