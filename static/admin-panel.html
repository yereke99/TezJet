<!DOCTYPE html>
<html lang="kz">
<head>
  <meta charset="UTF-8">
  <title>QazLine ”ò–∫—ñ–º—à—ñ –ü–∞–Ω–µ–ª—ñ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script defer src="https://api-maps.yandex.ru/v3/?apikey=8a3e4da0-9ef2-4176-9203-e7014c1dba6f&lang=ru_RU"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    /* ==================== LIGHT THEME (Default) ==================== */
    :root {
      --primary: #10b981;
      --primary-dark: #059669;
      --primary-light: #34d399;
      --primary-ultra-light: #d1fae5;
      
      --bg-main: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f1f5f9;
      --bg-card: #ffffff;
      
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-muted: #94a3b8;
      
      --border: #e2e8f0;
      --border-light: #f1f5f9;
      
      --danger: #ef4444;
      --warning: #f59e0b;
      --success: #10b981;
      --info: #3b82f6;
      
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.07);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.08);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
      --shadow-card: 0 1px 3px 0 rgb(0 0 0 / 0.05), 0 1px 2px -1px rgb(0 0 0 / 0.05);
      
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      
      --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      
      --gradient-primary: linear-gradient(135deg, #10b981 0%, #34d399 100%);
      --gradient-card: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(52, 211, 153, 0.05) 100%);
    }

    /* ==================== DARK THEME ==================== */
    [data-theme="dark"] {
      --bg-main: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --bg-card: #1e293b;
      
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --text-muted: #64748b;
      
      --border: #334155;
      --border-light: #475569;
      
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.2);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.3);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.4);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.5);
      --shadow-card: 0 1px 3px 0 rgb(0 0 0 / 0.3), 0 1px 2px -1px rgb(0 0 0 / 0.2);
      
      --gradient-card: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(52, 211, 153, 0.1) 100%);
    }

    html, body {
      width: 100%;
      height: 100vh;
      height: var(--tg-viewport-stable-height, 100vh);
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg-main);
      color: var(--text-primary);
      font-size: 14px;
      line-height: 1.5;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    body {
      padding: env(safe-area-inset-top, 0) env(safe-area-inset-right, 0) env(safe-area-inset-bottom, 0) env(safe-area-inset-left, 0);
    }

    /* ==================== THEME TOGGLE ==================== */
    .theme-toggle {
      width: 40px;
      height: 40px;
      border: none;
      background: var(--bg-card);
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      font-size: 18px;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-sm);
    }

    .theme-toggle:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      transform: scale(1.05);
    }

    /* ==================== MAIN LAYOUT ==================== */
    .dashboard {
      display: flex;
      height: 100vh;
      height: var(--tg-viewport-stable-height, 100vh);
      overflow: hidden;
    }

    /* ==================== SIDEBAR ==================== */
    .sidebar {
      width: 280px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      overflow-y: auto;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }

    .sidebar-header {
      padding: 24px 20px;
      border-bottom: 1px solid var(--border);
      background: var(--gradient-card);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .logo-icon {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-icon svg {
      width: 100%;
      height: 100%;
      filter: drop-shadow(0 4px 12px rgba(16, 185, 129, 0.3));
    }

    .logo-text {
      font-size: 24px;
      font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
    }

    .admin-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.2);
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      color: var(--primary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .sidebar-nav {
      flex: 1;
      padding: 16px 12px;
    }

    .nav-section {
      margin-bottom: 24px;
    }

    .nav-section-title {
      padding: 0 12px 8px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      text-decoration: none;
      transition: var(--transition);
      cursor: pointer;
      margin-bottom: 4px;
      position: relative;
      overflow: hidden;
      font-weight: 500;
    }

    .nav-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 3px;
      height: 100%;
      background: var(--primary);
      transform: scaleY(0);
      transition: var(--transition);
    }

    .nav-item:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .nav-item.active {
      background: var(--gradient-card);
      color: var(--primary);
      font-weight: 600;
      box-shadow: var(--shadow-sm);
    }

    .nav-item.active::before {
      transform: scaleY(1);
    }

    .nav-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .nav-badge {
      margin-left: auto;
      padding: 2px 8px;
      background: var(--danger);
      color: white;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      box-shadow: var(--shadow-sm);
    }

    .sidebar-footer {
      padding: 16px;
      border-top: 1px solid var(--border);
    }

    .status-card {
      padding: 12px;
      background: var(--gradient-card);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
      box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.2);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* ==================== MAIN CONTENT ==================== */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: var(--bg-main);
    }

    /* ==================== HEADER ==================== */
    .header {
      height: 72px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      flex-shrink: 0;
      box-shadow: var(--shadow-sm);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .menu-toggle {
      display: none;
      width: 40px;
      height: 40px;
      border: none;
      background: transparent;
      color: var(--text-primary);
      font-size: 20px;
      cursor: pointer;
      border-radius: var(--radius-md);
      transition: var(--transition);
    }

    .menu-toggle:hover {
      background: var(--bg-tertiary);
    }

    .page-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .search-box {
      position: relative;
      width: 300px;
    }

    .search-input {
      width: 100%;
      padding: 10px 16px 10px 42px;
      background: var(--bg-main);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 14px;
      transition: var(--transition);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    .search-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      font-size: 16px;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .icon-button {
      width: 40px;
      height: 40px;
      border: none;
      background: var(--bg-main);
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      font-size: 18px;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      box-shadow: var(--shadow-sm);
    }

    .icon-button:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      transform: scale(1.05);
    }

    .icon-button .badge {
      position: absolute;
      top: -4px;
      right: -4px;
      width: 18px;
      height: 18px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      font-size: 10px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid var(--bg-secondary);
      box-shadow: var(--shadow-sm);
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 12px;
      background: var(--bg-main);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }

    .user-menu:hover {
      background: var(--bg-tertiary);
      transform: scale(1.02);
    }

    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: white;
      box-shadow: var(--shadow-sm);
    }

    .user-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .user-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .user-role {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* ==================== CONTENT AREA ==================== */
    .content-area {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
      background: var(--bg-main);
    }

    /* ==================== STATS GRID ==================== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 24px;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-card);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--gradient-primary);
      transform: scaleX(0);
      transform-origin: left;
      transition: var(--transition);
    }

    .stat-card:hover {
      border-color: var(--primary);
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .stat-card:hover::before {
      transform: scaleX(1);
    }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .stat-icon {
      width: 56px;
      height: 56px;
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      background: var(--gradient-card);
      box-shadow: var(--shadow-sm);
    }

    .stat-icon.drivers { 
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(96, 165, 250, 0.1) 100%);
    }
    .stat-icon.orders { 
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(251, 191, 36, 0.1) 100%);
    }
    .stat-icon.revenue { 
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(52, 211, 153, 0.1) 100%);
    }
    .stat-icon.active { 
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(167, 139, 250, 0.1) 100%);
    }

    .stat-trend {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      box-shadow: var(--shadow-sm);
    }

    .stat-trend.up {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
    }

    .stat-trend.down {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 8px;
      line-height: 1;
      color: var(--text-primary);
    }

    .stat-label {
      font-size: 14px;
      color: var(--text-secondary);
      font-weight: 600;
      margin-bottom: 4px;
    }

    .stat-sublabel {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 8px;
    }

    /* ==================== CONTENT GRID ==================== */
    .content-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      margin-bottom: 24px;
    }

    /* ==================== CARD ==================== */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-card);
      transition: var(--transition);
    }

    .card:hover {
      box-shadow: var(--shadow-md);
    }

    .card-header {
      padding: 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--gradient-card);
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-primary);
    }

    .card-actions {
      display: flex;
      gap: 8px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: var(--radius-md);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: var(--shadow-sm);
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--bg-main);
      transform: translateY(-1px);
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
    }

    /* ==================== MAP CONTAINER ==================== */
    .map-container {
      height: 500px;
      background: var(--bg-tertiary);
      position: relative;
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    #map {
      width: 100%;
      height: 100%;
    }

    .map-overlay {
      position: absolute;
      top: 16px;
      right: 16px;
      background: var(--bg-card);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 12px 16px;
      z-index: 10;
      box-shadow: var(--shadow-lg);
    }

    .map-overlay-title {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .map-overlay-value {
      font-size: 20px;
      font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* ==================== TABLE ==================== */
    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border);
    }

    th {
      padding: 12px 16px;
      text-align: left;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
    }

    td {
      padding: 16px;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
      color: var(--text-primary);
    }

    tbody tr {
      transition: var(--transition);
    }

    tbody tr:hover {
      background: var(--bg-tertiary);
    }

    .table-user {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .table-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: white;
      flex-shrink: 0;
      overflow: hidden;
      box-shadow: var(--shadow-sm);
    }

    .table-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .table-user-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .table-user-name {
      font-weight: 600;
      color: var(--text-primary);
    }

    .table-user-meta {
      font-size: 12px;
      color: var(--text-muted);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      box-shadow: var(--shadow-sm);
    }

    .badge-success {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .badge-warning {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
      border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .badge-danger {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .badge-info {
      background: rgba(59, 130, 246, 0.1);
      color: var(--info);
      border: 1px solid rgba(59, 130, 246, 0.2);
    }

    /* ==================== ACTIVITY LIST ==================== */
    .activity-list {
      padding: 20px;
    }

    .activity-item {
      display: flex;
      gap: 16px;
      padding: 16px 0;
      border-bottom: 1px solid var(--border);
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-icon {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
      box-shadow: var(--shadow-sm);
    }

    .activity-icon.success {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
    }

    .activity-icon.warning {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
    }

    .activity-icon.info {
      background: rgba(59, 130, 246, 0.1);
      color: var(--info);
    }

    .activity-content {
      flex: 1;
    }

    .activity-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--text-primary);
    }

    .activity-description {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }

    .activity-time {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* ==================== CHARTS ==================== */
    .chart-container {
      padding: 20px;
      height: 350px;
    }

    canvas {
      max-width: 100%;
      max-height: 100%;
    }

    .chart-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    /* ==================== ANALYTICS VIEW ==================== */
    #analyticsView {
      display: none;
    }

    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 1024px) {
      .content-grid {
        grid-template-columns: 1fr;
      }

      .search-box {
        display: none;
      }

      .chart-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        height: 100vh;
        z-index: 100;
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .menu-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .header-right {
        gap: 4px;
      }

      .user-info {
        display: none;
      }
    }

    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }

      .content-area {
        padding: 16px;
      }

      .header {
        padding: 0 16px;
      }
    }

    /* ==================== LOADING STATE ==================== */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: var(--text-muted);
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ==================== EMPTY STATE ==================== */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 20px;
      text-align: center;
    }

    .empty-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.3;
    }

    .empty-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .empty-description {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 20px;
    }

    /* ==================== MODAL ==================== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-xl);
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow-xl);
    }

    .modal-header {
      padding: 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--gradient-card);
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .modal-close {
      width: 36px;
      height: 36px;
      border: none;
      background: var(--bg-tertiary);
      border-radius: 50%;
      color: var(--text-secondary);
      font-size: 18px;
      cursor: pointer;
      transition: var(--transition);
    }

    .modal-close:hover {
      background: var(--danger);
      color: white;
      transform: scale(1.1);
    }

    .modal-body {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }

    .modal-footer {
      padding: 24px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    /* ==================== DRIVER DETAILS ==================== */
    .driver-details {
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 24px;
    }

    .driver-photo-section {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .driver-photo {
      width: 160px;
      height: 160px;
      border-radius: var(--radius-lg);
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      font-weight: 700;
      color: white;
      overflow: hidden;
      border: 3px solid var(--border);
      box-shadow: var(--shadow-lg);
    }

    .driver-photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .driver-docs {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .doc-link {
      padding: 8px 12px;
      background: var(--bg-main);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      text-decoration: none;
      color: var(--text-primary);
      font-size: 12px;
      text-align: center;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }

    .doc-link:hover {
      border-color: var(--primary);
      color: var(--primary);
      transform: translateY(-1px);
    }

    .driver-info-section {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .info-group {
      display: grid;
      grid-template-columns: 140px 1fr;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }

    .info-group:last-child {
      border-bottom: none;
    }

    .info-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-muted);
    }

    .info-value {
      font-size: 14px;
      color: var(--text-primary);
    }

    /* ==================== SIDEBAR BACKDROP ==================== */
    .sidebar-backdrop {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 99;
    }

    .sidebar-backdrop.active {
      display: block;
    }

    @media (max-width: 768px) {
      .driver-details {
        grid-template-columns: 1fr;
      }

      .driver-photo {
        width: 120px;
        height: 120px;
        margin: 0 auto;
      }
    }
  </style>
</head>
<body>
  <div class="sidebar-backdrop" id="sidebarBackdrop"></div>
  
  <div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <div class="logo-icon">
            <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect width="48" height="48" rx="12" fill="url(#gradient)"/>
              <path d="M24 12L32 18V30L24 36L16 30V18L24 12Z" fill="white" opacity="0.9"/>
              <path d="M24 20L28 22.5V27.5L24 30L20 27.5V22.5L24 20Z" fill="url(#gradient2)"/>
              <defs>
                <linearGradient id="gradient" x1="0" y1="0" x2="48" y2="48" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#10b981"/>
                  <stop offset="1" stop-color="#34d399"/>
                </linearGradient>
                <linearGradient id="gradient2" x1="20" y1="20" x2="28" y2="30" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#059669"/>
                  <stop offset="1" stop-color="#10b981"/>
                </linearGradient>
              </defs>
            </svg>
          </div>
          <div class="logo-text">QazLine</div>
        </div>
        <span class="admin-badge">
          <span>üëë</span>
          ”ò–∫—ñ–º—à—ñ –ü–∞–Ω–µ–ª—ñ
        </span>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">–®–æ–ª—É</div>
          <a href="#" class="nav-item active" data-view="dashboard">
            <span class="nav-icon">üìä</span>
            <span>–ë–∞—Å—Ç–∞–ø“õ—ã –±–µ—Ç</span>
          </a>
          <a href="#" class="nav-item" data-view="analytics">
            <span class="nav-icon">üìà</span>
            <span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">–ë–∞—Å“õ–∞—Ä—É</div>
          <a href="#" class="nav-item" data-view="drivers">
            <span class="nav-icon">üöö</span>
            <span>–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä</span>
            <span class="nav-badge" id="pendingDriversBadge">0</span>
          </a>
          <a href="#" class="nav-item" data-view="orders">
            <span class="nav-icon">üì¶</span>
            <span>–¢–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä</span>
            <span class="nav-badge" id="pendingOrdersBadge">0</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">–ñ“Ø–π–µ</div>
          <a href="#" class="nav-item" data-view="settings">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span>–ü–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä</span>
          </a>
        </div>
      </nav>

      <div class="sidebar-footer">
        <div class="status-card">
          <div class="status-indicator">
            <span class="status-dot"></span>
            <span>–ñ“Ø–π–µ –±–µ–ª—Å–µ–Ω–¥—ñ</span>
          </div>
          <div style="margin-top: 8px; font-size: 11px; color: var(--text-muted);">
            <span id="adminTelegramId">–ñ“Ø–∫—Ç–µ–ª—É–¥–µ...</span>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="header">
        <div class="header-left">
          <button class="menu-toggle" id="menuToggle">
            <span>‚ò∞</span>
          </button>
          <h1 class="page-title" id="pageTitle">–ë–∞—Å—Ç–∞–ø“õ—ã –±–µ—Ç</h1>
        </div>

        <div class="header-right">
          <div class="search-box">
            <span class="search-icon">üîç</span>
            <input type="text" class="search-input" placeholder="–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä–¥—ñ, —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä–¥—ã —ñ–∑–¥–µ—É...">
          </div>

          <div class="header-actions">
            <button class="icon-button">
              <span>üîî</span>
              <span class="badge">3</span>
            </button>
            <button class="theme-toggle" id="themeToggle" title="–¢“Ø–Ω–≥—ñ/–ö“Ø–Ω–¥—ñ–∑–≥—ñ —Ä–µ–∂–∏–º">
              <span id="themeIcon">üåô</span>
            </button>
          </div>

          <div class="user-menu">
            <div class="user-avatar">”ò</div>
            <div class="user-info">
              <div class="user-name">”ò–∫—ñ–º—à—ñ</div>
              <div class="user-role">–ë–∞—Å“õ–∞—Ä—É—à—ã</div>
            </div>
          </div>
        </div>
      </header>

      <!-- Content Area -->
      <div class="content-area" id="contentArea">
        <!-- Dashboard View (Default) -->
        <div id="dashboardView">
          <!-- Stats Grid -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon drivers">üöö</div>
                <div class="stat-trend up">
                  <span>‚Üë</span>
                  <span>12%</span>
                </div>
              </div>
              <div class="stat-value" id="totalDrivers">-</div>
              <div class="stat-label">–ë–∞—Ä–ª—ã“õ –∂“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä</div>
              <div class="stat-sublabel">
                <span id="approvedDrivers">-</span> –º–∞“õ“±–ª–¥–∞–Ω“ì–∞–Ω, 
                <span id="pendingDrivers">-</span> –∫“Ø—Ç—É–¥–µ
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon orders">üì¶</div>
                <div class="stat-trend up">
                  <span>‚Üë</span>
                  <span>8%</span>
                </div>
              </div>
              <div class="stat-value" id="totalOrders">-</div>
              <div class="stat-label">–ë–∞—Ä–ª—ã“õ —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä</div>
              <div class="stat-sublabel">
                <span id="completedOrders">-</span> –∞—è“õ—Ç–∞–ª“ì–∞–Ω, 
                <span id="pendingOrders">-</span> –∫“Ø—Ç—É–¥–µ
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon revenue">üí∞</div>
                <div class="stat-trend up">
                  <span>‚Üë</span>
                  <span>24%</span>
                </div>
              </div>
              <div class="stat-value">‚Ç∏<span id="totalRevenue">-</span></div>
              <div class="stat-label">–¢–∞–±—ã—Å</div>
              <div class="stat-sublabel">–û—Å—ã –∞–π–¥–∞</div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon active">‚ö°</div>
                <div class="stat-trend up">
                  <span>‚Üë</span>
                  <span>5%</span>
                </div>
              </div>
              <div class="stat-value" id="activeNow">-</div>
              <div class="stat-label">“ö–∞–∑—ñ—Ä –±–µ–ª—Å–µ–Ω–¥—ñ</div>
              <div class="stat-sublabel">–û–Ω–ª–∞–π–Ω –∂“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä</div>
            </div>
          </div>

          <!-- Content Grid -->
          <div class="content-grid">
            <!-- Map Card -->
            <div class="card">
              <div class="card-header">
                <div class="card-title">
                  <span>üó∫Ô∏è</span>
                  <span>–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä–¥—ñ“£ –æ—Ä–Ω–∞–ª–∞—Å—É—ã</span>
                </div>
                <div class="card-actions">
                  <button class="btn btn-sm btn-secondary">
                    <span>üîÑ</span>
                    <span>–ñ–∞“£–∞—Ä—Ç—É</span>
                  </button>
                </div>
              </div>
              <div class="map-container">
                <div id="map"></div>
                <div class="map-overlay">
                  <div class="map-overlay-title">–ë–µ–ª—Å–µ–Ω–¥—ñ –∂“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä</div>
                  <div class="map-overlay-value" id="mapActiveDrivers">0</div>
                </div>
              </div>
            </div>

            <!-- Activity Card -->
            <div class="card">
              <div class="card-header">
                <div class="card-title">
                  <span>üìã</span>
                  <span>–°–æ“£“ì—ã ”ô—Ä–µ–∫–µ—Ç—Ç–µ—Ä</span>
                </div>
              </div>
              <div class="activity-list" id="activityList">
                <div class="loading">
                  <div class="spinner"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Orders Table -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <span>üì¶</span>
                <span>–°–æ“£“ì—ã —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä</span>
              </div>
              <div class="card-actions">
                <button class="btn btn-sm btn-secondary">–ë–∞—Ä–ª—ã“ì—ã–Ω –∫”©—Ä—É</button>
              </div>
            </div>
            <div class="table-container">
              <table id="recentOrdersTable">
                <thead>
                  <tr>
                    <th>–¢–∞–ø—Å—ã—Ä—ã—Å ‚Ññ</th>
                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                    <th>–ë–∞“ì—ã—Ç</th>
                    <th>–ë–∞“ì–∞—Å—ã</th>
                    <th>–ú”ô—Ä—Ç–µ–±–µ</th>
                    <th>–£–∞“õ—ã—Ç</th>
                  </tr>
                </thead>
                <tbody id="recentOrdersBody">
                  <tr>
                    <td colspan="6">
                      <div class="loading">
                        <div class="spinner"></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Analytics View -->
        <div id="analyticsView">
          <div class="chart-grid">
            <div class="card">
              <div class="card-header">
                <div class="card-title">
                  <span>üìä</span>
                  <span>–¢–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä –¥–∏–Ω–∞–º–∏–∫–∞—Å—ã</span>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="ordersChart"></canvas>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div class="card-title">
                  <span>üë•</span>
                  <span>–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞—Å—ã</span>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="driversChart"></canvas>
              </div>
            </div>
          </div>

          <div class="chart-grid">
            <div class="card">
              <div class="card-header">
                <div class="card-title">
                  <span>üí∞</span>
                  <span>–¢–∞–±—ã—Å –¥–∏–Ω–∞–º–∏–∫–∞—Å—ã</span>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="revenueChart"></canvas>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div class="card-title">
                  <span>üìà</span>
                  <span>–¢–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä –±–æ–π—ã–Ω—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="statusChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Drivers View -->
        <div id="driversView" style="display: none;">
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <span>üöö</span>
                <span>–ë–∞—Ä–ª—ã“õ –∂“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä</span>
              </div>
              <div class="card-actions">
                <button class="btn btn-sm btn-secondary">
                  <span>‚¨áÔ∏è</span>
                  <span>–≠–∫—Å–ø–æ—Ä—Ç</span>
                </button>
                <button class="btn btn-sm btn-primary">
                  <span>‚ûï</span>
                  <span>–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ “õ–æ—Å—É</span>
                </button>
              </div>
            </div>
            <div class="table-container">
              <table id="driversTable">
                <thead>
                  <tr>
                    <th>–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ</th>
                    <th>–ë–∞–π–ª–∞–Ω—ã—Å</th>
                    <th>“ö–∞–ª–∞</th>
                    <th>–ö”©–ª—ñ–∫ —Ç“Ø—Ä—ñ</th>
                    <th>–ú”ô—Ä—Ç–µ–±–µ</th>
                    <th>“ö–æ—Å—ã–ª–¥—ã</th>
                    <th>”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä</th>
                  </tr>
                </thead>
                <tbody id="driversTableBody">
                  <tr>
                    <td colspan="7">
                      <div class="loading">
                        <div class="spinner"></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Orders View -->
        <div id="ordersView" style="display: none;">
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <span>üì¶</span>
                <span>–ë–∞—Ä–ª—ã“õ —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä</span>
              </div>
              <div class="card-actions">
                <button class="btn btn-sm btn-secondary">
                  <span>üîç</span>
                  <span>–°“Ø–∑–≥—ñ</span>
                </button>
                <button class="btn btn-sm btn-secondary">
                  <span>‚¨áÔ∏è</span>
                  <span>–≠–∫—Å–ø–æ—Ä—Ç</span>
                </button>
              </div>
            </div>
            <div class="table-container">
              <table id="ordersTable">
                <thead>
                  <tr>
                    <th>–¢–∞–ø—Å—ã—Ä—ã—Å ‚Ññ</th>
                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                    <th>“ö–∞–π–¥–∞–Ω ‚Üí “ö–∞–π–¥–∞</th>
                    <th>“ö–∞—à—ã“õ—Ç—ã“õ</th>
                    <th>–ë–∞“ì–∞—Å—ã</th>
                    <th>–ú”ô—Ä—Ç–µ–±–µ</th>
                    <th>“ö“±—Ä—ã–ª–¥—ã</th>
                    <th>”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä</th>
                  </tr>
                </thead>
                <tbody id="ordersTableBody">
                  <tr>
                    <td colspan="8">
                      <div class="loading">
                        <div class="spinner"></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Driver Details Modal -->
  <div class="modal-overlay" id="driverModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —Ç—É—Ä–∞–ª—ã –º”ô–ª—ñ–º–µ—Ç</h3>
        <button class="modal-close" id="closeDriverModal">‚úï</button>
      </div>
      <div class="modal-body" id="driverModalBody">
        <div class="loading">
          <div class="spinner"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="closeDriverModalBtn">–ñ–∞–±—É</button>
        <button class="btn btn-primary" id="contactDriverBtn">
          <span>üí¨</span>
          <span>–•–∞–±–∞—Ä–ª–∞—Å—É</span>
        </button>
      </div>
    </div>
  </div>

  <script>
    // ==================== THEME MANAGEMENT ====================
    function initTheme() {
      const hour = new Date().getHours();
      const savedTheme = localStorage.getItem('theme');
      
      let theme;
      if (savedTheme) {
        theme = savedTheme;
      } else {
        // Auto: 6:00-20:00 = light, 20:00-6:00 = dark
        theme = (hour >= 6 && hour < 20) ? 'light' : 'dark';
      }
      
      setTheme(theme);
    }

    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      const themeIcon = document.getElementById('themeIcon');
      if (themeIcon) {
        themeIcon.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      }
      localStorage.setItem('theme', theme);
    }

    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      setTheme(newTheme);
    }

    // Initialize theme on load
    initTheme();

    // Theme toggle button
    document.getElementById('themeToggle')?.addEventListener('click', toggleTheme);

    // ==================== TELEGRAM WEBAPP ====================
    let tg = window.Telegram?.WebApp || null;
    let adminTelegramId = null;
    let ymap = null;
    let driverMarkers = [];

    // Data storage
    let driversData = [];
    let ordersData = [];
    let summaryData = null;

    // Charts
    let ordersChart = null;
    let driversChart = null;
    let revenueChart = null;
    let statusChart = null;

    // Initialize app
    document.addEventListener('DOMContentLoaded', () => {
      initTelegram();
      initUI();
      checkAdminAccess();
    });

    function initTelegram() {
      if (tg) {
        tg.ready();
        tg.expand();
        if (tg.disableVerticalSwipes) tg.disableVerticalSwipes();
        adminTelegramId = tg.initDataUnsafe?.user?.id || null;
      }
    }

    function checkAdminAccess() {
      const adminIdDisplay = document.getElementById('adminTelegramId');
      
      if (!adminTelegramId) {
        adminIdDisplay.textContent = 'ID: –ë–µ–ª–≥—ñ—Å—ñ–∑';
        blockAccess('Telegram ID —Ç–∞–±—ã–ª–º–∞–¥—ã');
        return;
      }

      adminIdDisplay.textContent = `ID: ${adminTelegramId}`;

      // CHANGE THIS TO YOUR ADMIN ID
      if (parseInt(adminTelegramId, 10) !== 800703982) {
        blockAccess('“ö–æ–ª –∂–µ—Ç—ñ–º–¥—ñ–ª—ñ–∫ –∂–æ“õ: –¢–µ–∫ ”ô–∫—ñ–º—à—ñ–≥–µ');
        return;
      }

      // Load data
      loadAdminData();
      initMap();
    }

    function blockAccess(message) {
      document.body.innerHTML = `
        <div style="display:flex;align-items:center;justify-content:center;height:100vh;padding:40px;text-align:center;background:var(--bg-main);color:var(--text-primary);">
          <div>
            <div style="font-size:64px;margin-bottom:20px;">üîí</div>
            <h2 style="font-size:24px;margin-bottom:12px;">QazLine ”ò–∫—ñ–º—à—ñ –ü–∞–Ω–µ–ª—ñ</h2>
            <p style="color:var(--text-muted);">${message}</p>
          </div>
        </div>
      `;
    }

    // ==================== UI INITIALIZATION ====================
    function initUI() {
      // Mobile menu toggle
      const menuToggle = document.getElementById('menuToggle');
      const sidebar = document.getElementById('sidebar');
      const sidebarBackdrop = document.getElementById('sidebarBackdrop');

      menuToggle?.addEventListener('click', () => {
        sidebar.classList.toggle('open');
        sidebarBackdrop.classList.toggle('active');
      });

      sidebarBackdrop?.addEventListener('click', () => {
        sidebar.classList.remove('open');
        sidebarBackdrop.classList.remove('active');
      });

      // Navigation
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault();
          const view = item.dataset.view;
          switchView(view);
          
          // Update active state
          document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
          item.classList.add('active');
          
          // Close mobile menu
          sidebar.classList.remove('open');
          sidebarBackdrop.classList.remove('active');
        });
      });

      // Modal
      const driverModal = document.getElementById('driverModal');
      const closeDriverModal = document.getElementById('closeDriverModal');
      const closeDriverModalBtn = document.getElementById('closeDriverModalBtn');

      closeDriverModal?.addEventListener('click', () => {
        driverModal.classList.remove('active');
      });

      closeDriverModalBtn?.addEventListener('click', () => {
        driverModal.classList.remove('active');
      });

      driverModal?.addEventListener('click', (e) => {
        if (e.target === driverModal) {
          driverModal.classList.remove('active');
        }
      });
    }

    // ==================== VIEW SWITCHING ====================
    function switchView(view) {
      // Hide all views
      document.getElementById('dashboardView').style.display = 'none';
      document.getElementById('analyticsView').style.display = 'none';
      document.getElementById('driversView').style.display = 'none';
      document.getElementById('ordersView').style.display = 'none';

      // Update page title
      const titles = {
        'dashboard': '–ë–∞—Å—Ç–∞–ø“õ—ã –±–µ—Ç',
        'analytics': '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞',
        'drivers': '–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä –±–∞—Å“õ–∞—Ä—É',
        'orders': '–¢–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä –±–∞—Å“õ–∞—Ä—É',
        'settings': '–ü–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä'
      };
      document.getElementById('pageTitle').textContent = titles[view] || '–ë–∞—Å—Ç–∞–ø“õ—ã –±–µ—Ç';

      // Show selected view
      switch(view) {
        case 'dashboard':
          document.getElementById('dashboardView').style.display = 'block';
          break;
        case 'analytics':
          document.getElementById('analyticsView').style.display = 'block';
          initCharts();
          break;
        case 'drivers':
          document.getElementById('driversView').style.display = 'block';
          loadDriversTable();
          break;
        case 'orders':
          document.getElementById('ordersView').style.display = 'block';
          loadOrdersTable();
          break;
      }
    }

    // ==================== DATA LOADING ====================
    async function loadAdminData() {
      try {
        // Load summary
        const summaryRes = await fetch(`/api/admin/summary?telegram_id=${adminTelegramId}`);
        const summary = await summaryRes.json();
        
        if (summary.success || summary.data) {
          summaryData = summary.data || summary;
          updateDashboardStats(summaryData);
        }

        // Load drivers
        const driversRes = await fetch(`/api/admin/drivers?telegram_id=${adminTelegramId}`);
        const driversJson = await driversRes.json();
        driversData = driversJson.data?.drivers || driversJson.drivers || [];
        
        updateDriversOnMap();
        loadRecentActivity();

        // Load orders
        const ordersRes = await fetch(`/api/admin/orders?telegram_id=${adminTelegramId}`);
        const ordersJson = await ordersRes.json();
        ordersData = ordersJson.data?.orders || ordersJson.orders || [];
        
        loadRecentOrders();

      } catch (error) {
        console.error('”ò–∫—ñ–º—à—ñ –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ–Ω –∂“Ø–∫—Ç–µ—É —Å”ô—Ç—Å—ñ–∑ –∞—è“õ—Ç–∞–ª–¥—ã:', error);
      }
    }

    function updateDashboardStats(data) {
      const drivers = data.drivers || {};
      const orders = data.orders || {};

      document.getElementById('totalDrivers').textContent = drivers.total || 0;
      document.getElementById('approvedDrivers').textContent = drivers.approved || 0;
      document.getElementById('pendingDrivers').textContent = drivers.pending || 0;
      
      document.getElementById('totalOrders').textContent = orders.total || 0;
      document.getElementById('completedOrders').textContent = orders.completed || 0;
      document.getElementById('pendingOrders').textContent = orders.pending || 0;

      // Update badges
      document.getElementById('pendingDriversBadge').textContent = drivers.pending || 0;
      document.getElementById('pendingOrdersBadge').textContent = orders.pending || 0;

      // Calculate revenue (mock)
      const avgPrice = 5000;
      const revenue = ((orders.completed || 0) * avgPrice / 1000).toFixed(0);
      document.getElementById('totalRevenue').textContent = revenue + '–º—ã“£';

      // Active drivers (mock - 30% of approved)
      const active = Math.ceil((drivers.approved || 0) * 0.3);
      document.getElementById('activeNow').textContent = active;
      document.getElementById('mapActiveDrivers').textContent = active;
    }

    // ==================== MAP INITIALIZATION ====================
    async function initMap() {
      if (!window.ymaps3) {
        setTimeout(initMap, 500);
        return;
      }

      await ymaps3.ready;
      const {YMap, YMapDefaultSchemeLayer, YMapDefaultFeaturesLayer, YMapMarker} = ymaps3;

      const mapElement = document.getElementById('map');
      if (!mapElement) return;

      ymap = new YMap(mapElement, {
        location: {
          center: [76.889709, 43.238949], // Almaty
          zoom: 11
        },
        behaviors: ['drag', 'scrollZoom', 'dblClick', 'pinchZoom']
      });

      ymap.addChild(new YMapDefaultSchemeLayer());
      ymap.addChild(new YMapDefaultFeaturesLayer());

      updateDriversOnMap();
    }

    function updateDriversOnMap() {
      if (!ymap || !window.ymaps3) return;

      // Clear existing markers
      driverMarkers.forEach(m => ymap.removeChild(m));
      driverMarkers = [];

      const {YMapMarker} = ymaps3;

      driversData.forEach(driver => {
        if (!driver.latitude || !driver.longitude) return;

        const el = document.createElement('div');
        el.style.width = '16px';
        el.style.height = '16px';
        el.style.borderRadius = '50%';
        el.style.border = '3px solid white';
        el.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15), 0 0 0 6px rgba(16,185,129,0.2)';
        el.style.background = driver.status === 'approved' ? '#10b981' : '#f59e0b';
        el.style.cursor = 'pointer';
        el.style.transition = 'all 0.2s';

        el.addEventListener('mouseenter', () => {
          el.style.transform = 'scale(1.3)';
          el.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2), 0 0 0 8px rgba(16,185,129,0.3)';
        });

        el.addEventListener('mouseleave', () => {
          el.style.transform = 'scale(1)';
          el.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15), 0 0 0 6px rgba(16,185,129,0.2)';
        });

        el.addEventListener('click', () => {
          showDriverDetails(driver.id);
        });

        const marker = new YMapMarker({coordinates: [driver.longitude, driver.latitude]}, el);
        ymap.addChild(marker);
        driverMarkers.push(marker);
      });
    }

    // ==================== RECENT ACTIVITY ====================
    function loadRecentActivity() {
      const activityList = document.getElementById('activityList');
      
      const activities = [
        {
          icon: 'success',
          emoji: '‚úÖ',
          title: '–ñ–∞“£–∞ –∂“Ø—Ä–≥—ñ–∑—É—à—ñ –º–∞“õ“±–ª–¥–∞–Ω–¥—ã',
          description: `${driversData[0]?.first_name || '–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ'} –º–∞“õ“±–ª–¥–∞–Ω–¥—ã`,
          time: '5 –º–∏–Ω—É—Ç –±“±—Ä—ã–Ω'
        },
        {
          icon: 'info',
          emoji: 'üì¶',
          title: '–¢–∞–ø—Å—ã—Ä—ã—Å –∞—è“õ—Ç–∞–ª–¥—ã',
          description: '–¢–∞–ø—Å—ã—Ä—ã—Å ‚Ññ' + (ordersData[0]?.id?.substring(0, 8) || 'XXX') + ' —Å”ô—Ç—Ç—ñ –∂–µ—Ç–∫—ñ–∑—ñ–ª–¥—ñ',
          time: '12 –º–∏–Ω—É—Ç –±“±—Ä—ã–Ω'
        },
        {
          icon: 'warning',
          emoji: '‚è≥',
          title: '–ú–∞“õ“±–ª–¥–∞—É–¥—ã –∫“Ø—Ç—É–¥–µ',
          description: '–ñ–∞“£–∞ –∂“Ø—Ä–≥—ñ–∑—É—à—ñ —Ç—ñ—Ä–∫–µ—É—ñ “õ–∞—Ä–∞–ª—É–¥—ã –∫“Ø—Ç—É–¥–µ',
          time: '25 –º–∏–Ω—É—Ç –±“±—Ä—ã–Ω'
        }
      ];

      activityList.innerHTML = activities.map(activity => `
        <div class="activity-item">
          <div class="activity-icon ${activity.icon}">
            <span>${activity.emoji}</span>
          </div>
          <div class="activity-content">
            <div class="activity-title">${activity.title}</div>
            <div class="activity-description">${activity.description}</div>
            <div class="activity-time">${activity.time}</div>
          </div>
        </div>
      `).join('');
    }

    // ==================== RECENT ORDERS TABLE ====================
    function loadRecentOrders() {
      const tbody = document.getElementById('recentOrdersBody');
      const recentOrders = ordersData.slice(0, 5);

      if (recentOrders.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6">
              <div class="empty-state">
                <div class="empty-icon">üì¶</div>
                <div class="empty-title">”ò–∑—ñ—Ä—à–µ —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä –∂–æ“õ</div>
                <div class="empty-description">–ö–ª–∏–µ–Ω—Ç—Ç–µ—Ä ”©—Ç—ñ–Ω—ñ—à –∂–∞—Å–∞“ì–∞–Ω–¥–∞ —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä –æ—Å—ã–Ω–¥–∞ –∫”©—Ä—Å–µ—Ç—ñ–ª–µ–¥—ñ</div>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = recentOrders.map(order => `
        <tr>
          <td><strong>#${order.id.substring(0, 8)}</strong></td>
          <td>
            <div class="table-user">
              <div class="table-avatar">üë§</div>
              <div class="table-user-info">
                <div class="table-user-name">–ö–ª–∏–µ–Ω—Ç</div>
                <div class="table-user-meta">${order.contact || '–ñ–æ“õ'}</div>
              </div>
            </div>
          </td>
          <td>
            <div>${order.from_address || '–ñ–æ“õ'}</div>
            <div style="font-size: 12px; color: var(--text-muted);">‚Üì ${order.to_address || '–ñ–æ“õ'}</div>
          </td>
          <td><strong>‚Ç∏${order.price || 0}</strong></td>
          <td>${getStatusBadge(order.status)}</td>
          <td>${formatDate(order.created_at)}</td>
        </tr>
      `).join('');
    }

    // ==================== DRIVERS TABLE ====================
    function loadDriversTable() {
      const tbody = document.getElementById('driversTableBody');

      if (driversData.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="7">
              <div class="empty-state">
                <div class="empty-icon">üöö</div>
                <div class="empty-title">–¢—ñ—Ä–∫–µ–ª–≥–µ–Ω –∂“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä –∂–æ“õ</div>
                <div class="empty-description">–¢—ñ—Ä–∫–µ–ª–≥–µ–Ω–Ω–µ–Ω –∫–µ–π—ñ–Ω –∂“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä –æ—Å—ã–Ω–¥–∞ –∫”©—Ä—Å–µ—Ç—ñ–ª–µ–¥—ñ</div>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = driversData.map(driver => `
        <tr>
          <td>
            <div class="table-user">
              <div class="table-avatar">
                ${driver.profile_photo ? 
                  `<img src="/ava/${driver.profile_photo}" alt="${driver.first_name}">` : 
                  (driver.first_name?.[0] || '?').toUpperCase()}
              </div>
              <div class="table-user-info">
                <div class="table-user-name">${driver.first_name} ${driver.last_name}</div>
                <div class="table-user-meta">ID: ${driver.telegram_id}</div>
              </div>
            </div>
          </td>
          <td>${driver.contact_number || '–ñ–æ“õ'}</td>
          <td>${driver.start_city || '–ñ–æ“õ'}</td>
          <td><span class="badge badge-info">${getTruckTypeName(driver.truck_type)}</span></td>
          <td>${getStatusBadge(driver.status)}</td>
          <td>${formatDate(driver.created_at)}</td>
          <td>
            <button class="btn btn-sm btn-secondary" onclick="showDriverDetails('${driver.id}')">
              –ö”©—Ä—É
            </button>
          </td>
        </tr>
      `).join('');
    }

    // ==================== ORDERS TABLE ====================
    function loadOrdersTable() {
      const tbody = document.getElementById('ordersTableBody');

      if (ordersData.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8">
              <div class="empty-state">
                <div class="empty-icon">üì¶</div>
                <div class="empty-title">”ò–∑—ñ—Ä—à–µ —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä –∂–æ“õ</div>
                <div class="empty-description">–ö–ª–∏–µ–Ω—Ç—Ç–µ—Ä ”©—Ç—ñ–Ω—ñ—à –∂–∞—Å–∞“ì–∞–Ω–¥–∞ —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä –æ—Å—ã–Ω–¥–∞ –∫”©—Ä—Å–µ—Ç—ñ–ª–µ–¥—ñ</div>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = ordersData.map(order => `
        <tr>
          <td><strong>#${order.id.substring(0, 8)}</strong></td>
          <td>
            <div class="table-user">
              <div class="table-avatar">üë§</div>
              <div class="table-user-info">
                <div class="table-user-name">–ö–ª–∏–µ–Ω—Ç</div>
                <div class="table-user-meta">${order.contact || '–ñ–æ“õ'}</div>
              </div>
            </div>
          </td>
          <td>
            <div style="font-size: 13px;">${order.from_address || '–ñ–æ“õ'}</div>
            <div style="font-size: 12px; color: var(--text-muted);">‚Üì ${order.to_address || '–ñ–æ“õ'}</div>
          </td>
          <td>${order.distance_km ? order.distance_km.toFixed(1) + ' –∫–º' : '–ñ–æ“õ'}</td>
          <td><strong>‚Ç∏${order.price || 0}</strong></td>
          <td>${getStatusBadge(order.status)}</td>
          <td>${formatDate(order.created_at)}</td>
          <td>
            <button class="btn btn-sm btn-secondary">–¢–æ–ª—ã“õ</button>
          </td>
        </tr>
      `).join('');
    }

    // ==================== DRIVER DETAILS MODAL ====================
    function showDriverDetails(driverId) {
      const driver = driversData.find(d => d.id === driverId);
      if (!driver) return;

      const modal = document.getElementById('driverModal');
      const modalBody = document.getElementById('driverModalBody');

      modalBody.innerHTML = `
        <div class="driver-details">
          <div class="driver-photo-section">
            <div class="driver-photo">
              ${driver.profile_photo ? 
                `<img src="/ava/${driver.profile_photo}" alt="${driver.first_name}">` : 
                (driver.first_name?.[0] || '?').toUpperCase()}
            </div>
            <div class="driver-docs">
              ${driver.license_front ? `<a href="/documents/${driver.license_front}" target="_blank" class="doc-link">üìÑ –ö—É”ô–ª—ñ–∫ –∞–ª–¥—ã</a>` : ''}
              ${driver.license_back ? `<a href="/documents/${driver.license_back}" target="_blank" class="doc-link">üìÑ –ö—É”ô–ª—ñ–∫ –∞—Ä—Ç—ã</a>` : ''}
            </div>
          </div>
          <div class="driver-info-section">
            <div class="info-group">
              <div class="info-label">–¢–æ–ª—ã“õ –∞—Ç—ã</div>
              <div class="info-value">${driver.first_name} ${driver.last_name}</div>
            </div>
            <div class="info-group">
              <div class="info-label">–ë–∞–π–ª–∞–Ω—ã—Å</div>
              <div class="info-value">${driver.contact_number || '–ñ–æ“õ'}</div>
            </div>
            <div class="info-group">
              <div class="info-label">–¢—É“ì–∞–Ω –∫“Ø–Ω—ñ</div>
              <div class="info-value">${driver.birthday || '–ñ–æ“õ'}</div>
            </div>
            <div class="info-group">
              <div class="info-label">“ö–∞–ª–∞</div>
              <div class="info-value">${driver.start_city || '–ñ–æ“õ'}</div>
            </div>
            <div class="info-group">
              <div class="info-label">–ö”©–ª—ñ–∫ —Ç“Ø—Ä—ñ</div>
              <div class="info-value">${getTruckTypeName(driver.truck_type)}</div>
            </div>
            <div class="info-group">
              <div class="info-label">–ú”ô—Ä—Ç–µ–±–µ</div>
              <div class="info-value">${getStatusBadge(driver.status)}</div>
            </div>
            <div class="info-group">
              <div class="info-label">Telegram ID</div>
              <div class="info-value">${driver.telegram_id}</div>
            </div>
            <div class="info-group">
              <div class="info-label">–†–∞—Å—Ç–∞–ª“ì–∞–Ω</div>
              <div class="info-value">${driver.is_verified ? '‚úÖ –ò”ô' : '‚ùå –ñ–æ“õ'}</div>
            </div>
            <div class="info-group">
              <div class="info-label">–¢—ñ—Ä–∫–µ–ª–¥—ñ</div>
              <div class="info-value">${formatDate(driver.created_at)}</div>
            </div>
          </div>
        </div>
      `;

      modal.classList.add('active');

      // Update contact button
      const contactBtn = document.getElementById('contactDriverBtn');
      contactBtn.onclick = () => {
        if (driver.contact_number) {
          const digits = driver.contact_number.replace(/\D/g, '');
          window.open(`https://wa.me/${digits}`, '_blank');
        }
      };
    }

    // ==================== ANALYTICS CHARTS ====================
    function initCharts() {
      if (!summaryData) return;

      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      const textColor = isDark ? '#cbd5e1' : '#475569';
      const gridColor = isDark ? '#334155' : '#e2e8f0';

      // Orders chart
      const ordersData = summaryData.charts?.orders_by_day || [];
      if (ordersChart) ordersChart.destroy();
      ordersChart = new Chart(document.getElementById('ordersChart'), {
        type: 'line',
        data: {
          labels: ordersData.map(d => new Date(d.date).toLocaleDateString('kk-KZ', { month: 'short', day: 'numeric' })),
          datasets: [{
            label: '–¢–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä',
            data: ordersData.map(d => d.count),
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { color: textColor },
              grid: { color: gridColor }
            },
            x: {
              ticks: { color: textColor },
              grid: { color: gridColor }
            }
          }
        }
      });

      // Drivers chart
      const driversChartData = summaryData.charts?.drivers_by_day || [];
      if (driversChart) driversChart.destroy();
      driversChart = new Chart(document.getElementById('driversChart'), {
        type: 'bar',
        data: {
          labels: driversChartData.map(d => new Date(d.date).toLocaleDateString('kk-KZ', { month: 'short', day: 'numeric' })),
          datasets: [{
            label: '–ñ–∞“£–∞ –∂“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä',
            data: driversChartData.map(d => d.count),
            backgroundColor: 'rgba(59, 130, 246, 0.8)',
            borderRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { color: textColor },
              grid: { color: gridColor }
            },
            x: {
              ticks: { color: textColor },
              grid: { display: false }
            }
          }
        }
      });

      // Revenue chart
      if (revenueChart) revenueChart.destroy();
      revenueChart = new Chart(document.getElementById('revenueChart'), {
        type: 'line',
        data: {
          labels: ordersData.map(d => new Date(d.date).toLocaleDateString('kk-KZ', { month: 'short', day: 'numeric' })),
          datasets: [{
            label: '–¢–∞–±—ã—Å (‚Ç∏)',
            data: ordersData.map(d => d.count * 5000),
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { 
                color: textColor,
                callback: value => '‚Ç∏' + (value / 1000) + '–º—ã“£'
              },
              grid: { color: gridColor }
            },
            x: {
              ticks: { color: textColor },
              grid: { color: gridColor }
            }
          }
        }
      });

      // Status chart
      const orders = summaryData.orders || {};
      if (statusChart) statusChart.destroy();
      statusChart = new Chart(document.getElementById('statusChart'), {
        type: 'doughnut',
        data: {
          labels: ['–ê—è“õ—Ç–∞–ª“ì–∞–Ω', '–ö“Ø—Ç—É–¥–µ', '–û—Ä—ã–Ω–¥–∞–ª—É–¥–∞', '–ë–∞—Å —Ç–∞—Ä—Ç—ã–ª“ì–∞–Ω'],
          datasets: [{
            data: [
              orders.completed || 0,
              orders.pending || 0,
              orders.in_progress || 0,
              orders.cancelled || 0
            ],
            backgroundColor: [
              'rgba(16, 185, 129, 0.8)',
              'rgba(245, 158, 11, 0.8)',
              'rgba(59, 130, 246, 0.8)',
              'rgba(239, 68, 68, 0.8)'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: { color: textColor }
            }
          }
        }
      });
    }

    // ==================== HELPER FUNCTIONS ====================
    function getStatusBadge(status) {
      const badges = {
        'approved': '<span class="badge badge-success">–ú–∞“õ“±–ª–¥–∞–Ω“ì–∞–Ω</span>',
        'pending': '<span class="badge badge-warning">–ö“Ø—Ç—É–¥–µ</span>',
        'rejected': '<span class="badge badge-danger">–ë–∞—Å —Ç–∞—Ä—Ç—ã–ª“ì–∞–Ω</span>',
        'completed': '<span class="badge badge-success">–ê—è“õ—Ç–∞–ª“ì–∞–Ω</span>',
        'in_progress': '<span class="badge badge-info">–û—Ä—ã–Ω–¥–∞–ª—É–¥–∞</span>',
        'matched': '<span class="badge badge-info">–°”ô–π–∫–µ—Å—Ç–µ–Ω–¥—ñ—Ä—ñ–ª–≥–µ–Ω</span>',
        'cancelled': '<span class="badge badge-danger">–ë–∞—Å —Ç–∞—Ä—Ç—ã–ª“ì–∞–Ω</span>'
      };
      return badges[status] || `<span class="badge">${status}</span>`;
    }

    function getTruckTypeName(type) {
      const names = {
        'intercity': '“ö–∞–ª–∞ –∞—Ä–∞–ª—ã“õ',
        'small': '–ö—ñ—à—ñ (1.5—Ç)',
        'medium': '–û—Ä—Ç–∞—à–∞ (5—Ç)',
        'large': '“Æ–ª–∫–µ–Ω (20—Ç)',
        'tow': '–≠–≤–∞–∫—É–∞—Ç–æ—Ä',
        'any': '–ö–µ–∑ –∫–µ–ª–≥–µ–Ω'
      };
      return names[type] || type || '–ö–µ–∑ –∫–µ–ª–≥–µ–Ω';
    }

    function formatDate(dateString) {
      if (!dateString) return '–ñ–æ“õ';
      const date = new Date(dateString);
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);

      if (diffMins < 1) return '–î”ô–ª “õ–∞–∑—ñ—Ä';
      if (diffMins < 60) return `${diffMins} –º–∏–Ω—É—Ç –±“±—Ä—ã–Ω`;
      if (diffHours < 24) return `${diffHours} —Å–∞“ì–∞—Ç –±“±—Ä—ã–Ω`;
      if (diffDays < 7) return `${diffDays} –∫“Ø–Ω –±“±—Ä—ã–Ω`;
      
      return date.toLocaleDateString('kk-KZ', { month: 'short', day: 'numeric' });
    }

    // Auto-refresh data every 30 seconds
    setInterval(() => {
      loadAdminData();
    }, 30000);

    // Update theme on hour change
    setInterval(() => {
      if (!localStorage.getItem('theme')) {
        initTheme();
      }
    }, 60000);
  </script>
</body>
</html>