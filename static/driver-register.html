<!DOCTYPE html>
<html lang="kz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-visual" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>QazLine - –ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —Ç—ñ—Ä–∫–µ–ª—É—ñ</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    /* Figma Transportation Design System */
    :root {
      --primary: #4C6FFF;
      --primary-dark: #3D5ACC;
      --secondary: #00D9B9;
      --success: #00D395;
      --warning: #FFB800;
      --danger: #FF5C5C;
      --dark: #1A1D29;
      --dark-light: #2A2F3F;
      --grey: #6B7280;
      --grey-light: #E5E7EB;
      --white: #FFFFFF;
      --bg: #F7F8FA;
      
      --radius: 16px;
      --radius-lg: 24px;
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.12);
      
      --tg-safe-top: env(safe-area-inset-top, 0px);
      --tg-safe-bottom: env(safe-area-inset-bottom, 0px);
      --tg-viewport-stable-height: 100vh;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      height: 100%;
      overflow: hidden;
      position: fixed;
      width: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
    }

    body {
      height: var(--tg-viewport-stable-height, 100vh);
      padding-top: calc(var(--tg-safe-top, 0px) + 15px);
      padding-bottom: var(--tg-safe-bottom, 0px);
      background: var(--bg);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .container {
      max-width: 480px;
      margin: 0 auto;
      padding: 0 20px 120px;
      min-height: 100%;
    }

    /* Header */
    .header {
      text-align: center;
      padding: 20px 0 32px;
    }

    .logo-circle {
      width: 72px;
      height: 72px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border-radius: 50%;
      margin: 0 auto 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      box-shadow: var(--shadow-lg);
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .title {
      font-size: 28px;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 8px;
      letter-spacing: -0.5px;
    }

    .subtitle {
      font-size: 15px;
      color: var(--grey);
      font-weight: 500;
    }

    /* Progress Indicator */
    .progress-container {
      margin: 24px 0;
    }

    .progress-bar {
      height: 4px;
      background: var(--grey-light);
      border-radius: 2px;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 2px;
      width: 0%;
      transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .progress-text {
      margin-top: 8px;
      font-size: 13px;
      color: var(--grey);
      text-align: center;
      font-weight: 600;
    }

    /* Form Groups */
    .form-section {
      margin-bottom: 32px;
    }

    .section-title {
      font-size: 17px;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-icon {
      font-size: 20px;
    }

    /* Profile Photo */
    .photo-upload {
      text-align: center;
      margin-bottom: 24px;
    }

    .photo-preview {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: var(--grey-light);
      margin: 0 auto 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      color: var(--grey);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      border: 3px solid transparent;
    }

    .photo-preview:active {
      transform: scale(0.95);
    }

    .photo-preview.has-photo {
      border-color: var(--success);
    }

    .photo-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .photo-label {
      font-size: 14px;
      color: var(--grey);
      font-weight: 500;
    }

    .photo-input {
      display: none;
    }

    /* Form Fields */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 16px;
    }

    .form-field {
      margin-bottom: 16px;
    }

    .field-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--grey);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .field-input {
      width: 100%;
      padding: 16px;
      background: white;
      border: 2px solid transparent;
      border-radius: var(--radius);
      font-size: 16px;
      font-weight: 500;
      color: var(--dark);
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .field-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(76, 111, 255, 0.1);
    }

    .field-input::placeholder {
      color: var(--grey);
      font-weight: 400;
    }

    .field-input.error {
      border-color: var(--danger);
      background: rgba(255, 92, 92, 0.05);
    }

    .field-input.success {
      border-color: var(--success);
    }

    /* File Upload */
    .file-field {
      position: relative;
      padding: 20px;
      background: white;
      border: 2px dashed var(--grey-light);
      border-radius: var(--radius);
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .file-field:hover {
      border-color: var(--primary);
      background: rgba(76, 111, 255, 0.02);
    }

    .file-field.has-file {
      border-color: var(--success);
      border-style: solid;
      background: rgba(0, 211, 149, 0.05);
    }

    .file-icon {
      font-size: 32px;
      margin-bottom: 8px;
    }

    .file-text {
      font-size: 14px;
      color: var(--grey);
      font-weight: 500;
    }

    .file-input {
      display: none;
    }

    /* Truck Type Selection */
    .truck-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 12px;
    }

    .truck-card {
      padding: 16px 12px;
      background: white;
      border: 2px solid transparent;
      border-radius: var(--radius);
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .truck-card:active {
      transform: scale(0.95);
    }

    .truck-card.selected {
      background: rgba(76, 111, 255, 0.1);
      border-color: var(--primary);
      box-shadow: 0 4px 16px rgba(76, 111, 255, 0.2);
    }

    .truck-card.selected::after {
      content: '‚úì';
      position: absolute;
      top: 8px;
      right: 8px;
      width: 20px;
      height: 20px;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
    }

    .truck-icon {
      font-size: 28px;
      margin-bottom: 8px;
    }

    .truck-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--dark);
      margin-bottom: 2px;
    }

    .truck-desc {
      font-size: 11px;
      color: var(--grey);
    }

    /* Location Input */
    .location-group {
      position: relative;
    }

    .location-input {
      padding-right: 60px;
    }

    .gps-btn {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      width: 44px;
      height: 44px;
      background: var(--bg);
      border: none;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 18px;
    }

    .gps-btn:active {
      transform: translateY(-50%) scale(0.9);
    }

    .gps-btn.loading {
      background: var(--warning);
      color: white;
      animation: pulse 1.5s infinite;
    }

    .gps-btn.success {
      background: var(--success);
      color: white;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* Error/Success Messages */
    .field-message {
      font-size: 12px;
      margin-top: 6px;
      font-weight: 500;
      display: none;
    }

    .field-message.error {
      color: var(--danger);
      display: block;
    }

    .field-message.success {
      color: var(--success);
      display: block;
    }

    /* Submit Button (via Telegram MainButton) */
    .submit-info {
      text-align: center;
      padding: 20px;
      background: rgba(76, 111, 255, 0.05);
      border-radius: var(--radius);
      margin-top: 24px;
    }

    .submit-info-text {
      font-size: 14px;
      color: var(--grey);
      line-height: 1.6;
    }

    .submit-info-icon {
      font-size: 32px;
      margin-bottom: 8px;
    }

    /* Loading Overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(26, 29, 41, 0.8);
      backdrop-filter: blur(10px);
      z-index: 9999;
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .loading-overlay.active {
      display: flex;
    }

    .loading-spinner {
      width: 56px;
      height: 56px;
      border: 4px solid rgba(255, 255, 255, 0.2);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      color: white;
      font-size: 16px;
      font-weight: 600;
    }

    /* Responsive */
    @media (max-width: 400px) {
      .truck-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text" id="loadingText" data-kz="–ñ“Ø–∫—Ç–µ–ª—É–¥–µ..." data-ru="–ó–∞–≥—Ä—É–∑–∫–∞...">–ñ“Ø–∫—Ç–µ–ª—É–¥–µ...</div>
  </div>

  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="logo-circle">üöó</div>
      <h1 class="title" data-kz="–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —Ç—ñ—Ä–∫–µ–ª—É—ñ" data-ru="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–æ–¥–∏—Ç–µ–ª—è">–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —Ç—ñ—Ä–∫–µ–ª—É—ñ</h1>
      <p class="subtitle" data-kz="–ñ“±–º—ã—Å—Ç—ã –±–∞—Å—Ç–∞—É “Ø—à—ñ–Ω –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑" data-ru="–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã">–ñ“±–º—ã—Å—Ç—ã –±–∞—Å—Ç–∞—É “Ø—à—ñ–Ω –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑</p>
    </div>

    <!-- Progress -->
    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-text" id="progressText">0%</div>
    </div>

    <!-- Form -->
    <form id="driverForm" enctype="multipart/form-data">
      <!-- Profile Photo -->
      <div class="form-section">
        <div class="section-title">
          <span class="section-icon">üì∏</span>
          <span data-kz="–ü—Ä–æ—Ñ–∏–ª—å —Ñ–æ—Ç–æ—Å—ã" data-ru="–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è">–ü—Ä–æ—Ñ–∏–ª—å —Ñ–æ—Ç–æ—Å—ã</span>
        </div>
        <div class="photo-upload">
          <div class="photo-preview" id="photoPreview" onclick="document.getElementById('profilePhoto').click()">
            üë§
          </div>
          <div class="photo-label" data-kz="–°—É—Ä–µ—Ç—Ç—ñ –∂“Ø–∫—Ç–µ—É" data-ru="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ">–°—É—Ä–µ—Ç—Ç—ñ –∂“Ø–∫—Ç–µ—É</div>
          <input type="file" id="profilePhoto" name="profilePhoto" class="photo-input" accept="image/*" capture="environment" required>
          <div class="field-message error" id="profilePhotoError"></div>
        </div>
      </div>

      <!-- Personal Info -->
      <div class="form-section">
        <div class="section-title">
          <span class="section-icon">üë§</span>
          <span data-kz="–ñ–µ–∫–µ –º”ô–ª—ñ–º–µ—Ç—Ç–µ—Ä" data-ru="–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ">–ñ–µ–∫–µ –º”ô–ª—ñ–º–µ—Ç—Ç–µ—Ä</span>
        </div>

        <div class="form-grid">
          <div class="form-field">
            <label class="field-label" data-kz="–ê—Ç—ã" data-ru="–ò–º—è">–ê—Ç—ã</label>
            <input type="text" class="field-input" id="firstName" name="firstName" required
                   data-placeholder-kz="–ê—Ç—ã“£—ã–∑–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑" data-placeholder-ru="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
            <div class="field-message error" id="firstNameError"></div>
          </div>

          <div class="form-field">
            <label class="field-label" data-kz="–¢–µ–≥—ñ" data-ru="–§–∞–º–∏–ª–∏—è">–¢–µ–≥—ñ</label>
            <input type="text" class="field-input" id="lastName" name="lastName" required
                   data-placeholder-kz="–¢–µ–≥—ñ“£—ñ–∑–¥—ñ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑" data-placeholder-ru="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é">
            <div class="field-message error" id="lastNameError"></div>
          </div>
        </div>

        <div class="form-field">
          <label class="field-label" data-kz="–¢—É“ì–∞–Ω –∫“Ø–Ω—ñ" data-ru="–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è">–¢—É“ì–∞–Ω –∫“Ø–Ω—ñ</label>
          <input type="date" class="field-input" id="birthday" name="birthday" required max="2006-01-01">
          <div class="field-message error" id="birthdayError"></div>
        </div>

        <div class="form-field">
          <label class="field-label" data-kz="–¢–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ" data-ru="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">–¢–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ</label>
          <input type="tel" class="field-input" id="contactNumber" name="contactNumber" required
                 placeholder="+7 (___) ___-__-__">
          <div class="field-message error" id="contactNumberError"></div>
        </div>
      </div>

      <!-- Truck Type -->
      <div class="form-section">
        <div class="section-title">
          <span class="section-icon">üöö</span>
          <span data-kz="–ö”©–ª—ñ–∫ —Ç“Ø—Ä—ñ" data-ru="–¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞">–ö”©–ª—ñ–∫ —Ç“Ø—Ä—ñ</span>
        </div>
        <div class="truck-grid">
          <div class="truck-card" data-truck="intercity" onclick="selectTruck('intercity')">
            <div class="truck-icon">üöï</div>
            <div class="truck-name" data-kz="“ö–∞–ª–∞ –∞—Ä–∞–ª—ã“õ" data-ru="–ú–µ–∂–≥–æ—Ä–æ–¥">“ö–∞–ª–∞ –∞—Ä–∞–ª—ã“õ</div>
            <div class="truck-desc" data-kz="—Ç–∞–∫—Å–∏" data-ru="—Ç–∞–∫—Å–∏">—Ç–∞–∫—Å–∏</div>
          </div>
          <div class="truck-card" data-truck="small" onclick="selectTruck('small')">
            <div class="truck-icon">üöê</div>
            <div class="truck-name" data-kz="–ö—ñ—à—ñ" data-ru="–ú–∞–ª—ã–π">–ö—ñ—à—ñ</div>
            <div class="truck-desc" data-kz="1.5—Ç –¥–µ–π—ñ–Ω" data-ru="–¥–æ 1.5—Ç">1.5—Ç –¥–µ–π—ñ–Ω</div>
          </div>
          <div class="truck-card" data-truck="medium" onclick="selectTruck('medium')">
            <div class="truck-icon">üöö</div>
            <div class="truck-name" data-kz="–û—Ä—Ç–∞—à–∞" data-ru="–°—Ä–µ–¥–Ω–∏–π">–û—Ä—Ç–∞—à–∞</div>
            <div class="truck-desc" data-kz="5—Ç –¥–µ–π—ñ–Ω" data-ru="–¥–æ 5—Ç">5—Ç –¥–µ–π—ñ–Ω</div>
          </div>
          <div class="truck-card" data-truck="large" onclick="selectTruck('large')">
            <div class="truck-icon">üöõ</div>
            <div class="truck-name" data-kz="“Æ–ª–∫–µ–Ω" data-ru="–ë–æ–ª—å—à–æ–π">“Æ–ª–∫–µ–Ω</div>
            <div class="truck-desc" data-kz="20—Ç –¥–µ–π—ñ–Ω" data-ru="–¥–æ 20—Ç">20—Ç –¥–µ–π—ñ–Ω</div>
          </div>
          <div class="truck-card" data-truck="tow" onclick="selectTruck('tow')">
            <div class="truck-icon">üîß</div>
            <div class="truck-name" data-kz="–≠–≤–∞–∫—É–∞—Ç–æ—Ä" data-ru="–≠–≤–∞–∫—É–∞—Ç–æ—Ä">–≠–≤–∞–∫—É–∞—Ç–æ—Ä</div>
            <div class="truck-desc" data-kz="—ç–≤–∞–∫—É–∞—Ü–∏—è" data-ru="—ç–≤–∞–∫—É–∞—Ü–∏—è">—ç–≤–∞–∫—É–∞—Ü–∏—è</div>
          </div>
          <div class="truck-card" data-truck="any" onclick="selectTruck('any')">
            <div class="truck-icon">üöô</div>
            <div class="truck-name" data-kz="–ö–µ–∑ –∫–µ–ª–≥–µ–Ω" data-ru="–õ—é–±–æ–π">–ö–µ–∑ –∫–µ–ª–≥–µ–Ω</div>
            <div class="truck-desc" data-kz="–∂–∞—Ä–∞–π–¥—ã" data-ru="–ø–æ–¥–æ–π–¥–µ—Ç">–∂–∞—Ä–∞–π–¥—ã</div>
          </div>
        </div>
        <input type="hidden" id="truckType" name="truckType" required>
        <div class="field-message error" id="truckTypeError"></div>
      </div>

      <!-- Documents -->
      <div class="form-section">
        <div class="section-title">
          <span class="section-icon">üìÑ</span>
          <span data-kz="“ö“±–∂–∞—Ç—Ç–∞—Ä" data-ru="–î–æ–∫—É–º–µ–Ω—Ç—ã">“ö“±–∂–∞—Ç—Ç–∞—Ä</span>
        </div>

        <div class="form-field">
          <label class="field-label" data-kz="–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –∫—É”ô–ª—ñ–≥—ñ (–∞–ª–¥—ã“£“ì—ã –∂–∞“ì—ã)" data-ru="–ü—Ä–∞–≤–∞ (–ª–∏—Ü–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞)">–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –∫—É”ô–ª—ñ–≥—ñ (–∞–ª–¥—ã“£“ì—ã –∂–∞“ì—ã)</label>
          <div class="file-field" id="licenseFrontField" onclick="document.getElementById('licenseFront').click()">
            <div class="file-icon">üìã</div>
            <div class="file-text" data-kz="“ö“±–∂–∞—Ç—Ç—ã –∂“Ø–∫—Ç–µ—É" data-ru="–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç">“ö“±–∂–∞—Ç—Ç—ã –∂“Ø–∫—Ç–µ—É</div>
          </div>
          <input type="file" id="licenseFront" name="licenseFront" class="file-input" accept="image/*,.pdf" required>
          <div class="field-message error" id="licenseFrontError"></div>
        </div>

        <div class="form-field">
          <label class="field-label" data-kz="–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –∫—É”ô–ª—ñ–≥—ñ (–∞—Ä—Ç“õ—ã –∂–∞“ì—ã)" data-ru="–ü—Ä–∞–≤–∞ (–æ–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞)">–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –∫—É”ô–ª—ñ–≥—ñ (–∞—Ä—Ç“õ—ã –∂–∞“ì—ã)</label>
          <div class="file-field" id="licenseBackField" onclick="document.getElementById('licenseBack').click()">
            <div class="file-icon">üìã</div>
            <div class="file-text" data-kz="“ö“±–∂–∞—Ç—Ç—ã –∂“Ø–∫—Ç–µ—É" data-ru="–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç">“ö“±–∂–∞—Ç—Ç—ã –∂“Ø–∫—Ç–µ—É</div>
          </div>
          <input type="file" id="licenseBack" name="licenseBack" class="file-input" accept="image/*,.pdf" required>
          <div class="field-message error" id="licenseBackError"></div>
        </div>
      </div>

      <!-- Location -->
      <div class="form-section">
        <div class="section-title">
          <span class="section-icon">üìç</span>
          <span data-kz="–ñ“±–º—ã—Å “õ–∞–ª–∞—Å—ã" data-ru="–ì–æ—Ä–æ–¥ —Ä–∞–±–æ—Ç—ã">–ñ“±–º—ã—Å “õ–∞–ª–∞—Å—ã</span>
        </div>

        <div class="form-field">
          <label class="field-label" data-kz="“ö–∞–ª–∞" data-ru="–ì–æ—Ä–æ–¥">“ö–∞–ª–∞</label>
          <div class="location-group">
            <input type="text" class="field-input location-input" id="startCity" name="startCity" required
                   data-placeholder-kz="“ö–∞–ª–∞–Ω—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑" data-placeholder-ru="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥">
            <button type="button" class="gps-btn" id="gpsBtn" 
                    data-title-kz="–û—Ä–Ω–∞–ª–∞—Å“õ–∞–Ω –∂–µ—Ä–¥—ñ –∞–Ω—ã“õ—Ç–∞—É" 
                    data-title-ru="–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ">üìç</button>
          </div>
          <div class="field-message error" id="startCityError"></div>
          <div class="field-message success" id="startCitySuccess"></div>
        </div>
      </div>

      <!-- Submit Info -->
      <div class="submit-info">
        <div class="submit-info-icon">‚úÖ</div>
        <div class="submit-info-text" data-kz="–ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä“ì–∞–Ω–Ω–∞–Ω –∫–µ–π—ñ–Ω, —Ç”©–º–µ–Ω–¥–µ–≥—ñ –±–∞—Ç—ã—Ä–º–∞–Ω—ã –±–∞—Å—ã“£—ã–∑" data-ru="–ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ">
          –ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä“ì–∞–Ω–Ω–∞–Ω –∫–µ–π—ñ–Ω, —Ç”©–º–µ–Ω–¥–µ–≥—ñ –±–∞—Ç—ã—Ä–º–∞–Ω—ã –±–∞—Å—ã“£—ã–∑
        </div>
      </div>

      <!-- Hidden fields -->
      <input type="hidden" id="latitude" name="latitude">
      <input type="hidden" id="longitude" name="longitude">
      <input type="hidden" id="telegramId" name="telegramId">
    </form>
  </div>

  <script>
    // Global state
    let currentLang = 'kz'; // Will be set from URL params
    let selectedTruckType = null;

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      initLanguage();
      initializeTelegram();
      setupEventListeners();
      updateProgress();
    });

    // Language initialization from URL params
    function initLanguage() {
      const urlParams = new URLSearchParams(window.location.search);
      const lang = urlParams.get('lang');
      if (lang === 'kz' || lang === 'ru') {
        currentLang = lang;
      }
      applyTranslations();
    }

    // Apply translations
    function applyTranslations() {
      document.querySelectorAll('[data-kz]').forEach(el => {
        const text = el.getAttribute('data-' + currentLang);
        if (text) {
          if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
            el.placeholder = text;
          } else {
            el.textContent = text;
          }
        }
      });
    }

    // Initialize Telegram WebApp
    function initializeTelegram() {
      if (window.Telegram && Telegram.WebApp) {
        const tg = Telegram.WebApp;
        tg.ready();
        tg.expand();
        tg.enableClosingConfirmation();
        tg.disableVerticalSwipes();

        // Update viewport height
        const updateHeight = () => {
          const vh = tg.viewportStableHeight || window.innerHeight;
          document.documentElement.style.setProperty('--tg-viewport-stable-height', vh + 'px');
          document.documentElement.style.setProperty('--tg-safe-top', (tg.safeAreaInset?.top || 0) + 'px');
          document.documentElement.style.setProperty('--tg-safe-bottom', (tg.safeAreaInset?.bottom || 0) + 'px');
        };
        updateHeight();
        tg.onEvent('viewportChanged', updateHeight);

        // Get user data
        const user = tg.initDataUnsafe?.user;
        if (user) {
          document.getElementById('telegramId').value = user.id;
        }

        // Theme
        if (tg.colorScheme === 'dark') {
          document.documentElement.style.setProperty('--bg', '#1A1D29');
          document.documentElement.style.setProperty('--dark', '#FFFFFF');
        }

        // Main button
        tg.MainButton.hide();
      }
    }

    // Setup event listeners
    function setupEventListeners() {
      const form = document.getElementById('driverForm');
      const inputs = form.querySelectorAll('input[required]');
      
      inputs.forEach(input => {
        input.addEventListener('blur', () => validateField(input));
        input.addEventListener('input', updateProgress);
      });

      // Profile photo
      document.getElementById('profilePhoto').addEventListener('change', handlePhotoChange);

      // File uploads
      document.getElementById('licenseFront').addEventListener('change', (e) => handleFileChange(e, 'licenseFrontField'));
      document.getElementById('licenseBack').addEventListener('change', (e) => handleFileChange(e, 'licenseBackField'));

      // Phone formatting
      document.getElementById('contactNumber').addEventListener('input', formatPhone);

      // GPS button
      document.getElementById('gpsBtn').addEventListener('click', getCurrentLocation);
    }

    // Truck selection
    function selectTruck(type) {
      selectedTruckType = type;
      document.getElementById('truckType').value = type;
      
      // Update UI
      document.querySelectorAll('.truck-card').forEach(card => {
        card.classList.remove('selected');
      });
      document.querySelector(`[data-truck="${type}"]`).classList.add('selected');
      
      // Clear error
      document.getElementById('truckTypeError').style.display = 'none';
      
      updateProgress();
    }

    // Handle photo change
    function handlePhotoChange(e) {
      const file = e.target.files[0];
      if (file) {
        // Validate size
        if (file.size > 3 * 1024 * 1024) {
          showError('profilePhotoError', currentLang === 'kz' ? 
            '–§–∞–π–ª —Ç—ã–º “Ø–ª–∫–µ–Ω (–º–∞–∫—Å. 3–ú–ë)' : 
            '–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 3–ú–ë)');
          return;
        }

        // Preview
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('photoPreview').innerHTML = `<img src="${e.target.result}" alt="Profile">`;
          document.getElementById('photoPreview').classList.add('has-photo');
        };
        reader.readAsDataURL(file);
        
        validateField(e.target);
        updateProgress();
      }
    }

    // Handle file change
    function handleFileChange(e, fieldId) {
      const file = e.target.files[0];
      const field = document.getElementById(fieldId);
      
      if (file) {
        // Validate size
        if (file.size > 3 * 1024 * 1024) {
          const errorId = e.target.id + 'Error';
          showError(errorId, currentLang === 'kz' ? 
            '–§–∞–π–ª —Ç—ã–º “Ø–ª–∫–µ–Ω (–º–∞–∫—Å. 3–ú–ë)' : 
            '–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 3–ú–ë)');
          return;
        }

        field.classList.add('has-file');
        field.querySelector('.file-text').textContent = file.name;
        field.querySelector('.file-icon').textContent = '‚úÖ';
        
        validateField(e.target);
        updateProgress();
      }
    }

    // Format phone
    function formatPhone(e) {
      let value = e.target.value.replace(/\D/g, '');
      
      if (value.length > 0) {
        if (value.startsWith('8')) value = '7' + value.substring(1);
        if (!value.startsWith('7')) value = '7' + value;
        
        let formatted = '+7';
        if (value.length > 1) {
          formatted += ' (' + value.substring(1, 4);
          if (value.length > 4) {
            formatted += ') ' + value.substring(4, 7);
            if (value.length > 7) {
              formatted += '-' + value.substring(7, 9);
              if (value.length > 9) {
                formatted += '-' + value.substring(9, 11);
              }
            }
          } else if (value.length > 1) {
            formatted += ')';
          }
        }
        e.target.value = formatted;
      }
      
      validateField(e.target);
    }

    // Get current location
    function getCurrentLocation() {
      const btn = document.getElementById('gpsBtn');
      const input = document.getElementById('startCity');
      
      if (!navigator.geolocation) {
        showError('startCityError', currentLang === 'kz' ? 
          '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è “õ–æ–ª–¥–∞—É –∫”©—Ä—Å–µ—Ç—ñ–ª–º–µ–π–¥—ñ' : 
          '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
        return;
      }
      
      btn.classList.add('loading');
      btn.textContent = '‚è≥';
      
      navigator.geolocation.getCurrentPosition(
        async function(position) {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          
          try {
            const response = await fetch(
              `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&addressdetails=1`
            );
            const data = await response.json();
            
            if (data && data.address) {
              const city = data.address.city || data.address.town || data.address.village || data.address.state;
              input.value = city || data.display_name.split(',')[0];
              document.getElementById('latitude').value = lat;
              document.getElementById('longitude').value = lon;
              
              btn.classList.remove('loading');
              btn.classList.add('success');
              btn.textContent = '‚úÖ';
              
              showSuccess('startCitySuccess', currentLang === 'kz' ? 
                '–û—Ä–Ω–∞–ª–∞—Å“õ–∞–Ω –∂–µ—Ä –∞–Ω—ã“õ—Ç–∞–ª–¥—ã' : 
                '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ');
              
              setTimeout(() => {
                btn.classList.remove('success');
                btn.textContent = 'üìç';
              }, 2000);
              
              validateField(input);
              updateProgress();
            }
          } catch (error) {
            console.error('Reverse geocoding error:', error);
            showError('startCityError', currentLang === 'kz' ? 
              '“ö–∞–ª–∞–Ω—ã –∞–Ω—ã“õ—Ç–∞—É–¥–∞ “õ–∞—Ç–µ' : 
              '–û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞');
            btn.classList.remove('loading');
            btn.textContent = 'üìç';
          }
        },
        function(error) {
          console.error('Geolocation error:', error);
          let errorMsg = currentLang === 'kz' ? '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è “õ–∞—Ç–µ—Å—ñ' : '–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏';
          
          switch(error.code) {
            case error.PERMISSION_DENIED:
              errorMsg = currentLang === 'kz' ? 
                '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è“ì–∞ –∫—ñ—Ä—É —Ç—ã–π—ã–º —Å–∞–ª—ã–Ω“ì–∞–Ω' : 
                '–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω';
              break;
            case error.POSITION_UNAVAILABLE:
              errorMsg = currentLang === 'kz' ? 
                '–û—Ä–Ω–∞–ª–∞—Å“õ–∞–Ω –∂–µ—Ä “õ–æ–ª–∂–µ—Ç—ñ–º–¥—ñ –µ–º–µ—Å' : 
                '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
              break;
            case error.TIMEOUT:
              errorMsg = currentLang === 'kz' ? 
                '–ö“Ø—Ç—É —É–∞“õ—ã—Ç—ã –∞—è“õ—Ç–∞–ª–¥—ã' : 
                '–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ';
              break;
          }
          
          showError('startCityError', errorMsg);
          btn.classList.remove('loading');
          btn.textContent = 'üìç';
        },
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    }

    // Validate field
    function validateField(field) {
      const value = field.value.trim();
      const fieldId = field.id;
      let isValid = true;
      let errorMsg = '';

      // Clear states
      field.classList.remove('error', 'success');
      document.getElementById(fieldId + 'Error').style.display = 'none';

      // Required check
      if (field.hasAttribute('required') && !value && field.type !== 'file') {
        isValid = false;
        errorMsg = currentLang === 'kz' ? '–ë“±–ª ”©—Ä—ñ—Å –º—ñ–Ω–¥–µ—Ç—Ç—ñ' : '–≠—Ç–æ –ø–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ';
      }

      // File check
      if (field.type === 'file' && field.hasAttribute('required')) {
        if (field.files.length === 0) {
          isValid = false;
          errorMsg = currentLang === 'kz' ? '–§–∞–π–ª –º—ñ–Ω–¥–µ—Ç—Ç—ñ' : '–§–∞–π–ª –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω';
        } else {
          const file = field.files[0];
          if (file.size > 3 * 1024 * 1024) {
            isValid = false;
            errorMsg = currentLang === 'kz' ? 
              `–§–∞–π–ª —Ç—ã–º “Ø–ª–∫–µ–Ω (–º–∞–∫—Å. 3–ú–ë)` :
              `–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 3–ú–ë)`;
          }
        }
      }

      // Specific validations
      switch (fieldId) {
        case 'firstName':
        case 'lastName':
          if (value && (value.length < 2 || value.length > 50)) {
            isValid = false;
            errorMsg = currentLang === 'kz' ? '2-–¥–µ–Ω 50-–≥–µ –¥–µ–π—ñ–Ω —Å–∏–º–≤–æ–ª' : '–û—Ç 2 –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤';
          }
          break;
          
        case 'birthday':
          if (value) {
            const birthDate = new Date(value);
            const age = new Date().getFullYear() - birthDate.getFullYear();
            if (age < 18 || age > 80) {
              isValid = false;
              errorMsg = currentLang === 'kz' ? 
                '–ñ–∞—Å—ã 18-–¥–µ–Ω 80-–≥–µ –¥–µ–π—ñ–Ω –±–æ–ª—É—ã –∫–µ—Ä–µ–∫' : 
                '–í–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 18 –¥–æ 80 –ª–µ—Ç';
            }
          }
          break;
          
        case 'contactNumber':
          const phoneRegex = /^\+7 \(\d{3}\) \d{3}-\d{2}-\d{2}$/;
          if (value && !phoneRegex.test(value)) {
            isValid = false;
            errorMsg = currentLang === 'kz' ? 
              '–ù”©–º—ñ—Ä —Ñ–æ—Ä–º–∞—Ç—ã –¥“±—Ä—ã—Å –µ–º–µ—Å' : 
              '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞';
          }
          break;

        case 'truckType':
          if (!selectedTruckType) {
            isValid = false;
            errorMsg = currentLang === 'kz' ? 
              '–ö”©–ª—ñ–∫ —Ç“Ø—Ä—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑' : 
              '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞';
          }
          break;
      }

      // Apply state
      if (isValid && (value || field.files.length > 0)) {
        field.classList.add('success');
      } else if (!isValid) {
        field.classList.add('error');
        showError(fieldId + 'Error', errorMsg);
      }

      return isValid;
    }

    // Show error
    function showError(elementId, message) {
      const el = document.getElementById(elementId);
      if (el) {
        el.textContent = message;
        el.classList.add('error');
        el.style.display = 'block';
      }
    }

    // Show success
    function showSuccess(elementId, message) {
      const el = document.getElementById(elementId);
      if (el) {
        el.textContent = message;
        el.classList.add('success');
        el.style.display = 'block';
        setTimeout(() => {
          el.style.display = 'none';
        }, 3000);
      }
    }

    // Update progress
    function updateProgress() {
      const form = document.getElementById('driverForm');
      const requiredFields = form.querySelectorAll('input[required]');
      let filledFields = 0;
      
      requiredFields.forEach(field => {
        if (field.type === 'file') {
          if (field.files.length > 0) filledFields++;
        } else if (field.id === 'truckType') {
          if (selectedTruckType) filledFields++;
        } else if (field.value.trim()) {
          filledFields++;
        }
      });
      
      const progress = Math.round((filledFields / requiredFields.length) * 100);
      document.getElementById('progressFill').style.width = progress + '%';
      document.getElementById('progressText').textContent = progress + '%';
      
      // Show/hide Telegram main button
      if (window.Telegram && Telegram.WebApp) {
        if (progress === 100) {
          const buttonText = currentLang === 'kz' ? '–¢—ñ—Ä–∫–µ–ª—É' : '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è';
          Telegram.WebApp.MainButton.setText(buttonText);
          Telegram.WebApp.MainButton.show();
          Telegram.WebApp.MainButton.offClick(submitForm);
          Telegram.WebApp.MainButton.onClick(submitForm);
        } else {
          Telegram.WebApp.MainButton.hide();
        }
      }
    }

    // Submit form
    async function submitForm() {
      const form = document.getElementById('driverForm');
      
      // Get Telegram ID
      const telegramId = document.getElementById('telegramId').value;
      if (!telegramId) {
        if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
          document.getElementById('telegramId').value = Telegram.WebApp.initDataUnsafe.user.id;
        } else {
          alert(currentLang === 'kz' ? 
            '“ö–∞—Ç–µ: Telegram –ø–∞–π–¥–∞–ª–∞–Ω—É—à—ã ID –∞–ª—ã–Ω–±–∞–¥—ã' :
            '–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram');
          return;
        }
      }
      
      // Validate all fields
      let isFormValid = true;
      const requiredFields = form.querySelectorAll('input[required]');
      
      requiredFields.forEach(field => {
        if (!validateField(field)) {
          isFormValid = false;
        }
      });

      // Validate truck type
      if (!selectedTruckType) {
        isFormValid = false;
        showError('truckTypeError', currentLang === 'kz' ? 
          '–ö”©–ª—ñ–∫ —Ç“Ø—Ä—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑' : 
          '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞');
      }
      
      if (!isFormValid) {
        alert(currentLang === 'kz' ? 
          '–ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ –¥“±—Ä—ã—Å —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑' :
          '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
        return;
      }
      
      // Show loading
      showLoading(currentLang === 'kz' ? '–¢—ñ—Ä–∫–µ–ª—É–¥–µ...' : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...');
      
      try {
        const formData = new FormData(form);
        
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 90000);
        
        const response = await fetch('/api/driver/register', {
          method: 'POST',
          body: formData,
          signal: controller.signal
        });
        
        clearTimeout(timeoutId);
        const result = await response.json();
        
        hideLoading();
        
        if (response.ok && result.success) {
          const successMsg = currentLang === 'kz' ? 
            '–¢—ñ—Ä–∫–µ–ª—É —Å”ô—Ç—Ç—ñ! –†–∞—Å—Ç–∞—É–¥—ã –∫“Ø—Ç—ñ“£—ñ–∑.' :
            '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.';
          
          if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.showAlert(successMsg, () => Telegram.WebApp.close());
          } else {
            alert(successMsg);
          }
        } else {
          throw new Error(result.message || 'Registration failed');
        }
      } catch (error) {
        hideLoading();
        console.error('Registration error:', error);
        
        let errorMsg;
        if (error.name === 'AbortError') {
          errorMsg = currentLang === 'kz' ? 
            '–ñ“Ø–∫—Ç–µ—É —É–∞“õ—ã—Ç—ã –∞—è“õ—Ç–∞–ª–¥—ã. –§–∞–π–ª –∫”©–ª–µ–º—ñ–Ω –∞–∑–∞–π—Ç—ã–ø –∫”©—Ä—ñ“£—ñ–∑.' :
            '–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–µ–∫–ª–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤.';
        } else {
          errorMsg = currentLang === 'kz' ? 
            `–¢—ñ—Ä–∫–µ–ª—É “õ–∞—Ç–µ—Å—ñ: ${error.message}` :
            `–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${error.message}`;
        }
        
        if (window.Telegram && Telegram.WebApp) {
          Telegram.WebApp.showAlert(errorMsg);
        } else {
          alert(errorMsg);
        }
      }
    }

    // Show/hide loading
    function showLoading(text) {
      document.getElementById('loadingText').textContent = text;
      document.getElementById('loadingOverlay').classList.add('active');
      if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.MainButton.showProgress();
      }
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').classList.remove('active');
      if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.MainButton.hideProgress();
      }
    }

    // Make functions global
    window.selectTruck = selectTruck;
  </script>
</body>
</html>