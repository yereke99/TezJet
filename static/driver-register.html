<!DOCTYPE html>
<html lang="kz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-visual" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Alash-Go - –ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —Ç—ñ—Ä–∫–µ–ª—É—ñ</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root {
      --primary: #4C6FFF;
      --primary-dark: #3D5ACC;
      --primary-light: rgba(76, 111, 255, 0.15);
      --secondary: #00D9B9;
      --success: #00D395;
      --success-light: rgba(0, 211, 149, 0.15);
      --warning: #FFB800;
      --warning-light: rgba(255, 184, 0, 0.12);
      --danger: #FF5C5C;
      --danger-light: rgba(255, 92, 92, 0.12);

      --dark: #1A1D29;
      --dark-light: #2A2F3F;
      --grey: #6B7280;
      --grey-light: #E5E7EB;
      --white: #FFFFFF;
      --bg: #F7F8FA;

      --surface: var(--white);
      --surface-2: #F1F5F9;
      --border: rgba(15, 23, 42, 0.08);
      --input-bg: var(--white);
      --input-text: var(--dark);
      --placeholder: #9CA3AF;

      --radius-sm: 12px;
      --radius: 16px;
      --radius-lg: 24px;
      --radius-xl: 28px;
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.12);
      --shadow-btn: 0 4px 16px rgba(76, 111, 255, 0.35);

      --tg-safe-top: env(safe-area-inset-top, 0px);
      --tg-safe-bottom: env(safe-area-inset-bottom, 0px);
      --tg-viewport-stable-height: 100vh;
    }

    html[data-theme="dark"] {
      --bg: #0B1220;
      --white: #121A2B;
      --surface: #121A2B;
      --surface-2: #0F172A;
      --dark: #E5E7EB;
      --dark-light: #94A3B8;
      --grey: #9CA3AF;
      --grey-light: #1F2937;
      --border: rgba(148, 163, 184, 0.18);
      --input-bg: #0F172A;
      --input-text: #E5E7EB;
      --placeholder: #64748B;
      --shadow: 0 8px 28px rgba(0, 0, 0, 0.35);
      --shadow-lg: 0 12px 50px rgba(0, 0, 0, 0.45);
      --shadow-btn: 0 4px 20px rgba(76, 111, 255, 0.4);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      height: 100%;
      overflow: hidden;
      position: fixed;
      width: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--dark);
    }

    body {
      height: var(--tg-viewport-stable-height, 100vh);
      padding-top: calc(var(--tg-safe-top, 0px) + 12px);
      padding-bottom: var(--tg-safe-bottom, 0px);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    body.modal-open { overflow: hidden !important; }

    .container {
      max-width: 560px;
      margin: 0 auto;
      padding: 0 16px 140px;
      min-height: 100%;
    }

    .header { text-align: center; padding: 16px 0 20px; }

    .tg-avatar-wrap { display: flex; justify-content: center; margin-bottom: 12px; }

    .tg-avatar {
      width: 80px; height: 80px; border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex; align-items: center; justify-content: center;
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      border: 3px solid rgba(255,255,255,0.2);
      font-size: 32px; color: #fff; font-weight: 800;
    }
    .tg-avatar img { width: 100%; height: 100%; object-fit: cover; }

    .tg-username { font-size: 13px; font-weight: 700; color: var(--grey); margin-bottom: 8px; }

    .title {
      font-size: clamp(24px, 6vw, 30px);
      font-weight: 800;
      color: var(--dark);
      margin-bottom: 6px;
      letter-spacing: -0.5px;
    }
    .subtitle {
      font-size: clamp(13px, 3.5vw, 15px);
      color: var(--grey);
      font-weight: 500;
      line-height: 1.4;
      padding: 0 10px;
    }

    .notice {
      margin: 16px 0;
      padding: 14px;
      border-radius: var(--radius);
      border: 1px solid rgba(255,184,0,0.25);
      background: var(--warning-light);
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }
    .notice-icon {
      width: 32px; height: 32px; border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      background: rgba(255,184,0,0.2);
      font-size: 16px; flex-shrink: 0;
    }
    .notice-title {
      font-weight: 800; font-size: 12px; color: var(--dark);
      margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px;
    }
    .notice-text { font-size: 13px; color: var(--grey); line-height: 1.5; font-weight: 500; }

    .progress-container { margin: 16px 0 24px; }
    .progress-bar { height: 6px; background: var(--grey-light); border-radius: 3px; overflow: hidden; }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 3px;
      width: 0%;
      transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .progress-text { margin-top: 8px; font-size: 13px; color: var(--grey); text-align: center; font-weight: 700; }

    .form-section { margin-bottom: 28px; }
    .section-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
    .section-icon {
      width: 36px; height: 36px; border-radius: var(--radius-sm);
      background: var(--primary-light);
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
    }
    .section-title { font-size: 17px; font-weight: 800; color: var(--dark); }

    .section-hint {
      margin-bottom: 16px;
      padding: 12px;
      border-radius: var(--radius-sm);
      background: var(--surface-2);
      border: 1px solid var(--border);
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }
    .hint-icon { font-size: 14px; flex-shrink: 0; margin-top: 1px; }
    .hint-text { font-size: 12px; color: var(--grey); line-height: 1.5; font-weight: 500; }

    .photo-upload { text-align: center; margin-bottom: 16px; }
    .photo-preview {
      width: 110px; height: 110px; border-radius: 50%;
      background: var(--surface-2);
      margin: 0 auto 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 44px; color: var(--grey);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      border: 3px dashed var(--grey-light);
    }
    .photo-preview:active { transform: scale(0.96); }
    .photo-preview.has-photo { border: 3px solid var(--success); }
    .photo-preview img { width: 100%; height: 100%; object-fit: cover; }
    .photo-label { font-size: 13px; color: var(--grey); font-weight: 600; }
    .photo-input, .file-input { display: none; }

    .form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
    .form-field { margin-bottom: 16px; }

    .field-label {
      display: block;
      font-size: 12px;
      font-weight: 700;
      color: var(--grey);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .field-input {
      width: 100%;
      padding: 14px 16px;
      background: var(--input-bg);
      border: 2px solid var(--border);
      border-radius: var(--radius);
      font-size: 16px;
      font-weight: 600;
      color: var(--input-text);
      transition: all 0.25s ease;
      font-family: inherit;
      -webkit-text-fill-color: var(--input-text);
      caret-color: var(--primary);
    }
    .field-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--primary-light);
    }
    .field-input::placeholder { color: var(--placeholder); font-weight: 500; -webkit-text-fill-color: var(--placeholder); }

    .field-input.error { border-color: var(--danger); background: var(--danger-light); }
    .field-input.success { border-color: var(--success); }
    .field-input.pending { border-color: var(--warning); background: var(--warning-light); }

    .field-note { margin-top: 8px; display: flex; gap: 8px; align-items: flex-start; }
    .note-icon { font-size: 12px; flex-shrink: 0; margin-top: 1px; }
    .note-text { font-size: 11px; color: var(--grey); line-height: 1.4; font-weight: 500; }

    .field-message { font-size: 12px; margin-top: 6px; font-weight: 700; display: none; }
    .field-message.error { color: var(--danger); display: block; }
    .field-message.success { color: var(--success); display: block; }
    .field-message.pending { color: var(--warning); display: block; }

    .file-field {
      position: relative;
      padding: 18px;
      background: var(--surface);
      border: 2px dashed var(--grey-light);
      border-radius: var(--radius);
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .file-field:active { transform: scale(0.98); }
    .file-field:hover { border-color: var(--primary); background: var(--primary-light); }
    .file-field.has-file { border-color: var(--success); border-style: solid; background: var(--success-light); }
    .file-icon { font-size: 28px; margin-bottom: 6px; }
    .file-text { font-size: 13px; color: var(--grey); font-weight: 600; word-break: break-word; }

    .truck-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .truck-card {
      padding: 14px 8px;
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: var(--radius);
      text-align: center;
      cursor: pointer;
      transition: all 0.25s ease;
      position: relative;
    }
    .truck-card:active { transform: scale(0.95); }
    .truck-card.selected {
      background: var(--primary-light);
      border-color: var(--primary);
      box-shadow: var(--shadow-btn);
    }
    .truck-card.selected::after {
      content: '‚úì';
      position: absolute;
      top: 6px; right: 6px;
      width: 18px; height: 18px;
      background: var(--primary);
      color: #fff;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 10px;
      font-weight: 800;
    }
    .truck-icon { font-size: 26px; margin-bottom: 6px; }
    .truck-name { font-size: 12px; font-weight: 800; color: var(--dark); margin-bottom: 2px; }
    .truck-desc { font-size: 10px; color: var(--grey); font-weight: 600; }

    .location-group { position: relative; }
    .location-input { padding-right: 56px; }
    .gps-btn {
      position: absolute;
      right: 6px; top: 50%;
      transform: translateY(-50%);
      width: 42px; height: 42px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border: none;
      border-radius: var(--radius-sm);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 18px;
      color: #fff;
      box-shadow: var(--shadow-btn);
    }
    .gps-btn:active { transform: translateY(-50%) scale(0.92); }
    .gps-btn.loading { background: linear-gradient(135deg, var(--warning), #E5A600); animation: pulse 1.2s infinite; }
    .gps-btn.success { background: linear-gradient(135deg, var(--success), #00B080); }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: translateY(-50%) scale(1); }
      50% { opacity: 0.7; transform: translateY(-50%) scale(0.96); }
    }

    .offerta-card {
      margin-top: 16px;
      padding: 14px;
      border-radius: var(--radius-lg);
      background: var(--surface);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }
    .offerta-top { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 10px; }
    .offerta-title { display: flex; align-items: center; gap: 10px; font-weight: 900; letter-spacing: -0.2px; }
    .offerta-title .ic {
      width: 36px; height: 36px; border-radius: var(--radius-sm);
      background: var(--primary-light);
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
    }
    .offerta-title .tx { font-size: 15px; color: var(--dark); }

    .offerta-open {
      border: none; cursor: pointer;
      padding: 10px 12px;
      border-radius: 14px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: #fff;
      font-weight: 800;
      box-shadow: var(--shadow-btn);
      font-size: 12px;
      transition: transform 0.2s ease;
      white-space: nowrap;
    }
    .offerta-open:active { transform: scale(0.97); }
    .offerta-text { font-size: 12px; color: var(--grey); line-height: 1.55; font-weight: 600; margin-bottom: 12px; }

    .agree-row {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      padding: 12px;
      border-radius: var(--radius);
      background: var(--surface-2);
      border: 1px solid var(--border);
    }

    .agree-check {
      width: 22px; height: 22px;
      border-radius: 7px;
      border: 2px solid var(--border);
      background: var(--input-bg);
      display: inline-flex;
      align-items: center; justify-content: center;
      flex-shrink: 0;
      margin-top: 2px;
      transition: all 0.2s ease;
      cursor: pointer;
      position: relative;
    }
    .agree-check input { display: none; }
    .agree-check[data-checked="true"] { border-color: var(--success); background: var(--success-light); }
    .agree-check[data-checked="true"]::after {
      content: "‚úì";
      font-weight: 1000;
      color: var(--success);
      font-size: 14px;
      transform: translateY(-0.5px);
    }

    .agree-content { flex: 1; }
    .agree-title {
      font-size: 12px;
      font-weight: 900;
      color: var(--dark);
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.6px;
    }
    .agree-sub { font-size: 12px; color: var(--grey); font-weight: 600; line-height: 1.45; }
    .agree-status { margin-top: 10px; font-size: 12px; font-weight: 900; display: none; }
    .agree-status.ok { color: var(--success); display: block; }
    .agree-status.bad { color: var(--danger); display: block; }
    .agree-status.pending { color: var(--warning); display: block; }

    .offerta-actions { display: flex; gap: 10px; margin-top: 12px; }
    .btn-soft {
      flex: 1;
      border: 1px solid var(--border);
      background: var(--surface-2);
      color: var(--dark);
      padding: 12px 12px;
      border-radius: 14px;
      font-weight: 900;
      cursor: pointer;
      transition: transform 0.2s ease;
      font-size: 12px;
    }
    .btn-soft:active { transform: scale(0.98); }

    .btn-primary {
      flex: 1;
      border: none;
      background: linear-gradient(135deg, var(--success), #00B080);
      color: #fff;
      padding: 12px 12px;
      border-radius: 14px;
      font-weight: 1000;
      cursor: pointer;
      transition: transform 0.2s ease, opacity 0.2s ease;
      font-size: 12px;
      box-shadow: 0 8px 24px rgba(0, 211, 149, 0.28);
    }
    .btn-primary:active { transform: scale(0.98); }
    .btn-primary[disabled] { opacity: 0.55; cursor: not-allowed; box-shadow: none; }

    .modal {
      position: fixed;
      inset: 0;
      z-index: 10000;
      display: none;
      align-items: flex-end;
      justify-content: center;
      background: rgba(11, 18, 32, 0.75);
      backdrop-filter: blur(10px);
      padding: 14px 12px calc(12px + var(--tg-safe-bottom, 0px));
    }
    .modal.active { display: flex; }

    .sheet {
      width: 100%;
      max-width: 560px;
      max-height: 85vh;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 22px;
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      transform: translateY(6px);
      animation: sheetIn 0.18s ease-out forwards;
      display: flex;
      flex-direction: column;
    }
    @keyframes sheetIn {
      from { transform: translateY(14px); opacity: 0.6; }
      to { transform: translateY(0); opacity: 1; }
    }

    .sheet-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(76,111,255,0.10), transparent);
      flex-shrink: 0;
    }
    .sheet-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 1000;
      color: var(--dark);
      letter-spacing: -0.2px;
    }
    .sheet-title .ic {
      width: 36px; height: 36px; border-radius: 12px;
      background: var(--primary-light);
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
    }
    .sheet-title .tx { font-size: 15px; }

    .sheet-close {
      border: none;
      background: var(--surface-2);
      color: var(--dark);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 1000;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .sheet-close:active { transform: scale(0.98); }

    .sheet-body { 
      position: relative; 
      padding: 16px; 
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      flex: 1;
    }

    .offerta-content {
      font-size: 14px;
      line-height: 1.7;
      color: var(--text-secondary);
    }

    .offerta-content h2 {
      font-size: 18px;
      font-weight: 900;
      color: var(--dark);
      margin: 20px 0 12px;
    }

    .offerta-content h2:first-child {
      margin-top: 0;
    }

    .offerta-content h3 {
      font-size: 16px;
      font-weight: 800;
      color: var(--dark);
      margin: 16px 0 10px;
    }

    .offerta-content p {
      margin-bottom: 12px;
      color: var(--grey);
      font-weight: 500;
    }

    .offerta-content ul, .offerta-content ol {
      margin-left: 20px;
      margin-bottom: 12px;
    }

    .offerta-content li {
      margin-bottom: 8px;
      color: var(--grey);
      font-weight: 500;
    }

    .sheet-foot {
      padding: 12px 14px 14px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 10px;
      align-items: center;
      background: var(--surface);
      flex-shrink: 0;
    }
    .sheet-foot .btn-soft,
    .sheet-foot .btn-primary { margin-top: 0; }

    .submit-info {
      text-align: center;
      padding: 20px;
      background: var(--primary-light);
      border-radius: var(--radius-lg);
      margin-top: 24px;
      border: 1px solid var(--border);
    }
    .submit-info-icon { font-size: 36px; margin-bottom: 10px; }
    .submit-info-text { font-size: 14px; color: var(--grey); line-height: 1.6; font-weight: 500; }

    .gps-final-note {
      margin-top: 16px;
      padding: 14px;
      border-radius: var(--radius);
      border: 1px solid rgba(0,217,185,0.25);
      background: var(--success-light);
      display: flex;
      gap: 12px;
      align-items: flex-start;
      text-align: left;
    }
    .gps-final-note .ic {
      width: 28px; height: 28px; border-radius: 8px;
      background: rgba(0,217,185,0.2);
      display: flex; align-items: center; justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }
    .gps-final-note .t1 {
      font-weight: 800;
      font-size: 11px;
      color: var(--dark);
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .gps-final-note .t2 { font-size: 12px; color: var(--grey); line-height: 1.5; font-weight: 500; }

    /* BEAUTIFUL LOADING ANIMATION */
    .loading-overlay {
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px 14px calc(18px + var(--tg-safe-bottom, 0px));
      background: radial-gradient(1200px 600px at 50% 15%, rgba(76,111,255,0.22), rgba(0,0,0,0)) ,
                  rgba(11, 18, 32, 0.92);
      backdrop-filter: blur(14px);
    }
    .loading-overlay.active { display: flex; }

    .loading-card {
      width: min(520px, 100%);
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      box-shadow: 0 18px 60px rgba(0,0,0,0.45);
      overflow: hidden;
    }
    .loading-top {
      padding: 16px 16px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      background: linear-gradient(180deg, rgba(76,111,255,0.18), rgba(255,255,255,0.02));
    }
    .loading-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,0.22);
      border: 1px solid rgba(255,255,255,0.10);
      color: rgba(255,255,255,0.92);
      font-weight: 900;
      font-size: 12px;
      letter-spacing: 0.3px;
      white-space: nowrap;
    }
    .loading-badge .dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--success);
      box-shadow: 0 0 0 6px rgba(0,211,149,0.14);
      animation: livePulse 1.2s infinite ease-in-out;
    }
    @keyframes livePulse {
      0%,100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.15); opacity: 0.7; }
    }

    .loading-time {
      color: rgba(255,255,255,0.78);
      font-size: 12px;
      font-weight: 800;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      padding: 10px 12px;
      border-radius: 999px;
      white-space: nowrap;
    }

    .loading-body {
      padding: 14px 16px 16px;
    }

    .loading-hero {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 12px;
    }
    .loading-emoji {
      width: 44px; height: 44px;
      border-radius: 14px;
      display: grid;
      place-items: center;
      font-size: 22px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 10px 24px rgba(0,0,0,0.25);
    }
    .loading-title {
      color: #fff;
      font-weight: 1000;
      font-size: 16px;
      letter-spacing: -0.2px;
      line-height: 1.15;
    }
    .loading-subtitle {
      margin-top: 4px;
      color: rgba(255,255,255,0.78);
      font-size: 12px;
      font-weight: 700;
      line-height: 1.35;
    }

    .loading-track {
      position: relative;
      width: 100%;
      height: 54px;
      border-radius: 16px;
      background: rgba(255,255,255,0.07);
      border: 1px solid rgba(255,255,255,0.12);
      overflow: hidden;
      margin: 12px 0 10px;
    }
    .loading-road {
      position: absolute;
      inset: 0;
      background:
        linear-gradient(90deg, rgba(255,255,255,0.00), rgba(255,255,255,0.06), rgba(255,255,255,0.00)),
        repeating-linear-gradient(90deg, rgba(255,255,255,0.0) 0 24px, rgba(255,255,255,0.15) 24px 32px);
      opacity: 0.9;
      animation: roadMove 1.2s linear infinite;
      transform: translateX(0);
    }
    @keyframes roadMove {
      from { transform: translateX(0); }
      to { transform: translateX(-56px); }
    }

    .loading-truck {
      position: absolute;
      left: -10%;
      top: 50%;
      transform: translateY(-50%);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,0.22);
      border: 1px solid rgba(255,255,255,0.10);
      color: #fff;
      font-weight: 1000;
      font-size: 13px;
      box-shadow: 0 14px 30px rgba(0,0,0,0.35);
      animation: truckGo 1.7s ease-in-out infinite;
      will-change: transform, left;
    }
    .loading-truck .smile { opacity: 0.95; }
    @keyframes truckGo {
      0% { left: -18%; transform: translateY(-50%) scale(0.98); }
      45% { left: 42%; transform: translateY(-50%) scale(1.02); }
      90% { left: 108%; transform: translateY(-50%) scale(0.99); }
      100% { left: 108%; transform: translateY(-50%) scale(0.99); }
    }

    .loading-dots {
      display: inline-flex;
      gap: 6px;
      align-items: center;
      justify-content: center;
      margin-top: 6px;
    }
    .loading-dots span {
      width: 7px; height: 7px;
      border-radius: 50%;
      background: rgba(255,255,255,0.55);
      animation: dotBounce 1.0s infinite ease-in-out;
    }
    .loading-dots span:nth-child(2) { animation-delay: 0.12s; }
    .loading-dots span:nth-child(3) { animation-delay: 0.24s; }
    .loading-dots span:nth-child(4) { animation-delay: 0.36s; }
    @keyframes dotBounce {
      0%, 100% { transform: translateY(0); opacity: 0.55; }
      50% { transform: translateY(-5px); opacity: 1; }
    }

    .loading-hint {
      margin-top: 10px;
      text-align: center;
      color: rgba(255,255,255,0.75);
      font-size: 12px;
      font-weight: 700;
      line-height: 1.35;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    @media (min-width: 600px) {
      .container { padding: 0 24px 140px; }
      .form-grid { gap: 16px; }
      .truck-grid { gap: 14px; }
      .loading-body { padding: 16px 18px 18px; }
    }
    @media (max-width: 380px) {
      .truck-grid { grid-template-columns: repeat(2, 1fr); }
      .form-grid { grid-template-columns: 1fr; }
      .container { padding: 0 12px 160px; }
      .photo-preview { width: 100px; height: 100px; font-size: 38px; }
      .tg-avatar { width: 70px; height: 70px; font-size: 28px; }
      .loading-title { font-size: 15px; }
      .loading-time { font-size: 11px; }
    }
    @media (max-width: 340px) {
      .title { font-size: 22px; }
      .section-title { font-size: 15px; }
      .truck-card { padding: 12px 6px; }
      .truck-icon { font-size: 22px; }
    }
  </style>
</head>

<body>
  <!-- BEAUTIFUL LOADING OVERLAY -->
  <div class="loading-overlay" id="loadingOverlay" aria-hidden="true">
    <div class="loading-card" role="status" aria-live="polite">
      <div class="loading-top">
        <div class="loading-badge">
          <span class="dot"></span>
          <span id="loadingBadgeText"
                data-kz="Alash-Go ‚Ä¢ “ö–∞—É—ñ–ø—Å—ñ–∑ —Ç—ñ—Ä–∫–µ—É"
                data-ru="Alash-Go ‚Ä¢ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è">Alash-Go ‚Ä¢ “ö–∞—É—ñ–ø—Å—ñ–∑ —Ç—ñ—Ä–∫–µ—É</span>
        </div>
        <div class="loading-time" id="loadingETA"
             data-kz="‚è±Ô∏è 5‚Äì10 —Å–µ–∫—É–Ω–¥"
             data-ru="‚è±Ô∏è 5‚Äì10 —Å–µ–∫—É–Ω–¥">‚è±Ô∏è 5‚Äì10 —Å–µ–∫—É–Ω–¥</div>
      </div>

      <div class="loading-body">
        <div class="loading-hero">
          <div class="loading-emoji" id="loadingEmoji">üßæ</div>
          <div>
            <div class="loading-title" id="loadingTitle"
                 data-kz="–¢—ñ—Ä–∫–µ–ª—ñ–ø –∂–∞—Ç—ã—Ä–º—ã–∑ üòä"
                 data-ru="–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º üòä">–¢—ñ—Ä–∫–µ–ª—ñ–ø –∂–∞—Ç—ã—Ä–º—ã–∑ üòä</div>
            <div class="loading-subtitle" id="loadingSubTitle"
                 data-kz="”®—Ç—ñ–Ω–µ–º—ñ–∑, –∫“Ø—Ç–µ —Ç“±—Ä—ã“£—ã–∑ ‚Äî –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ“£—ñ–∑ “õ–∞—É—ñ–ø—Å—ñ–∑ ”©“£–¥–µ–ª—É–¥–µ."
                 data-ru="–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ ‚Äî –¥–∞–Ω–Ω—ã–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è.">
              ”®—Ç—ñ–Ω–µ–º—ñ–∑, –∫“Ø—Ç–µ —Ç“±—Ä—ã“£—ã–∑ ‚Äî –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ“£—ñ–∑ “õ–∞—É—ñ–ø—Å—ñ–∑ ”©“£–¥–µ–ª—É–¥–µ.
            </div>
          </div>
        </div>

        <div class="loading-track" aria-hidden="true">
          <div class="loading-road"></div>
          <div class="loading-truck" id="loadingTruck">
            üöö <span id="loadingTruckText" data-kz="–ñ–æ–ª–¥–∞..." data-ru="–í –ø—É—Ç–∏...">–ñ–æ–ª–¥–∞...</span> <span class="smile">üôÇ</span>
          </div>
        </div>

        <div class="loading-dots" aria-hidden="true">
          <span></span><span></span><span></span><span></span>
        </div>

        <div class="loading-hint" id="loadingText"
             data-kz="–°”ô–ª “ì–∞–Ω–∞ “õ–∞–ª–¥—ã ‚ú® –¢—ñ—Ä–∫–µ—É –∞—è“õ—Ç–∞–ª“ì–∞–Ω —Å–æ“£ –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ –∂–∞–±—ã–ª–∞–¥—ã."
             data-ru="–ü–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–æ ‚ú® –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä–æ–µ—Ç—Å—è.">
          –°”ô–ª “ì–∞–Ω–∞ “õ–∞–ª–¥—ã ‚ú® –¢—ñ—Ä–∫–µ—É –∞—è“õ—Ç–∞–ª“ì–∞–Ω —Å–æ“£ –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ –∂–∞–±—ã–ª–∞–¥—ã.
        </div>
      </div>
    </div>
  </div>

  <!-- Offerta Modal (FIXED - Direct content, no iframe) -->
  <div class="modal" id="offertaModal" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true">
      <div class="sheet-head">
        <div class="sheet-title">
          <div class="ic">üßæ</div>
          <div class="tx" id="offertaModalTitle" data-kz="–û—Ñ–µ—Ä—Ç–∞ (—ñ—à—ñ–Ω–¥–µ)" data-ru="–û—Ñ–µ—Ä—Ç–∞ (–≤–Ω—É—Ç—Ä–∏)">–û—Ñ–µ—Ä—Ç–∞ (—ñ—à—ñ–Ω–¥–µ)</div>
        </div>
        <button type="button" class="sheet-close" id="closeOffertaModalBtn" data-kz="–ñ–∞–±—É" data-ru="–ó–∞–∫—Ä—ã—Ç—å">–ñ–∞–±—É</button>
      </div>

      <div class="sheet-body">
        <div class="offerta-content" id="offertaContent">
          <!-- Content will be populated by JS -->
        </div>
      </div>

      <div class="sheet-foot">
        <button type="button" class="btn-soft" id="offertaModalScrollTopBtn" data-kz="–ñ–æ“ì–∞—Ä—ã“ì–∞" data-ru="–í–≤–µ—Ä—Ö">–ñ–æ“ì–∞—Ä—ã“ì–∞</button>
        <button type="button" class="btn-primary" id="offertaModalAcceptBtn" data-kz="–û“õ—ã–ø, “õ–∞–±—ã–ª–¥–∞–π–º—ã–Ω" data-ru="–ü—Ä–æ—á–∏—Ç–∞–ª(–∞), –ø—Ä–∏–Ω–∏–º–∞—é">–û“õ—ã–ø, “õ–∞–±—ã–ª–¥–∞–π–º—ã–Ω</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <div class="tg-avatar-wrap">
        <div class="tg-avatar" id="tgAvatar">üë§
          <img id="tgAvatarImg" alt="avatar" style="display:none" />
        </div>
      </div>
      <div class="tg-username" id="tgUsername">@user</div>
      <h1 class="title" data-kz="–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —Ç—ñ—Ä–∫–µ–ª—É—ñ" data-ru="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–æ–¥–∏—Ç–µ–ª—è">–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —Ç—ñ—Ä–∫–µ–ª—É—ñ</h1>
      <p class="subtitle" data-kz="Alash-Go –∂“Ø–π–µ—Å—ñ–Ω–µ “õ–æ—Å—ã–ª—É “Ø—à—ñ–Ω –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑" data-ru="–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Alash-Go">Alash-Go –∂“Ø–π–µ—Å—ñ–Ω–µ “õ–æ—Å—ã–ª—É “Ø—à—ñ–Ω –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑</p>

      <div class="notice">
        <div class="notice-icon">‚ö†Ô∏è</div>
        <div>
          <div class="notice-title" data-kz="–ï–°–ö–ï–†–¢–£" data-ru="–í–ù–ò–ú–ê–ù–ò–ï">–ï–°–ö–ï–†–¢–£</div>
          <div class="notice-text" data-kz="”ò–∫—ñ–º—à—ñ –±–∞—Ä–ª—ã“õ –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —Ç–µ–∫—Å–µ—Ä–µ–¥—ñ. –¢–µ–∫ —à—ã–Ω–∞–π—ã –∞“õ–ø–∞—Ä–∞—Ç –∂–∞–∑—ã“£—ã–∑ –∂”ô–Ω–µ –Ω–∞“õ—Ç—ã “õ“±–∂–∞—Ç—Ç–∞—Ä–¥—ã –∂“Ø–∫—Ç–µ“£—ñ–∑." data-ru="–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ. –£–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.">”ò–∫—ñ–º—à—ñ –±–∞—Ä–ª—ã“õ –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —Ç–µ–∫—Å–µ—Ä–µ–¥—ñ. –¢–µ–∫ —à—ã–Ω–∞–π—ã –∞“õ–ø–∞—Ä–∞—Ç –∂–∞–∑—ã“£—ã–∑ –∂”ô–Ω–µ –Ω–∞“õ—Ç—ã “õ“±–∂–∞—Ç—Ç–∞—Ä–¥—ã –∂“Ø–∫—Ç–µ“£—ñ–∑.</div>
        </div>
      </div>
    </div>

    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-text" id="progressText">0%</div>
    </div>

    <form id="driverForm" enctype="multipart/form-data">
      <!-- Profile Photo -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">üì∏</div>
          <div class="section-title" data-kz="–ü—Ä–æ—Ñ–∏–ª—å —Ñ–æ—Ç–æ—Å—ã" data-ru="–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è">–ü—Ä–æ—Ñ–∏–ª—å —Ñ–æ—Ç–æ—Å—ã</div>
        </div>

        <div class="section-hint">
          <span class="hint-icon">‚ÑπÔ∏è</span>
          <span class="hint-text" data-kz="–§–æ—Ç–æ –∞–Ω—ã“õ –±–æ–ª—É—ã –∫–µ—Ä–µ–∫: –±–µ—Ç—ñ“£—ñ–∑ –∫”©—Ä—ñ–Ω—Å—ñ–Ω, —Ñ–∏–ª—å—Ç—Ä—Å—ñ–∑." data-ru="–§–æ—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–µ—Ç–∫–∏–º: –ª–∏—Ü–æ –≤–∏–¥–Ω–æ, –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤.">–§–æ—Ç–æ –∞–Ω—ã“õ –±–æ–ª—É—ã –∫–µ—Ä–µ–∫: –±–µ—Ç—ñ“£—ñ–∑ –∫”©—Ä—ñ–Ω—Å—ñ–Ω, —Ñ–∏–ª—å—Ç—Ä—Å—ñ–∑.</span>
        </div>

        <div class="photo-upload">
          <div class="photo-preview" id="photoPreview" onclick="document.getElementById('profilePhoto').click()">üë§</div>
          <div class="photo-label" data-kz="–°—É—Ä–µ—Ç—Ç—ñ –∂“Ø–∫—Ç–µ—É (–º–∞–∫—Å. 10MB)" data-ru="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ (–º–∞–∫—Å. 10MB)">–°—É—Ä–µ—Ç—Ç—ñ –∂“Ø–∫—Ç–µ—É (–º–∞–∫—Å. 10MB)</div>
          <input type="file" id="profilePhoto" name="profilePhoto" class="photo-input" accept="image/*" capture="environment" required>
          <div class="field-message error" id="profilePhotoError"></div>
        </div>
      </div>

      <!-- Personal Info -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">üë§</div>
          <div class="section-title" data-kz="–ñ–µ–∫–µ –º”ô–ª—ñ–º–µ—Ç—Ç–µ—Ä" data-ru="–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ">–ñ–µ–∫–µ –º”ô–ª—ñ–º–µ—Ç—Ç–µ—Ä</div>
        </div>

        <div class="section-hint">
          <span class="hint-icon">‚úÖ</span>
          <span class="hint-text" data-kz="–ê—Ç—ã-–∂”©–Ω—ñ“£—ñ–∑ “õ“±–∂–∞—Ç—Ç–∞—Ä–¥–∞“ì—ã–¥–∞–π –±–æ–ª—É—ã –∫–µ—Ä–µ–∫." data-ru="–§–ò–û –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏.">–ê—Ç—ã-–∂”©–Ω—ñ“£—ñ–∑ “õ“±–∂–∞—Ç—Ç–∞—Ä–¥–∞“ì—ã–¥–∞–π –±–æ–ª—É—ã –∫–µ—Ä–µ–∫.</span>
        </div>

        <div class="form-grid">
          <div class="form-field">
            <label class="field-label" data-kz="–ê—Ç—ã" data-ru="–ò–º—è">–ê—Ç—ã</label>
            <input type="text" class="field-input" id="firstName" name="firstName" required data-placeholder-kz="–ê—Ç—ã“£—ã–∑" data-placeholder-ru="–ò–º—è">
            <div class="field-message error" id="firstNameError"></div>
          </div>
          <div class="form-field">
            <label class="field-label" data-kz="–¢–µ–≥—ñ" data-ru="–§–∞–º–∏–ª–∏—è">–¢–µ–≥—ñ</label>
            <input type="text" class="field-input" id="lastName" name="lastName" required data-placeholder-kz="–¢–µ–≥—ñ“£—ñ–∑" data-placeholder-ru="–§–∞–º–∏–ª–∏—è">
            <div class="field-message error" id="lastNameError"></div>
          </div>
        </div>

        <div class="form-field">
          <label class="field-label" data-kz="–¢—É“ì–∞–Ω –∫“Ø–Ω—ñ" data-ru="–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è">–¢—É“ì–∞–Ω –∫“Ø–Ω—ñ</label>
          <input type="date" class="field-input" id="birthday" name="birthday" required max="2006-01-01">
          <div class="field-message error" id="birthdayError"></div>
        </div>

        <div class="form-field">
          <label class="field-label" data-kz="–¢–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ" data-ru="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">–¢–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ</label>
          <input type="tel" class="field-input" id="contactNumber" name="contactNumber" required placeholder="+7 (___) ___-__-__" autocomplete="tel" inputmode="tel">
          <div class="field-message error" id="contactNumberError"></div>
          <div class="field-note">
            <span class="note-icon">üì≤</span>
            <span class="note-text" data-kz="–û—Å—ã –Ω”©–º—ñ—Ä–≥–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä —Ö–∞–±–∞—Ä–ª–∞—Å—É—ã –º“Ø–º–∫—ñ–Ω." data-ru="–ù–∞ —ç—Ç–æ—Ç –Ω–æ–º–µ—Ä –º–æ–≥—É—Ç –ø–æ–∑–≤–æ–Ω–∏—Ç—å.">–û—Å—ã –Ω”©–º—ñ—Ä–≥–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä —Ö–∞–±–∞—Ä–ª–∞—Å—É—ã –º“Ø–º–∫—ñ–Ω.</span>
          </div>
        </div>

        <div class="form-field">
          <label class="field-label" data-kz="–ö”©–ª—ñ–∫ –Ω”©–º—ñ—Ä—ñ" data-ru="–ù–æ–º–µ—Ä –º–∞—à–∏–Ω—ã">–ö”©–ª—ñ–∫ –Ω”©–º—ñ—Ä—ñ</label>
          <input type="text" class="field-input" id="truckNumber" name="truckNumber" required data-placeholder-kz="777ABC01" data-placeholder-ru="777ABC01" autocomplete="off" inputmode="text" autocapitalize="characters" spellcheck="false">
          <div class="field-message error" id="truckNumberError"></div>
          <div class="field-message success" id="truckNumberSuccess"></div>
          <div class="field-message pending" id="truckNumberPending"></div>
        </div>
      </div>

      <!-- Truck Type -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">üöö</div>
          <div class="section-title" data-kz="–ö”©–ª—ñ–∫ —Ç“Ø—Ä—ñ" data-ru="–¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞">–ö”©–ª—ñ–∫ —Ç“Ø—Ä—ñ</div>
        </div>

        <div class="truck-grid">
          <div class="truck-card" data-truck="intercity" onclick="selectTruck('intercity')">
            <div class="truck-icon">üöï</div>
            <div class="truck-name" data-kz="“ö–∞–ª–∞ –∞—Ä–∞–ª—ã“õ" data-ru="–ú–µ–∂–≥–æ—Ä–æ–¥">“ö–∞–ª–∞ –∞—Ä–∞–ª—ã“õ</div>
            <div class="truck-desc" data-kz="—Ç–∞–∫—Å–∏" data-ru="—Ç–∞–∫—Å–∏">—Ç–∞–∫—Å–∏</div>
          </div>
          <div class="truck-card" data-truck="small" onclick="selectTruck('small')">
            <div class="truck-icon">üöê</div>
            <div class="truck-name" data-kz="–ö—ñ—à—ñ" data-ru="–ú–∞–ª—ã–π">–ö—ñ—à—ñ</div>
            <div class="truck-desc" data-kz="1.5—Ç –¥–µ–π—ñ–Ω" data-ru="–¥–æ 1.5—Ç">1.5—Ç –¥–µ–π—ñ–Ω</div>
          </div>
          <div class="truck-card" data-truck="medium" onclick="selectTruck('medium')">
            <div class="truck-icon">üöö</div>
            <div class="truck-name" data-kz="–û—Ä—Ç–∞—à–∞" data-ru="–°—Ä–µ–¥–Ω–∏–π">–û—Ä—Ç–∞—à–∞</div>
            <div class="truck-desc" data-kz="5—Ç –¥–µ–π—ñ–Ω" data-ru="–¥–æ 5—Ç">5—Ç –¥–µ–π—ñ–Ω</div>
          </div>
          <div class="truck-card" data-truck="large" onclick="selectTruck('large')">
            <div class="truck-icon">üöõ</div>
            <div class="truck-name" data-kz="“Æ–ª–∫–µ–Ω" data-ru="–ë–æ–ª—å—à–æ–π">“Æ–ª–∫–µ–Ω</div>
            <div class="truck-desc" data-kz="20—Ç –¥–µ–π—ñ–Ω" data-ru="–¥–æ 20—Ç">20—Ç –¥–µ–π—ñ–Ω</div>
          </div>
          <div class="truck-card" data-truck="tow" onclick="selectTruck('tow')">
            <div class="truck-icon">üîß</div>
            <div class="truck-name" data-kz="–≠–≤–∞–∫—É–∞—Ç–æ—Ä" data-ru="–≠–≤–∞–∫—É–∞—Ç–æ—Ä">–≠–≤–∞–∫—É–∞—Ç–æ—Ä</div>
            <div class="truck-desc" data-kz="—ç–≤–∞–∫—É–∞—Ü–∏—è" data-ru="—ç–≤–∞–∫—É–∞—Ü–∏—è">—ç–≤–∞–∫—É–∞—Ü–∏—è</div>
          </div>
          <div class="truck-card" data-truck="any" onclick="selectTruck('any')">
            <div class="truck-icon">üöô</div>
            <div class="truck-name" data-kz="–ö–µ–∑ –∫–µ–ª–≥–µ–Ω" data-ru="–õ—é–±–æ–π">–ö–µ–∑ –∫–µ–ª–≥–µ–Ω</div>
            <div class="truck-desc" data-kz="–∂–∞—Ä–∞–π–¥—ã" data-ru="–ø–æ–¥–æ–π–¥–µ—Ç">–∂–∞—Ä–∞–π–¥—ã</div>
          </div>
        </div>
        <input type="hidden" id="truckType" name="truckType" required>
        <div class="field-message error" id="truckTypeError"></div>
      </div>

      <!-- Documents -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">üìÑ</div>
          <div class="section-title" data-kz="“ö“±–∂–∞—Ç—Ç–∞—Ä" data-ru="–î–æ–∫—É–º–µ–Ω—Ç—ã">“ö“±–∂–∞—Ç—Ç–∞—Ä</div>
        </div>

        <div class="section-hint">
          <span class="hint-icon">üõ°Ô∏è</span>
          <span class="hint-text" data-kz="“ö“±–∂–∞—Ç—Ç–∞—Ä –∞–Ω—ã“õ, —Ç–æ–ª—ã“õ –∫”©—Ä—ñ–Ω—Å—ñ–Ω." data-ru="–î–æ–∫—É–º–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–µ—Ç–∫–∏–º–∏.">“ö“±–∂–∞—Ç—Ç–∞—Ä –∞–Ω—ã“õ, —Ç–æ–ª—ã“õ –∫”©—Ä—ñ–Ω—Å—ñ–Ω.</span>
        </div>

        <div class="form-field">
          <label class="field-label" data-kz="–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –∫—É”ô–ª—ñ–≥—ñ (–∞–ª–¥—ã“£“ì—ã)" data-ru="–ü—Ä–∞–≤–∞ (–ª–∏—Ü–µ–≤–∞—è)">–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –∫—É”ô–ª—ñ–≥—ñ (–∞–ª–¥—ã“£“ì—ã)</label>
          <div class="file-field" id="licenseFrontField" onclick="document.getElementById('licenseFront').click()">
            <div class="file-icon">üìã</div>
            <div class="file-text" data-kz="“ö“±–∂–∞—Ç—Ç—ã –∂“Ø–∫—Ç–µ—É (–º–∞–∫—Å. 10MB)" data-ru="–ó–∞–≥—Ä—É–∑–∏—Ç—å (–º–∞–∫—Å. 10MB)">“ö“±–∂–∞—Ç—Ç—ã –∂“Ø–∫—Ç–µ—É (–º–∞–∫—Å. 10MB)</div>
          </div>
          <input type="file" id="licenseFront" name="licenseFront" class="file-input" accept="image/*,.pdf" required>
          <div class="field-message error" id="licenseFrontError"></div>
        </div>

        <div class="form-field">
          <label class="field-label" data-kz="–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –∫—É”ô–ª—ñ–≥—ñ (–∞—Ä—Ç“õ—ã)" data-ru="–ü—Ä–∞–≤–∞ (–æ–±—Ä–∞—Ç–Ω–∞—è)">–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –∫—É”ô–ª—ñ–≥—ñ (–∞—Ä—Ç“õ—ã)</label>
          <div class="file-field" id="licenseBackField" onclick="document.getElementById('licenseBack').click()">
            <div class="file-icon">üìã</div>
            <div class="file-text" data-kz="“ö“±–∂–∞—Ç—Ç—ã –∂“Ø–∫—Ç–µ—É (–º–∞–∫—Å. 10MB)" data-ru="–ó–∞–≥—Ä—É–∑–∏—Ç—å (–º–∞–∫—Å. 10MB)">“ö“±–∂–∞—Ç—Ç—ã –∂“Ø–∫—Ç–µ—É (–º–∞–∫—Å. 10MB)</div>
          </div>
          <input type="file" id="licenseBack" name="licenseBack" class="file-input" accept="image/*,.pdf" required>
          <div class="field-message error" id="licenseBackError"></div>
        </div>
      </div>

      <!-- Location -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">üìç</div>
          <div class="section-title" data-kz="–ñ“±–º—ã—Å “õ–∞–ª–∞—Å—ã" data-ru="–ì–æ—Ä–æ–¥ —Ä–∞–±–æ—Ç—ã">–ñ“±–º—ã—Å “õ–∞–ª–∞—Å—ã</div>
        </div>

        <div class="form-field">
          <label class="field-label" data-kz="“ö–∞–ª–∞" data-ru="–ì–æ—Ä–æ–¥">“ö–∞–ª–∞</label>
          <div class="location-group">
            <input type="text" class="field-input location-input" id="startCity" name="startCity" required data-placeholder-kz="“ö–∞–ª–∞–Ω—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑" data-placeholder-ru="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥">
            <button type="button" class="gps-btn" id="gpsBtn">üìç</button>
          </div>
          <div class="field-message error" id="startCityError"></div>
          <div class="field-message success" id="startCitySuccess"></div>
        </div>
      </div>

      <!-- Offerta (required) -->
      <div class="form-section">
        <div class="offerta-card">
          <div class="offerta-top">
            <div class="offerta-title">
              <div class="ic">üßæ</div>
              <div class="tx" data-kz="–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –æ—Ñ–µ—Ä—Ç–∞—Å—ã" data-ru="–û—Ñ–µ—Ä—Ç–∞ –≤–æ–¥–∏—Ç–µ–ª—è">–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –æ—Ñ–µ—Ä—Ç–∞—Å—ã</div>
            </div>
            <button type="button" class="offerta-open" id="openOffertaBtn" data-kz="–û“õ—ã–ø —à—ã“ì—É" data-ru="–û—Ç–∫—Ä—ã—Ç—å">–û“õ—ã–ø —à—ã“ì—É</button>
          </div>

          <div class="offerta-text" data-kz="–¢—ñ—Ä–∫–µ–ª—É “Ø—à—ñ–Ω –æ—Ñ–µ—Ä—Ç–∞–Ω—ã –æ“õ—ã–ø, –∫–µ–ª—ñ—Å—ñ–º –±–µ—Ä—É—ñ“£—ñ–∑ –∫–µ—Ä–µ–∫. –û—Ñ–µ—Ä—Ç–∞ –æ—Å—ã –º–∏–Ω–∏-“õ–æ—Å—ã–º—à–∞–Ω—ã“£ —ñ—à—ñ–Ω–¥–µ –∞—à—ã–ª–∞–¥—ã." data-ru="–ß—Ç–æ–±—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è, –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –æ—Ñ–µ—Ä—Ç—É –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ. –û—Ñ–µ—Ä—Ç–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.">
            –¢—ñ—Ä–∫–µ–ª—É “Ø—à—ñ–Ω –æ—Ñ–µ—Ä—Ç–∞–Ω—ã –æ“õ—ã–ø, –∫–µ–ª—ñ—Å—ñ–º –±–µ—Ä—É—ñ“£—ñ–∑ –∫–µ—Ä–µ–∫. –û—Ñ–µ—Ä—Ç–∞ –æ—Å—ã –º–∏–Ω–∏-“õ–æ—Å—ã–º—à–∞–Ω—ã“£ —ñ—à—ñ–Ω–¥–µ –∞—à—ã–ª–∞–¥—ã.
          </div>

          <div class="agree-row">
            <div class="agree-check" id="agreeCheck" data-checked="false" role="button" aria-label="agree">
              <input type="checkbox" id="offertaAgree" name="offertaAgree" />
            </div>
            <div class="agree-content">
              <div class="agree-title" data-kz="–ö–µ–ª—ñ—Å—ñ–º" data-ru="–°–æ–≥–ª–∞—Å–∏–µ">–ö–µ–ª—ñ—Å—ñ–º</div>
              <div class="agree-sub" data-kz="–ú–µ–Ω –æ—Ñ–µ—Ä—Ç–∞–Ω—ã –æ“õ—ã–¥—ã–º –∂”ô–Ω–µ —à–∞—Ä—Ç—Ç–∞—Ä—ã–Ω “õ–∞–±—ã–ª–¥–∞–π–º—ã–Ω." data-ru="–Ø –ø—Ä–æ—á–∏—Ç–∞–ª(–∞) –æ—Ñ–µ—Ä—Ç—É –∏ –ø—Ä–∏–Ω–∏–º–∞—é —É—Å–ª–æ–≤–∏—è.">
                –ú–µ–Ω –æ—Ñ–µ—Ä—Ç–∞–Ω—ã –æ“õ—ã–¥—ã–º –∂”ô–Ω–µ —à–∞—Ä—Ç—Ç–∞—Ä—ã–Ω “õ–∞–±—ã–ª–¥–∞–π–º—ã–Ω.
              </div>
              <div class="agree-status ok" id="offertaOk" data-kz="–û—Ñ–µ—Ä—Ç–∞ “õ–∞–±—ã–ª–¥–∞–Ω–¥—ã ‚úÖ" data-ru="–û—Ñ–µ—Ä—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∞ ‚úÖ">–û—Ñ–µ—Ä—Ç–∞ “õ–∞–±—ã–ª–¥–∞–Ω–¥—ã ‚úÖ</div>
              <div class="agree-status bad" id="offertaBad"></div>
              <div class="agree-status pending" id="offertaPending" data-kz="–¢–µ–∫—Å–µ—Ä—ñ–ª—É–¥–µ..." data-ru="–ü—Ä–æ–≤–µ—Ä–∫–∞...">–¢–µ–∫—Å–µ—Ä—ñ–ª—É–¥–µ...</div>
            </div>
          </div>

          <div class="offerta-actions">
            <button type="button" class="btn-soft" id="refreshOffertaBtn" data-kz="–°—Ç–∞—Ç—É—Å—Ç—ã —Ç–µ–∫—Å–µ—Ä—É" data-ru="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å">–°—Ç–∞—Ç—É—Å—Ç—ã —Ç–µ–∫—Å–µ—Ä—É</button>
            <button type="button" class="btn-primary" id="acceptOffertaBtn" data-kz="“ö–∞–±—ã–ª–¥–∞–π–º—ã–Ω" data-ru="–ü—Ä–∏–Ω–∏–º–∞—é" disabled>“ö–∞–±—ã–ª–¥–∞–π–º—ã–Ω</button>
          </div>

          <input type="hidden" id="offertaAcceptedHidden" name="offertaAccepted" value="">
        </div>
      </div>

      <div class="submit-info">
        <div class="submit-info-icon">‚úÖ</div>
        <div class="submit-info-text" data-kz="–ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä“ì–∞–Ω–Ω–∞–Ω –∫–µ–π—ñ–Ω, —Ç”©–º–µ–Ω–¥–µ–≥—ñ –±–∞—Ç—ã—Ä–º–∞–Ω—ã –±–∞—Å—ã“£—ã–∑." data-ru="–ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.">–ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä“ì–∞–Ω–Ω–∞–Ω –∫–µ–π—ñ–Ω, —Ç”©–º–µ–Ω–¥–µ–≥—ñ –±–∞—Ç—ã—Ä–º–∞–Ω—ã –±–∞—Å—ã“£—ã–∑.</div>

        <div class="gps-final-note">
          <div class="ic">üõ∞Ô∏è</div>
          <div>
            <div class="t1" data-kz="GPS –†“∞“ö–°–ê–¢" data-ru="–î–û–°–¢–£–ü GPS">GPS –†“∞“ö–°–ê–¢</div>
            <div class="t2" data-kz="–¢–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä–¥—ã –¥”ô–ª –±–µ—Ä—É “Ø—à—ñ–Ω GPS-–∫–µ “õ–æ–ª–∂–µ—Ç—ñ–º–¥—ñ–ª—ñ–∫ –±–µ—Ä—ñ“£—ñ–∑." data-ru="–î–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ GPS.">–¢–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä–¥—ã –¥”ô–ª –±–µ—Ä—É “Ø—à—ñ–Ω GPS-–∫–µ “õ–æ–ª–∂–µ—Ç—ñ–º–¥—ñ–ª—ñ–∫ –±–µ—Ä—ñ“£—ñ–∑.</div>
          </div>
        </div>
      </div>

      <input type="hidden" id="latitude" name="latitude">
      <input type="hidden" id="longitude" name="longitude">
      <input type="hidden" id="telegramId" name="telegramId">
      <input type="hidden" id="tgUsernameHidden" name="tgUsername">
      <input type="hidden" id="tgPhotoUrlHidden" name="tgPhotoUrl">
    </form>
  </div>

  <script>
    let currentLang = 'kz';
    let selectedTruckType = null;
    let truckNumberState = { lastChecked: '', available: false, checking: false };
    const MAX_FILE_BYTES = 10 * 1024 * 1024;

    // Offerta
    let offertaAccepted = false;
    let offertaChecking = false;

    const OFFERTA_ROLE = 'driver';

    // API endpoints
    const API_OFFERTA_STATUS_GET = '/api/offerta/status';
    const API_OFFERTA_STATUS_POST = '/api/offerta/status';
    const API_OFFERTA_APPROVE = '/api/offerta/approve';
    const API_OFFERTA_ACCEPT  = '/api/offerta/accept';
    const API_TRUCK_CHECK     = '/api/driver/truck-number/check';
    const API_DRIVER_REGISTER = '/api/driver/register';

    // Offerta content (embedded to avoid iframe issues)
    const OFFERTA_TEXT = {
      kz: {
        title: '–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –æ—Ñ–µ—Ä—Ç–∞—Å—ã',
        sections: [
          {
            heading: '1. –ö–µ–ª—ñ—Å—ñ–º —à–∞—Ä—Ç—Ç–∞—Ä—ã',
            content: '–û—Å—ã –æ—Ñ–µ—Ä—Ç–∞ Alash-Go –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Å—ã–Ω–¥–∞ –∂“Ø—Ä–≥—ñ–∑—É—à—ñ “õ—ã–∑–º–µ—Ç—Ç–µ—Ä—ñ–Ω –∫”©—Ä—Å–µ—Ç—É —à–∞—Ä—Ç—Ç–∞—Ä—ã–Ω –±–µ–ª–≥—ñ–ª–µ–π–¥—ñ. –ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–Ω—ã –ø–∞–π–¥–∞–ª–∞–Ω—É –∞—Ä“õ—ã–ª—ã –æ—Å—ã —à–∞—Ä—Ç—Ç–∞—Ä–º–µ–Ω –∫–µ–ª—ñ—Å—ñ–º—ñ–Ω –±—ñ–ª–¥—ñ—Ä–µ–¥—ñ.'
          },
          {
            heading: '2. –ñ“Ø—Ä–≥—ñ–∑—É—à—ñ–Ω—ñ“£ –º—ñ–Ω–¥–µ—Ç—Ç–µ—Ä—ñ',
            content: '–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –¥“±—Ä—ã—Å –∂”ô–Ω–µ –∂–∞“£–∞—Ä—Ç—ã–ª“ì–∞–Ω –∞“õ–ø–∞—Ä–∞—Ç –±–µ—Ä—É–≥–µ, –±–∞—Ä–ª—ã“õ “õ“±–∂–∞—Ç—Ç–∞—Ä–¥—ã“£ –∂–∞—Ä–∞–º–¥—ã–ª—ã“ì—ã–Ω —Ç–µ–∫—Å–µ—Ä—É–≥–µ, “õ–∞—É—ñ–ø—Å—ñ–∑ –∂“Ø—Ä–≥—ñ–∑—É–¥—ñ “õ–∞–º—Ç–∞–º–∞—Å—ã–∑ –µ—Ç—É–≥–µ –º—ñ–Ω–¥–µ—Ç—Ç—ñ. –ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —É–∞“õ—ã—Ç—ã–ª—ã “õ—ã–∑–º–µ—Ç –∫”©—Ä—Å–µ—Ç—É–≥–µ –∂”ô–Ω–µ –∫–ª–∏–µ–Ω—Ç—Ç–µ—Ä–º–µ–Ω ”ô–¥–µ–ø—Ç—ñ “õ–∞—Ä—ã–º-“õ–∞—Ç—ã–Ω–∞—Å –∂–∞—Å–∞—É“ì–∞ –º—ñ–Ω–¥–µ—Ç—Ç—ñ.'
          },
          {
            heading: '3. –¢”©–ª–µ–º —à–∞—Ä—Ç—Ç–∞—Ä—ã',
            content: '–¢”©–ª–µ–º –∫–ª–∏–µ–Ω—Ç –ø–µ–Ω –∂“Ø—Ä–≥—ñ–∑—É—à—ñ –∞—Ä–∞—Å—ã–Ω–¥–∞ –∫–µ–ª—ñ—Å—ñ–º –±–æ–π—ã–Ω—à–∞ —Ç—ñ–∫–µ–ª–µ–π –∂“Ø—Ä–≥—ñ–∑—ñ–ª–µ–¥—ñ. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∫–æ–º–∏—Å—Å–∏—è –∞–ª–º–∞–π–¥—ã –Ω–µ–º–µ—Å–µ –±–µ–ª–≥—ñ–ª–µ–Ω–≥–µ–Ω –ø–∞–π—ã–∑ –∞–ª—É—ã –º“Ø–º–∫—ñ–Ω. –ë–∞—Ä–ª—ã“õ “õ–∞—Ä–∂—ã–ª—ã“õ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–ª–∞—Ä “õ“±–∂–∞—Ç—Ç–∞–ª—É—ã –∫–µ—Ä–µ–∫.'
          },
          {
            heading: '4. “ö“±–ø–∏—è–ª—ã–ª—ã“õ –∂”ô–Ω–µ –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ “õ–æ—Ä“ì–∞—É',
            content: '–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –∫–ª–∏–µ–Ω—Ç—Ç–µ—Ä–¥—ñ“£ –∂–µ–∫–µ –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ–Ω “õ“±–ø–∏—è —Å–∞“õ—Ç–∞—É“ì–∞ –∂”ô–Ω–µ —Ç–µ–∫ “õ—ã–∑–º–µ—Ç –∫”©—Ä—Å–µ—Ç—É –º–∞“õ—Å–∞—Ç—ã–Ω–¥–∞ –ø–∞–π–¥–∞–ª–∞–Ω—É“ì–∞ –º—ñ–Ω–¥–µ—Ç—Ç—ñ. –î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ “Ø—à—ñ–Ω—à—ñ —Ç–∞—Ä–∞–ø—Ç–∞—Ä–º–µ–Ω –±”©–ª—ñ—Å—É “õ–∞—Ç–∞“£ —Ç—ã–π—ã–º —Å–∞–ª—ã–Ω–∞–¥—ã.'
          },
          {
            heading: '5. –ñ–∞—É–∞–ø–∫–µ—Ä—à—ñ–ª—ñ–∫',
            content: '–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –∫”©–ª—ñ–∫—Ç—ñ“£ —Ç–µ—Ö–Ω–∏–∫–∞–ª—ã“õ –∂–∞“ì–¥–∞–π—ã, –∂“Ø–∫—Ç—ñ“£ “õ–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–≥—ñ –∂”ô–Ω–µ “õ—ã–∑–º–µ—Ç—Ç—ñ“£ —Å–∞–ø–∞—Å—ã “Ø—à—ñ–Ω –∂–∞—É–∞–ø—Ç—ã. –ó–∞“õ—ã–º –∫–µ–ª—Ç—ñ—Ä—É –Ω–µ–º–µ—Å–µ –∫–µ–ª—ñ—Å–ø–µ—É—à—ñ–ª—ñ–∫—Ç–µ—Ä –∂–∞“ì–¥–∞–π—ã–Ω–¥–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–µ–ª–¥–∞–ª–¥—ã“õ “õ—ã–∑–º–µ—Ç—ñ–Ω “±—Å—ã–Ω–∞ –∞–ª–∞–¥—ã.'
          },
          {
            heading: '6. –ö–µ–ª—ñ—Å—ñ–º–¥—ñ –±“±–∑—É',
            content: '–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –µ—Ä–µ–∂–µ–ª–µ—Ä–¥—ñ –±“±–∑—É, —Ç”©—Ç–µ–Ω—à–µ –∂–∞“ì–¥–∞–π–ª–∞—Ä –Ω–µ–º–µ—Å–µ –∑–∞“£–¥—ã —Ç–∞–ª–∞–ø—Ç–∞—Ä –∂–∞“ì–¥–∞–π—ã–Ω–¥–∞ –∂“Ø—Ä–≥—ñ–∑—É—à—ñ–Ω—ñ“£ —Ç—ñ—Ä–∫–µ–ª—É—ñ–Ω —Ç–æ“õ—Ç–∞—Ç–∞ –∞–ª–∞–¥—ã –Ω–µ–º–µ—Å–µ —Ç–æ“õ—Ç–∞—Ç–∞ —Ç“±—Ä–∞ –∞–ª–∞–¥—ã. –ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –∫–µ–∑ –∫–µ–ª–≥–µ–Ω —É–∞“õ—ã—Ç—Ç–∞ ”©–∑ –µ—Ä–∫—ñ–º–µ–Ω –ø—Ä–æ—Ñ–∏–ª—ñ–Ω –∂–æ—è –∞–ª–∞–¥—ã.'
          },
          {
            heading: '7. “ö–æ–ª–¥–∞–Ω—É –µ—Ä–µ–∂–µ–ª–µ—Ä—ñ',
            content: '–ë“±–ª –∫–µ–ª—ñ—Å—ñ–º “ö–∞–∑–∞“õ—Å—Ç–∞–Ω –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã–Ω—ã“£ –∑–∞“£–Ω–∞–º–∞—Å—ã–Ω–∞ —Å”ô–π–∫–µ—Å —Ä–µ—Ç—Ç–µ–ª–µ–¥—ñ. –î–∞—É–ª–∞—Ä –∫–µ–ª—ñ—Å—Å”©–∑–¥–µ—Ä –∞—Ä“õ—ã–ª—ã —à–µ—à—ñ–ª–µ–¥—ñ, –∞–ª —à–µ—à—ñ–ª–º–µ–≥–µ–Ω –∂–∞“ì–¥–∞–π–¥–∞ “õ“±–∑—ã—Ä–µ—Ç—Ç—ñ —Å–æ—Ç“õ–∞ –∂“Ø–≥—ñ–Ω–µ–¥—ñ.'
          }
        ]
      },
      ru: {
        title: '–û—Ñ–µ—Ä—Ç–∞ –¥–ª—è –≤–æ–¥–∏—Ç–µ–ª–µ–π',
        sections: [
          {
            heading: '1. –£—Å–ª–æ–≤–∏—è —Å–æ–≥–ª–∞—à–µ–Ω–∏—è',
            content: '–ù–∞—Å—Ç–æ—è—â–∞—è –æ—Ñ–µ—Ä—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —É—Å–ª–æ–≤–∏—è –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥ –≤–æ–¥–∏—Ç–µ–ª—è –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ Alash-Go. –ò—Å–ø–æ–ª—å–∑—É—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—É, –≤–æ–¥–∏—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å–≤–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ —Å –¥–∞–Ω–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏.'
          },
          {
            heading: '2. –û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –≤–æ–¥–∏—Ç–µ–ª—è',
            content: '–í–æ–¥–∏—Ç–µ–ª—å –æ–±—è–∑–∞–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ç–æ—á–Ω—É—é –∏ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, —Å–ª–µ–¥–∏—Ç—å –∑–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤–æ–∂–¥–µ–Ω–∏–µ. –í–æ–¥–∏—Ç–µ–ª—å –æ–±—è–∑—É–µ—Ç—Å—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —É—Å–ª—É–≥–∏ —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ –≤–µ–∂–ª–∏–≤–æ –æ–±—â–∞—Ç—å—Å—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏.'
          },
          {
            heading: '3. –£—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã',
            content: '–û–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ –≤–æ–¥–∏—Ç–µ–ª–µ–º –ø–æ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –Ω–µ –±–µ—Ä–µ—Ç –∫–æ–º–∏—Å—Å–∏—é –∏–ª–∏ –º–æ–∂–µ—Ç –≤–∑–∏–º–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç. –í—Å–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã.'
          },
          {
            heading: '4. –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –∏ –∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö',
            content: '–í–æ–¥–∏—Ç–µ–ª—å –æ–±—è–∑–∞–Ω —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö —Ç–æ–ª—å–∫–æ –¥–ª—è —Ü–µ–ª–µ–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥. –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º —Å—Ç—Ä–æ–≥–æ –∑–∞–ø—Ä–µ—â–µ–Ω–∞.'
          },
          {
            heading: '5. –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å',
            content: '–í–æ–¥–∏—Ç–µ–ª—å –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞, —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –≥—Ä—É–∑–∞ –∏ –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã—Ö —É—Å–ª—É–≥. –í —Å–ª—É—á–∞–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π –∏–ª–∏ —Å–ø–æ—Ä–æ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –º–æ–∂–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å—Ä–µ–¥–Ω–∏—á–µ—Å–∫–∏–µ —É—Å–ª—É–≥–∏.'
          },
          {
            heading: '6. –†–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è',
            content: '–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–ª–∏ –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤–æ–¥–∏—Ç–µ–ª—è –≤ —Å–ª—É—á–∞–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª, —á—Ä–µ–∑–≤—ã—á–∞–π–Ω—ã—Ö –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤ –∏–ª–∏ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –∑–∞–∫–æ–Ω–∞. –í–æ–¥–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ —É–¥–∞–ª–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è.'
          },
          {
            heading: '7. –ü—Ä–∏–º–µ–Ω–∏–º–æ–µ –ø—Ä–∞–≤–æ',
            content: '–ù–∞—Å—Ç–æ—è—â–µ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç—Å—è –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –†–µ—Å–ø—É–±–ª–∏–∫–∏ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω. –°–ø–æ—Ä—ã —Ä–µ—à–∞—é—Ç—Å—è –ø—É—Ç–µ–º –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤, –∞ –≤ —Å–ª—É—á–∞–µ –Ω–µ—É—Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –≤ –∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ–º —Å—É–¥–µ.'
          }
        ]
      }
    };

    document.addEventListener('DOMContentLoaded', () => {
      initLanguage();
      initializeTelegram();
      setupEventListeners();
      updateProgress();
    });

    function initLanguage() {
      const lang = new URLSearchParams(window.location.search).get('lang');
      if (lang === 'kz' || lang === 'ru') currentLang = lang;
      applyTranslations();
    }

    function applyTranslations() {
      document.querySelectorAll('[data-kz]').forEach(el => {
        const text = el.getAttribute('data-' + currentLang);
        if (!text) return;
        if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.placeholder = text;
        else el.textContent = text;
      });
      document.querySelectorAll('[data-placeholder-kz]').forEach(el => {
        const text = el.getAttribute('data-placeholder-' + currentLang);
        if (text) el.placeholder = text;
      });
    }

    function applyTheme(isDark) {
      document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
    }

    function initializeTelegram() {
      if (!window.Telegram?.WebApp) return;
      const tg = Telegram.WebApp;
      tg.ready();
      tg.expand();
      tg.enableClosingConfirmation();
      tg.disableVerticalSwipes();

      const updateHeight = () => {
        const vh = tg.viewportStableHeight || window.innerHeight;
        document.documentElement.style.setProperty('--tg-viewport-stable-height', vh + 'px');
        document.documentElement.style.setProperty('--tg-safe-top', (tg.safeAreaInset?.top || 0) + 'px');
        document.documentElement.style.setProperty('--tg-safe-bottom', (tg.safeAreaInset?.bottom || 0) + 'px');
      };
      updateHeight();
      tg.onEvent('viewportChanged', updateHeight);

      const user = tg.initDataUnsafe?.user;
      if (user) {
        document.getElementById('telegramId').value = String(user.id || '');
        document.getElementById('tgUsername').textContent = user.username ? '@' + user.username : (user.first_name || 'Telegram user');
        document.getElementById('tgUsernameHidden').value = user.username || '';
        document.getElementById('tgPhotoUrlHidden').value = user.photo_url || '';

        const avatarWrap = document.getElementById('tgAvatar');
        const avatarImg = document.getElementById('tgAvatarImg');
        if (user.photo_url) {
          avatarImg.src = user.photo_url;
          avatarImg.onload = () => {
            avatarImg.style.display = 'block';
            avatarWrap.textContent = '';
            avatarWrap.appendChild(avatarImg);
          };
        }
      }

      applyTheme(tg.colorScheme === 'dark');
      tg.onEvent('themeChanged', () => applyTheme(tg.colorScheme === 'dark'));
      tg.MainButton.hide();

      queueMicrotask(() => checkOffertaStatus(true));
    }

    function setupEventListeners() {
      const form = document.getElementById('driverForm');
      form.querySelectorAll('input[required]').forEach(input => {
        input.addEventListener('blur', () => validateField(input));
        input.addEventListener('input', () => updateProgress());
      });

      document.getElementById('profilePhoto').addEventListener('change', handlePhotoChange);
      document.getElementById('licenseFront').addEventListener('change', e => handleFileChange(e, 'licenseFrontField'));
      document.getElementById('licenseBack').addEventListener('change', e => handleFileChange(e, 'licenseBackField'));
      setupPhoneMask(document.getElementById('contactNumber'));
      document.getElementById('gpsBtn').addEventListener('click', getCurrentLocation);

      const truckInput = document.getElementById('truckNumber');
      truckInput.addEventListener('input', () => {
        truckInput.value = truckInput.value.toUpperCase().replace(/\s+/g, '');
        scheduleTruckNumberCheck(truckInput.value);
      });
      truckInput.addEventListener('blur', () => scheduleTruckNumberCheck(truckInput.value, true));

      // Offerta events
      const agreeCheck = document.getElementById('agreeCheck');
      const agreeCb = document.getElementById('offertaAgree');
      const openBtn = document.getElementById('openOffertaBtn');
      const acceptBtn = document.getElementById('acceptOffertaBtn');
      const refreshBtn = document.getElementById('refreshOffertaBtn');

      const syncAgreeUI = (checked) => {
        agreeCheck.setAttribute('data-checked', checked ? 'true' : 'false');
        agreeCb.checked = !!checked;
        acceptBtn.disabled = !(checked && !offertaAccepted && !offertaChecking);
      };

      agreeCheck.addEventListener('click', () => {
        if (offertaAccepted) return;
        const next = !agreeCb.checked;
        syncAgreeUI(next);
        hideOffertaMsgs();
        updateProgress();
      });

      agreeCb.addEventListener('change', () => {
        if (offertaAccepted) return;
        syncAgreeUI(agreeCb.checked);
        hideOffertaMsgs();
        updateProgress();
      });

      openBtn.addEventListener('click', () => openOffertaModal());
      refreshBtn.addEventListener('click', () => checkOffertaStatus(true));
      acceptBtn.addEventListener('click', () => acceptOfferta());

      // Modal events
      document.getElementById('closeOffertaModalBtn').addEventListener('click', closeOffertaModal);
      document.getElementById('offertaModal').addEventListener('click', (e) => {
        if (e.target && e.target.id === 'offertaModal') closeOffertaModal();
      });

      document.getElementById('offertaModalScrollTopBtn').addEventListener('click', () => {
        const body = document.querySelector('#offertaModal .sheet-body');
        if (body) body.scrollTo({ top: 0, behavior: 'smooth' });
      });

      document.getElementById('offertaModalAcceptBtn').addEventListener('click', async () => {
        if (!offertaAccepted) {
          syncAgreeUI(true);
          await acceptOfferta();
        }
        closeOffertaModal();
      });

      syncAgreeUI(false);
    }

    // FIXED: Open offerta with embedded content (no iframe)
    function openOffertaModal() {
      const modal = document.getElementById('offertaModal');
      const contentDiv = document.getElementById('offertaContent');
      
      // Populate with offerta content
      const offertaData = OFFERTA_TEXT[currentLang];
      let html = `<h2>${offertaData.title}</h2>`;
      offertaData.sections.forEach(section => {
        html += `
          <h3>${section.heading}</h3>
          <p>${section.content}</p>
        `;
      });
      contentDiv.innerHTML = html;

      modal.classList.add('active');
      modal.setAttribute('aria-hidden', 'false');
      document.body.classList.add('modal-open');
    }

    function closeOffertaModal() {
      const modal = document.getElementById('offertaModal');
      modal.classList.remove('active');
      modal.setAttribute('aria-hidden', 'true');
      document.body.classList.remove('modal-open');
    }

    function getTelegramIdNumber() {
      const hidden = (document.getElementById('telegramId').value || '').trim();
      if (hidden && /^\d+$/.test(hidden)) return Number(hidden);

      const uid = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
      if (uid) {
        document.getElementById('telegramId').value = String(uid);
        return Number(uid);
      }
      return 0;
    }

    function extractAcceptedFlag(data) {
      return !!(
        data?.approved === true ||
        data?.accepted === true ||
        data?.is_accepted === true ||
        data?.isApproved === true ||
        data?.isAccepted === true
      );
    }

    async function tryFetchJSON(url, init) {
      const res = await fetch(url, init);
      const data = await res.json().catch(() => ({}));
      return { res, data };
    }

    async function checkOffertaStatus(force=false) {
      const tgId = getTelegramIdNumber();
      if (!tgId) return;

      if (offertaChecking && !force) return;

      offertaChecking = true;
      showOffertaPending(currentLang === 'kz' ? '–¢–µ–∫—Å–µ—Ä—ñ–ª—É–¥–µ...' : '–ü—Ä–æ–≤–µ—Ä–∫–∞...');
      document.getElementById('acceptOffertaBtn').disabled = true;

      try {
        let out;
        try {
          const url = `${API_OFFERTA_STATUS_GET}?telegram_id=${encodeURIComponent(tgId)}&role=${encodeURIComponent(OFFERTA_ROLE)}`;
          out = await tryFetchJSON(url, { method: 'GET', cache: 'no-store' });
        } catch {
          out = null;
        }

        if (!out || !out.res) {
          out = await tryFetchJSON(API_OFFERTA_STATUS_POST, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ telegram_id: Number(tgId), role: OFFERTA_ROLE })
          });
        }

        const { res, data } = out;

        offertaChecking = false;

        if (!res.ok || !data) {
          showOffertaBad(currentLang === 'kz' ? '–û—Ñ–µ—Ä—Ç–∞ —Å—Ç–∞—Ç—É—Å—ã–Ω –∞–ª—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã' : '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ—Ñ–µ—Ä—Ç—ã');
          setOffertaAccepted(false, true);
          updateProgress();
          return;
        }

        const accepted = extractAcceptedFlag(data);

        if (accepted) {
          setOffertaAccepted(true, true);
          showOffertaOk(currentLang === 'kz' ? '–û—Ñ–µ—Ä—Ç–∞ “õ–∞–±—ã–ª–¥–∞–Ω–¥—ã ‚úÖ' : '–û—Ñ–µ—Ä—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∞ ‚úÖ');
        } else {
          setOffertaAccepted(false, true);
          hideOffertaMsgs();
        }
        updateProgress();
      } catch {
        offertaChecking = false;
        showOffertaBad(currentLang === 'kz' ? '–ñ–µ–ª—ñ “õ–∞—Ç–µ—Å—ñ (–æ—Ñ–µ—Ä—Ç–∞)' : '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ (–æ—Ñ–µ—Ä—Ç–∞)');
        setOffertaAccepted(false, true);
        updateProgress();
      }
    }

    async function acceptOfferta() {
      const tgId = getTelegramIdNumber();
      if (!tgId) {
        showOffertaBad(currentLang === 'kz' ? 'Telegram ID –∂–æ“õ' : '–ù–µ—Ç Telegram ID');
        return;
      }
      if (offertaAccepted) return;

      const agreeCb = document.getElementById('offertaAgree');
      if (!agreeCb.checked) {
        showOffertaBad(currentLang === 'kz' ? '–ê–ª–¥—ã–º–µ–Ω –∫–µ–ª—ñ—Å—ñ–º –±–µ–ª–≥—ñ—Å—ñ–Ω “õ–æ–π—ã“£—ã–∑' : '–°–Ω–∞—á–∞–ª–∞ –ø–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫—É —Å–æ–≥–ª–∞—Å–∏—è');
        return;
      }

      offertaChecking = true;
      showOffertaPending(currentLang === 'kz' ? '“ö–∞–±—ã–ª–¥–∞–Ω—É–¥–∞...' : '–ü—Ä–∏–Ω—è—Ç–∏–µ...');
      document.getElementById('acceptOffertaBtn').disabled = true;

      const payload = JSON.stringify({ telegram_id: Number(tgId), role: OFFERTA_ROLE });

      try {
        let out = await tryFetchJSON(API_OFFERTA_APPROVE, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: payload
        });

        if (!out.res.ok) {
          out = await tryFetchJSON(API_OFFERTA_ACCEPT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: payload
          });
        }

        const { res, data } = out;

        offertaChecking = false;

        if (res.ok && (data?.success === true || extractAcceptedFlag(data) === true)) {
          setOffertaAccepted(true, true);
          showOffertaOk(currentLang === 'kz' ? '–û—Ñ–µ—Ä—Ç–∞ “õ–∞–±—ã–ª–¥–∞–Ω–¥—ã ‚úÖ' : '–û—Ñ–µ—Ä—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∞ ‚úÖ');
        } else {
          setOffertaAccepted(false, true);
          showOffertaBad((data && data.message) ? data.message : (currentLang === 'kz' ? '“ö–∞–±—ã–ª–¥–∞—É —Å”ô—Ç—Å—ñ–∑' : '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–Ω—è—Ç—å'));
        }
        updateProgress();
      } catch (e) {
        offertaChecking = false;
        setOffertaAccepted(false, true);
        showOffertaBad(currentLang === 'kz' ? '–ñ–µ–ª—ñ “õ–∞—Ç–µ—Å—ñ (“õ–∞–±—ã–ª–¥–∞—É)' : '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ (–ø—Ä–∏–Ω—è—Ç–∏–µ)');
        updateProgress();
      }
    }

    function setOffertaAccepted(accepted, touchCheckbox) {
      offertaAccepted = !!accepted;
      document.getElementById('offertaAcceptedHidden').value = accepted ? 'true' : '';

      const agreeCheck = document.getElementById('agreeCheck');
      const agreeCb = document.getElementById('offertaAgree');

      if (accepted) {
        agreeCheck.setAttribute('data-checked', 'true');
        agreeCb.checked = true;
        agreeCb.disabled = true;
        agreeCheck.style.pointerEvents = 'none';
        document.getElementById('acceptOffertaBtn').disabled = true;
      } else {
        agreeCb.disabled = false;
        agreeCheck.style.pointerEvents = '';
        if (touchCheckbox) {
          agreeCheck.setAttribute('data-checked', agreeCb.checked ? 'true' : 'false');
          document.getElementById('acceptOffertaBtn').disabled = !(agreeCb.checked && !offertaChecking);
        }
      }
    }

    function hideOffertaMsgs() {
      document.getElementById('offertaOk').style.display = 'none';
      document.getElementById('offertaBad').style.display = 'none';
      document.getElementById('offertaPending').style.display = 'none';
    }
    function showOffertaOk(msg) {
      hideOffertaMsgs();
      const ok = document.getElementById('offertaOk');
      ok.textContent = msg;
      ok.className = 'agree-status ok';
      ok.style.display = 'block';
    }
    function showOffertaBad(msg) {
      hideOffertaMsgs();
      const bad = document.getElementById('offertaBad');
      bad.textContent = msg;
      bad.className = 'agree-status bad';
      bad.style.display = 'block';
    }
    function showOffertaPending(msg) {
      hideOffertaMsgs();
      const p = document.getElementById('offertaPending');
      p.textContent = msg;
      p.className = 'agree-status pending';
      p.style.display = 'block';
    }

    function selectTruck(type) {
      selectedTruckType = type;
      document.getElementById('truckType').value = type;
      document.querySelectorAll('.truck-card').forEach(c => c.classList.remove('selected'));
      const el = document.querySelector(`[data-truck="${type}"]`);
      if (el) el.classList.add('selected');
      const err = document.getElementById('truckTypeError');
      if (err) err.style.display = 'none';
      updateProgress();
    }

    function handlePhotoChange(e) {
      const file = e.target.files[0];
      if (!file) return;
      if (file.size > MAX_FILE_BYTES) {
        showError('profilePhotoError', currentLang === 'kz' ? '–§–∞–π–ª —Ç—ã–º “Ø–ª–∫–µ–Ω (–º–∞–∫—Å. 10MB)' : '–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 10MB)');
        e.target.value = '';
        return;
      }
      const reader = new FileReader();
      reader.onload = ev => {
        document.getElementById('photoPreview').innerHTML = `<img src="${ev.target.result}" alt="Profile">`;
        document.getElementById('photoPreview').classList.add('has-photo');
      };
      reader.readAsDataURL(file);
      validateField(e.target);
      updateProgress();
    }

    function handleFileChange(e, fieldId) {
      const file = e.target.files[0];
      if (!file) return;
      if (file.size > MAX_FILE_BYTES) {
        showError(e.target.id + 'Error', currentLang === 'kz' ? '–§–∞–π–ª —Ç—ã–º “Ø–ª–∫–µ–Ω (–º–∞–∫—Å. 10MB)' : '–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 10MB)');
        e.target.value = '';
        return;
      }
      const field = document.getElementById(fieldId);
      field.classList.add('has-file');
      field.querySelector('.file-text').textContent = file.name;
      field.querySelector('.file-icon').textContent = '‚úÖ';
      validateField(e.target);
      updateProgress();
    }

    function setupPhoneMask(input) {
      if (!input) return;
      const build = digits => {
        let d = digits;
        if (d.startsWith('8')) d = '7' + d.slice(1);
        if (!d.startsWith('7')) d = '7' + d;
        d = d.slice(0, 11);
        const a = (d.slice(1,4) + '___').slice(0,3);
        const b = (d.slice(4,7) + '___').slice(0,3);
        const c = (d.slice(7,9) + '__').slice(0,2);
        const e = (d.slice(9,11) + '__').slice(0,2);
        return `+7 (${a}) ${b}-${c}-${e}`;
      };
      const onlyDigits = s => (s||'').replace(/\D/g,'');
      const mapCaret = (m,p) => {
        const f = m.indexOf('_');
        if (f===-1) return m.length;
        if (p<f) return f;
        return p;
      };
      const set = (v,c) => { input.value=v; requestAnimationFrame(()=>input.setSelectionRange(c,c)); };

      input.addEventListener('focus', () => {
        if (!input.value) { const v=build('7'); set(v,v.indexOf('_')); }
        else { const v=build(onlyDigits(input.value)); set(v,mapCaret(v,input.selectionStart||v.indexOf('_'))); }
      });
      input.addEventListener('keydown', e => {
        if ((e.key==='Backspace'||e.key==='Delete') && (input.selectionStart||0)<=4) e.preventDefault();
      });
      input.addEventListener('input', () => {
        const c=input.selectionStart||0, v=build(onlyDigits(input.value));
        set(v,mapCaret(v,c));
        validateField(input);
        updateProgress();
      });
      input.addEventListener('click', () => {
        if (!input.value) { const v=build('7'); set(v,v.indexOf('_')); return; }
        const p=input.selectionStart||0, c=mapCaret(input.value,p);
        if (c!==p) requestAnimationFrame(()=>input.setSelectionRange(c,c));
      });
      input.addEventListener('blur', () => {
        if (onlyDigits(input.value)==='7') input.value='';
        validateField(input);
      });
    }

    let truckTimer = null;
    function scheduleTruckNumberCheck(value, immediate=false) {
      const tn = (value||'').toUpperCase().replace(/\s+/g,'');
      if (!tn) {
        truckNumberState={lastChecked:'',available:false,checking:false};
        clearTruckMsgs();
        setTruckVisual(null);
        updateProgress();
        return;
      }
      if (tn.length<5||tn.length>15) {
        truckNumberState={lastChecked:'',available:false,checking:false};
        showTruckErr(currentLang==='kz'?'–ù”©–º—ñ—Ä —Ñ–æ—Ä–º–∞—Ç—ã –¥“±—Ä—ã—Å –µ–º–µ—Å':'–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç');
        updateProgress();
        return;
      }
      if (truckTimer) clearTimeout(truckTimer);
      truckTimer = setTimeout(() => checkTruckServer(tn), immediate?0:450);
    }

    async function checkTruckServer(tn) {
      if (truckNumberState.checking && truckNumberState.lastChecked===tn) return;
      if (truckNumberState.lastChecked===tn && truckNumberState.available!==null) { updateProgress(); return; }
      truckNumberState.checking=true; truckNumberState.lastChecked=tn;

      clearTruckMsgs();
      showTruckPending(currentLang==='kz'?'–¢–µ–∫—Å–µ—Ä—ñ–ª—É–¥–µ...':'–ü—Ä–æ–≤–µ—Ä–∫–∞...');
      document.getElementById('truckNumber').classList.remove('error','success');
      document.getElementById('truckNumber').classList.add('pending');

      try {
        const res = await fetch(API_TRUCK_CHECK, {
          method:'PATCH',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({truck_number:tn})
        });
        const data = await res.json().catch(()=>({}));
        truckNumberState.checking=false;

        if (!res.ok||!data||data.success!==true) {
          truckNumberState.available=false;
          showTruckErr(currentLang==='kz'?'–°–µ—Ä–≤–µ—Ä “õ–∞—Ç–µ—Å—ñ':'–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
          updateProgress();
          return;
        }

        if (data.available) {
          truckNumberState.available=true;
          showTruckOk(currentLang==='kz'?'–ù”©–º—ñ—Ä –±–æ—Å':'–ù–æ–º–µ—Ä —Å–≤–æ–±–æ–¥–µ–Ω');
        } else {
          truckNumberState.available=false;
          showTruckErr(data.message||(currentLang==='kz'?'–ù”©–º—ñ—Ä –±–æ—Å –µ–º–µ—Å':'–ù–æ–º–µ—Ä –∑–∞–Ω—è—Ç'));
        }
        updateProgress();
      } catch {
        truckNumberState.checking=false;
        truckNumberState.available=false;
        showTruckErr(currentLang==='kz'?'–ñ–µ–ª—ñ “õ–∞—Ç–µ—Å—ñ':'–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
        updateProgress();
      }
    }

    function clearTruckMsgs() {
      ['truckNumberError','truckNumberSuccess','truckNumberPending'].forEach(id=>{
        const e=document.getElementById(id);
        if(e)e.style.display='none';
      });
    }
    function setTruckVisual(s) {
      const i=document.getElementById('truckNumber');
      i.classList.remove('error','success','pending');
      if(s)i.classList.add(s);
    }
    function showTruckErr(m) {
      clearTruckMsgs();
      setTruckVisual('error');
      const e=document.getElementById('truckNumberError');
      e.textContent=m; e.classList.add('error'); e.style.display='block';
    }
    function showTruckOk(m) {
      clearTruckMsgs();
      setTruckVisual('success');
      const e=document.getElementById('truckNumberSuccess');
      e.textContent=m; e.classList.add('success'); e.style.display='block';
    }
    function showTruckPending(m) {
      clearTruckMsgs();
      setTruckVisual('pending');
      const e=document.getElementById('truckNumberPending');
      e.textContent=m; e.classList.add('pending'); e.style.display='block';
    }

    function getCurrentLocation() {
      const btn = document.getElementById('gpsBtn'), input = document.getElementById('startCity');
      if (!navigator.geolocation) { showError('startCityError', currentLang==='kz'?'–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è “õ–æ–ª–¥–∞—É –∫”©—Ä—Å–µ—Ç—ñ–ª–º–µ–π–¥—ñ':'–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è'); return; }
      btn.classList.add('loading'); btn.textContent='‚è≥';

      navigator.geolocation.getCurrentPosition(
        async pos => {
          const {latitude:lat,longitude:lon} = pos.coords;
          try {
            const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&addressdetails=1`, { cache: 'no-store' });
            const data = await res.json();
            if (data?.address) {
              input.value = data.address.city||data.address.town||data.address.village||data.address.state||(data.display_name?.split(',')[0]||'');
              document.getElementById('latitude').value=lat;
              document.getElementById('longitude').value=lon;
              btn.classList.remove('loading'); btn.classList.add('success'); btn.textContent='‚úÖ';
              showSuccess('startCitySuccess', currentLang==='kz'?'–û—Ä–Ω–∞–ª–∞—Å“õ–∞–Ω –∂–µ—Ä –∞–Ω—ã“õ—Ç–∞–ª–¥—ã':'–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ');
              setTimeout(()=>{btn.classList.remove('success');btn.textContent='üìç';},2000);
              validateField(input); updateProgress();
            }
          } catch {
            showError('startCityError', currentLang==='kz'?'“ö–∞–ª–∞–Ω—ã –∞–Ω—ã“õ—Ç–∞—É–¥–∞ “õ–∞—Ç–µ':'–û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è');
            btn.classList.remove('loading'); btn.textContent='üìç';
          }
        },
        err => {
          let msg = currentLang==='kz'?'–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è “õ–∞—Ç–µ—Å—ñ':'–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏';
          if (err.code===err.PERMISSION_DENIED) msg=currentLang==='kz'?'–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è“ì–∞ –∫—ñ—Ä—É —Ç—ã–π—ã–º —Å–∞–ª—ã–Ω“ì–∞–Ω':'–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω';
          else if (err.code===err.POSITION_UNAVAILABLE) msg=currentLang==='kz'?'–û—Ä–Ω–∞–ª–∞—Å“õ–∞–Ω –∂–µ—Ä “õ–æ–ª–∂–µ—Ç—ñ–º–¥—ñ –µ–º–µ—Å':'–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
          else if (err.code===err.TIMEOUT) msg=currentLang==='kz'?'–ö“Ø—Ç—É —É–∞“õ—ã—Ç—ã –∞—è“õ—Ç–∞–ª–¥—ã':'–í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ';
          showError('startCityError', msg);
          btn.classList.remove('loading'); btn.textContent='üìç';
        },
        {enableHighAccuracy:true,timeout:10000,maximumAge:0}
      );
    }

    function validateField(field) {
      const value = (field.value||'').trim(), id = field.id;
      let valid=true, msg='';
      field.classList.remove('error','success');
      const err = document.getElementById(id+'Error'); if(err)err.style.display='none';

      if (field.required && !value && field.type!=='file') {
        valid=false; msg=currentLang==='kz'?'–ë“±–ª ”©—Ä—ñ—Å –º—ñ–Ω–¥–µ—Ç—Ç—ñ':'–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
      }

      if (field.type==='file' && field.required) {
        if (!field.files.length) { valid=false; msg=currentLang==='kz'?'–§–∞–π–ª –º—ñ–Ω–¥–µ—Ç—Ç—ñ':'–§–∞–π–ª –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω'; }
        else if (field.files[0].size>MAX_FILE_BYTES) { valid=false; msg=currentLang==='kz'?'–§–∞–π–ª —Ç—ã–º “Ø–ª–∫–µ–Ω':'–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π'; }
      }

      if (id==='firstName'||id==='lastName') { if(value&&(value.length<2||value.length>50)){valid=false;msg=currentLang==='kz'?'2-50 —Å–∏–º–≤–æ–ª':'2-50 —Å–∏–º–≤–æ–ª–æ–≤';} }
      if (id==='birthday'&&value) { const age=new Date().getFullYear()-new Date(value).getFullYear(); if(age<18||age>80){valid=false;msg=currentLang==='kz'?'18-80 –∂–∞—Å':'–í–æ–∑—Ä–∞—Å—Ç 18-80';} }
      if (id==='contactNumber'&&value) {
        if(value.length<18){valid=false;msg=currentLang==='kz'?'–¢–æ–ª—ã“õ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑':'–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é';}
        else if(!/^\+7 \(\d{3}\) \d{3}-\d{2}-\d{2}$/.test(value)){valid=false;msg=currentLang==='kz'?'–§–æ—Ä–º–∞—Ç –¥“±—Ä—ã—Å –µ–º–µ—Å':'–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç';}
      }
      if (id==='truckNumber'&&value) { const v=value.toUpperCase().replace(/\s+/g,''); if(v.length<5||v.length>15){valid=false;msg=currentLang==='kz'?'–§–æ—Ä–º–∞—Ç –¥“±—Ä—ã—Å –µ–º–µ—Å':'–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç';} }

      if (valid && (value || field.files?.length)) field.classList.add('success');
      else if (!valid) { field.classList.add('error'); if(document.getElementById(id+'Error'))showError(id+'Error',msg); }
      return valid;
    }

    function showError(id,msg) {
      const e=document.getElementById(id);
      if(e){e.textContent=msg;e.classList.add('error');e.style.display='block';}
    }
    function showSuccess(id,msg) {
      const e=document.getElementById(id);
      if(e){
        e.textContent=msg;
        e.classList.add('success');
        e.style.display='block';
        setTimeout(()=>e.style.display='none',3000);
      }
    }

    function updateProgress() {
      const requiredFields = [
        'profilePhoto',
        'firstName',
        'lastName',
        'birthday',
        'contactNumber',
        'truckNumber',
        'truckType',
        'licenseFront',
        'licenseBack',
        'startCity',
        '__offerta_server__'
      ];

      let filled = 0;
      let total = requiredFields.length;

      for (const id of requiredFields) {
        if (id === '__offerta_server__') {
          if (offertaAccepted) filled++;
          continue;
        }
        const f = document.getElementById(id);
        if (!f) continue;

        if (f.type === 'file') {
          if (f.files && f.files.length) filled++;
          continue;
        }
        if (id === 'truckType') {
          if (selectedTruckType) filled++;
          continue;
        }
        if (id === 'truckNumber') {
          const v = (f.value || '').trim();
          if (v && truckNumberState.available && !truckNumberState.checking) filled++;
          continue;
        }
        if ((f.value || '').trim()) filled++;
      }

      const pct = Math.round((filled/total)*100);
      document.getElementById('progressFill').style.width=pct+'%';
      document.getElementById('progressText').textContent=pct+'%';

      if (window.Telegram?.WebApp) {
        if (pct===100) {
          Telegram.WebApp.MainButton.setText(currentLang==='kz'?'–¢—ñ—Ä–∫–µ–ª—É':'–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è');
          Telegram.WebApp.MainButton.show();
          Telegram.WebApp.MainButton.offClick(submitForm);
          Telegram.WebApp.MainButton.onClick(submitForm);
        } else {
          Telegram.WebApp.MainButton.hide();
        }
      }
    }

    async function submitForm() {
      const form = document.getElementById('driverForm');

      if (!offertaAccepted) {
        showOffertaBad(currentLang==='kz'?'–¢—ñ—Ä–∫–µ–ª—É “Ø—à—ñ–Ω –æ—Ñ–µ—Ä—Ç–∞–Ω—ã “õ–∞–±—ã–ª–¥–∞“£—ã–∑':'–î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–∏—Ç–µ –æ—Ñ–µ—Ä—Ç—É');
        window.Telegram?.WebApp
          ? Telegram.WebApp.showAlert(currentLang==='kz'?'–û—Ñ–µ—Ä—Ç–∞–Ω—ã “õ–∞–±—ã–ª–¥–∞–º–∞–π—ã–Ω—à–∞ —Ç—ñ—Ä–∫–µ—É –º“Ø–º–∫—ñ–Ω –µ–º–µ—Å':'–ù–µ–ª—å–∑—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –±–µ–∑ –ø—Ä–∏–Ω—è—Ç–∏—è –æ—Ñ–µ—Ä—Ç—ã')
          : alert('Offerta required');
        return;
      }

      const tgId = getTelegramIdNumber();
      if (!tgId) {
        window.Telegram?.WebApp ? Telegram.WebApp.showAlert(currentLang==='kz'?'Telegram ID –∞–ª—ã–Ω–±–∞–¥—ã':'–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID') : alert('No Telegram ID');
        return;
      }

      const tn = (document.getElementById('truckNumber').value||'').toUpperCase().replace(/\s+/g,'');
      if (!tn) { showTruckErr(currentLang==='kz'?'–ë“±–ª ”©—Ä—ñ—Å –º—ñ–Ω–¥–µ—Ç—Ç—ñ':'–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ'); return; }
      if (truckNumberState.checking) { showTruckPending(currentLang==='kz'?'–¢–µ–∫—Å–µ—Ä—ñ–ª—É–¥–µ...':'–ü—Ä–æ–≤–µ—Ä–∫–∞...'); return; }
      if (!truckNumberState.available) { showTruckErr(currentLang==='kz'?'–ù”©–º—ñ—Ä –±–æ—Å –µ–º–µ—Å':'–ù–æ–º–µ—Ä –∑–∞–Ω—è—Ç'); return; }

      const phone = (document.getElementById('contactNumber').value||'').trim();
      if (!/^\+7 \(\d{3}\) \d{3}-\d{2}-\d{2}$/.test(phone)) {
        showError('contactNumberError',currentLang==='kz'?'–¢–µ–ª–µ—Ñ–æ–Ω —Ç–æ–ª—ã“õ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑':'–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é');
        return;
      }

      let valid=true;
      form.querySelectorAll('input[required]').forEach(f => {
        if (f.id==='truckNumber') return;
        if (!validateField(f)) valid=false;
      });
      if (!selectedTruckType) { valid=false; showError('truckTypeError',currentLang==='kz'?'–ö”©–ª—ñ–∫ —Ç“Ø—Ä—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑':'–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø'); }
      if (!valid) {
        window.Telegram?.WebApp ? Telegram.WebApp.showAlert(currentLang==='kz'?'–ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑':'–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è') : alert('Fill required fields');
        return;
      }

      showLoading(currentLang==='kz'?'–¢—ñ—Ä–∫–µ–ª—ñ–ø –∂–∞—Ç—ã—Ä–º—ã–∑ üòä':'–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º üòä');

      try {
        const controller = new AbortController();
        const timeout = setTimeout(()=>controller.abort(),90000);

        document.getElementById('telegramId').value = String(tgId);

        const res = await fetch(API_DRIVER_REGISTER, {
          method:'POST',
          body:new FormData(form),
          signal:controller.signal
        });
        clearTimeout(timeout);

        const result = await res.json().catch(()=>({}));
        hideLoading();

        if (res.ok && result.success) {
          const msg = currentLang==='kz'
            ? '–¢—ñ—Ä–∫–µ–ª—É —Å”ô—Ç—Ç—ñ! –†–∞—Å—Ç–∞—É–¥—ã –∫“Ø—Ç—ñ“£—ñ–∑ üòä'
            : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è üòä';
          window.Telegram?.WebApp ? Telegram.WebApp.showAlert(msg,()=>Telegram.WebApp.close()) : alert(msg);
        } else {
          throw new Error(result.message||'Registration failed');
        }
      } catch (e) {
        hideLoading();
        const msg = e.name==='AbortError'
          ? (currentLang==='kz'?'–£–∞“õ—ã—Ç –∞—è“õ—Ç–∞–ª–¥—ã. –§–∞–π–ª –∫”©–ª–µ–º—ñ–Ω –∞–∑–∞–π—Ç—ã“£—ã–∑.':'–í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ. –£–º–µ–Ω—å—à–∏—Ç–µ —Ñ–∞–π–ª—ã.')
          : (currentLang==='kz'?`“ö–∞—Ç–µ: ${e.message}`:`–û—à–∏–±–∫–∞: ${e.message}`);
        window.Telegram?.WebApp ? Telegram.WebApp.showAlert(msg) : alert(msg);
      }
    }

    function showLoading(titleText) {
      const overlay = document.getElementById('loadingOverlay');
      overlay.classList.add('active');
      overlay.setAttribute('aria-hidden', 'false');

      const tTitle = document.getElementById('loadingTitle');
      const tSub = document.getElementById('loadingSubTitle');
      const tHint = document.getElementById('loadingText');
      const tTruck = document.getElementById('loadingTruckText');

      if (titleText) tTitle.textContent = titleText;

      if (currentLang === 'kz') {
        tSub.textContent = '”®—Ç—ñ–Ω–µ–º—ñ–∑, –∫“Ø—Ç–µ —Ç“±—Ä—ã“£—ã–∑ ‚Äî —Ç—ñ—Ä–∫–µ—É 5‚Äì10 —Å–µ–∫—É–Ω–¥ –∞–ª–∞–¥—ã üôÇ';
        tHint.textContent = '–°”ô–ª “ì–∞–Ω–∞ “õ–∞–ª–¥—ã ‚ú® –¢—ñ—Ä–∫–µ—É –∞—è“õ—Ç–∞–ª“ì–∞–Ω —Å–æ“£ –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ –∂–∞–±—ã–ª–∞–¥—ã.';
        tTruck.textContent = '–ñ–æ–ª–¥–∞...';
        document.getElementById('loadingEmoji').textContent = 'üßæ';
      } else {
        tSub.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–π–º–µ—Ç 5‚Äì10 —Å–µ–∫—É–Ω–¥ üôÇ';
        tHint.textContent = '–ü–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–æ ‚ú® –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä–æ–µ—Ç—Å—è.';
        tTruck.textContent = '–í –ø—É—Ç–∏...';
        document.getElementById('loadingEmoji').textContent = 'üßæ';
      }

      window.Telegram?.WebApp?.MainButton?.showProgress();
    }

    function hideLoading() {
      const overlay = document.getElementById('loadingOverlay');
      overlay.classList.remove('active');
      overlay.setAttribute('aria-hidden', 'true');
      window.Telegram?.WebApp?.MainButton?.hideProgress();
    }

    window.selectTruck = selectTruck;
  </script>
</body>
</html>