<!DOCTYPE html>
<html lang="kz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-visual" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Alash-Go - –ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —Ç—ñ—Ä–∫–µ–ª—É—ñ</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    /* =========================
       Figma Transportation Design System (LIGHT)
    ========================= */
    :root {
      --primary: #4C6FFF;
      --primary-dark: #3D5ACC;
      --secondary: #00D9B9;
      --success: #00D395;
      --warning: #FFB800;
      --danger: #FF5C5C;

      --dark: #1A1D29;
      --dark-light: #2A2F3F;

      --grey: #6B7280;
      --grey-light: #E5E7EB;

      --white: #FFFFFF;
      --bg: #F7F8FA;

      /* Theme utility tokens */
      --surface: var(--white);
      --surface-2: #F1F5F9;
      --border: rgba(15, 23, 42, 0.08);
      --input-bg: var(--white);
      --input-text: var(--dark);
      --placeholder: #9CA3AF;

      --radius: 16px;
      --radius-lg: 24px;
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.12);

      --tg-safe-top: env(safe-area-inset-top, 0px);
      --tg-safe-bottom: env(safe-area-inset-bottom, 0px);
      --tg-viewport-stable-height: 100vh;
    }

    /* =========================
       DARK THEME OVERRIDES
    ========================= */
    html[data-theme="dark"] {
      --bg: #0B1220;
      --white: #121A2B;
      --surface: #121A2B;
      --surface-2: #0F172A;

      --dark: #E5E7EB;
      --dark-light: #94A3B8;

      --grey: #9CA3AF;
      --grey-light: #1F2937;

      --border: rgba(148, 163, 184, 0.18);

      --input-bg: #0F172A;
      --input-text: #E5E7EB;
      --placeholder: #64748B;

      --shadow: 0 8px 28px rgba(0, 0, 0, 0.35);
      --shadow-lg: 0 12px 50px rgba(0, 0, 0, 0.45);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      height: 100%;
      overflow: hidden;
      position: fixed;
      width: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
      background: var(--bg);
      color: var(--dark);
    }

    body {
      height: var(--tg-viewport-stable-height, 100vh);
      padding-top: calc(var(--tg-safe-top, 0px) + 15px);
      padding-bottom: var(--tg-safe-bottom, 0px);
      background: var(--bg);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .container {
      max-width: 480px;
      margin: 0 auto;
      padding: 0 20px 160px;
      min-height: 100%;
    }

    /* Header */
    .header {
      text-align: center;
      padding: 20px 0 24px;
    }

    /* Telegram Header Profile */
    .tg-avatar-wrap {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
    }

    .tg-avatar {
      width: 88px;
      height: 88px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      border: 2px solid rgba(255,255,255,0.15);
    }

    .tg-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: none;
    }

    .tg-avatar.fallback {
      font-size: 36px;
      color: #fff;
      font-weight: 900;
    }

    .tg-username {
      text-align: center;
      font-size: 14px;
      font-weight: 800;
      color: var(--grey);
      margin-bottom: 8px;
    }

    .title {
      font-size: 28px;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 8px;
      letter-spacing: -0.5px;
    }

    .subtitle {
      font-size: 15px;
      color: var(--grey);
      font-weight: 500;
    }

    /* Global warning banner */
    .notice {
      margin: 16px 0 8px;
      padding: 14px 14px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,184,0,0.12), rgba(255,184,0,0.06));
      display: flex;
      gap: 10px;
      align-items: flex-start;
      text-align: left;
    }

    .notice .notice-ic {
      width: 28px; height: 28px;
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      background: rgba(255,184,0,0.18);
      border: 1px solid rgba(255,184,0,0.22);
      font-size: 16px;
      flex: 0 0 auto;
      margin-top: 1px;
    }

    .notice .notice-title {
      font-weight: 800;
      font-size: 13px;
      color: var(--dark);
      margin-bottom: 3px;
      letter-spacing: 0.2px;
      text-transform: uppercase;
    }

    .notice .notice-text {
      font-size: 13px;
      color: var(--grey);
      line-height: 1.45;
      font-weight: 600;
    }

    /* Progress Indicator */
    .progress-container {
      margin: 18px 0 22px;
    }

    .progress-bar {
      height: 4px;
      background: var(--grey-light);
      border-radius: 2px;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 2px;
      width: 0%;
      transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .progress-text {
      margin-top: 8px;
      font-size: 13px;
      color: var(--grey);
      text-align: center;
      font-weight: 700;
    }

    /* Form Sections */
    .form-section {
      margin-bottom: 28px;
    }

    .section-title {
      font-size: 17px;
      font-weight: 800;
      color: var(--dark);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-icon {
      font-size: 20px;
    }

    /* section hint */
    .section-hint {
      margin-top: -2px;
      margin-bottom: 14px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(76, 111, 255, 0.06);
      color: var(--grey);
      font-size: 12px;
      line-height: 1.45;
      font-weight: 600;
      display: flex;
      gap: 8px;
      align-items: flex-start;
    }
    .section-hint .hint-dot {
      width: 18px; height: 18px;
      border-radius: 7px;
      background: rgba(76, 111, 255, 0.14);
      border: 1px solid rgba(76, 111, 255, 0.18);
      display: flex; align-items: center; justify-content: center;
      font-size: 12px;
      flex: 0 0 auto;
      margin-top: 1px;
    }

    /* Profile Photo */
    .photo-upload {
      text-align: center;
      margin-bottom: 20px;
    }

    .photo-preview {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: var(--grey-light);
      margin: 0 auto 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      color: var(--grey);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      border: 3px solid transparent;
      user-select: none;
    }

    .photo-preview:active {
      transform: scale(0.95);
    }

    .photo-preview.has-photo {
      border-color: var(--success);
    }

    .photo-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .photo-label {
      font-size: 14px;
      color: var(--grey);
      font-weight: 600;
    }

    .photo-input {
      display: none;
    }

    /* Form Fields */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 14px;
    }

    .form-field {
      margin-bottom: 16px;
    }

    .field-label {
      display: block;
      font-size: 13px;
      font-weight: 700;
      color: var(--grey);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .field-input {
      width: 100%;
      padding: 16px;
      background: var(--input-bg);
      border: 2px solid transparent;
      border-radius: var(--radius);
      font-size: 16px;
      font-weight: 600;
      color: var(--input-text);
      transition: all 0.3s ease;
      font-family: inherit;

      -webkit-text-fill-color: var(--input-text);
      caret-color: var(--primary);
    }

    .field-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(76, 111, 255, 0.18);
    }

    .field-input::placeholder {
      color: var(--placeholder);
      font-weight: 500;
      -webkit-text-fill-color: var(--placeholder);
    }

    .field-input.error {
      border-color: var(--danger);
      background: rgba(255, 92, 92, 0.10);
    }

    .field-input.success {
      border-color: var(--success);
    }

    .field-input.pending {
      border-color: var(--warning);
      background: rgba(255, 184, 0, 0.10);
    }

    /* per-field warning text */
    .field-note {
      margin-top: 8px;
      font-size: 12px;
      line-height: 1.45;
      color: var(--grey);
      font-weight: 600;
      display: flex;
      gap: 8px;
      align-items: flex-start;
      opacity: 0.95;
    }

    .field-note .note-ic {
      width: 18px; height: 18px;
      border-radius: 7px;
      display: flex; align-items: center; justify-content: center;
      border: 1px solid var(--border);
      background: var(--surface-2);
      color: var(--dark);
      font-size: 12px;
      flex: 0 0 auto;
      margin-top: 1px;
    }

    .field-note.warning .note-ic{
      background: rgba(255,184,0,0.12);
      border-color: rgba(255,184,0,0.25);
    }

    /* File Upload */
    .file-field {
      position: relative;
      padding: 20px;
      background: var(--surface);
      border: 2px dashed var(--grey-light);
      border-radius: var(--radius);
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .file-field:hover {
      border-color: var(--primary);
      background: rgba(76, 111, 255, 0.04);
    }

    .file-field.has-file {
      border-color: var(--success);
      border-style: solid;
      background: rgba(0, 211, 149, 0.10);
    }

    .file-icon {
      font-size: 32px;
      margin-bottom: 8px;
    }

    .file-text {
      font-size: 14px;
      color: var(--grey);
      font-weight: 600;
      word-break: break-word;
    }

    .file-input {
      display: none;
    }

    /* Truck Type Selection */
    .truck-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 12px;
    }

    .truck-card {
      padding: 16px 12px;
      background: var(--surface);
      border: 2px solid transparent;
      border-radius: var(--radius);
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      user-select: none;
    }

    .truck-card:active {
      transform: scale(0.95);
    }

    .truck-card.selected {
      background: rgba(76, 111, 255, 0.16);
      border-color: var(--primary);
      box-shadow: 0 4px 16px rgba(76, 111, 255, 0.22);
    }

    .truck-card.selected::after {
      content: '‚úì';
      position: absolute;
      top: 8px;
      right: 8px;
      width: 20px;
      height: 20px;
      background: var(--primary);
      color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 800;
    }

    .truck-icon {
      font-size: 28px;
      margin-bottom: 8px;
    }

    .truck-name {
      font-size: 13px;
      font-weight: 800;
      color: var(--dark);
      margin-bottom: 2px;
    }

    .truck-desc {
      font-size: 11px;
      color: var(--grey);
      font-weight: 700;
    }

    /* Location Input */
    .location-group {
      position: relative;
    }

    .location-input {
      padding-right: 60px;
    }

    .gps-btn {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      width: 44px;
      height: 44px;
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 18px;
      color: var(--dark);
      user-select: none;
    }

    .gps-btn:active {
      transform: translateY(-50%) scale(0.9);
    }

    .gps-btn.loading {
      background: var(--warning);
      color: #fff;
      animation: pulse 1.5s infinite;
      border-color: transparent;
    }

    .gps-btn.success {
      background: var(--success);
      color: #fff;
      border-color: transparent;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* Error/Success Messages */
    .field-message {
      font-size: 12px;
      margin-top: 6px;
      font-weight: 800;
      display: none;
    }

    .field-message.error { color: var(--danger); display: block; }
    .field-message.success { color: var(--success); display: block; }
    .field-message.pending { color: var(--warning); display: block; }

    /* Submit Info */
    .submit-info {
      text-align: center;
      padding: 18px;
      background: rgba(76, 111, 255, 0.08);
      border-radius: var(--radius);
      margin-top: 24px;
      border: 1px solid var(--border);
    }

    .submit-info-text {
      font-size: 14px;
      color: var(--grey);
      line-height: 1.6;
      font-weight: 650;
    }

    .submit-info-icon {
      font-size: 32px;
      margin-bottom: 8px;
    }

    /* Final GPS access note (user asked) */
    .gps-final-note {
      margin-top: 14px;
      padding: 14px 14px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(0,217,185,0.10), rgba(0,217,185,0.05));
      display: flex;
      gap: 10px;
      align-items: flex-start;
      text-align: left;
    }
    .gps-final-note .ic {
      width: 28px; height: 28px;
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      background: rgba(0,217,185,0.18);
      border: 1px solid rgba(0,217,185,0.22);
      font-size: 16px;
      flex: 0 0 auto;
      margin-top: 1px;
    }
    .gps-final-note .t1 {
      font-weight: 900;
      font-size: 13px;
      color: var(--dark);
      margin-bottom: 3px;
      letter-spacing: 0.2px;
      text-transform: uppercase;
    }
    .gps-final-note .t2 {
      font-size: 13px;
      color: var(--grey);
      line-height: 1.45;
      font-weight: 650;
    }

    /* Loading Overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(26, 29, 41, 0.8);
      backdrop-filter: blur(10px);
      z-index: 9999;
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .loading-overlay.active {
      display: flex;
    }

    .loading-spinner {
      width: 56px;
      height: 56px;
      border: 4px solid rgba(255, 255, 255, 0.2);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      color: #fff;
      font-size: 16px;
      font-weight: 900;
    }

    /* Responsive */
    @media (max-width: 400px) {
      .truck-grid { grid-template-columns: repeat(2, 1fr); }
      .form-grid { grid-template-columns: 1fr; }
      .container { padding-bottom: 180px; }
    }
  </style>
</head>

<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text" id="loadingText" data-kz="–ñ“Ø–∫—Ç–µ–ª—É–¥–µ..." data-ru="–ó–∞–≥—Ä—É–∑–∫–∞...">–ñ“Ø–∫—Ç–µ–ª—É–¥–µ...</div>
  </div>

  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="tg-avatar-wrap">
        <div class="tg-avatar fallback" id="tgAvatar">üë§
          <img id="tgAvatarImg" alt="avatar" />
        </div>
      </div>

      <div class="tg-username" id="tgUsername">@user</div>

      <h1 class="title" data-kz="–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —Ç—ñ—Ä–∫–µ–ª—É—ñ" data-ru="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–æ–¥–∏—Ç–µ–ª—è">–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ —Ç—ñ—Ä–∫–µ–ª—É—ñ</h1>
      <p class="subtitle" data-kz="Alash-Go –∂“Ø–π–µ—Å—ñ–Ω–µ “õ–æ—Å—ã–ª—É “Ø—à—ñ–Ω –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑" data-ru="–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Alash-Go">
        Alash-Go –∂“Ø–π–µ—Å—ñ–Ω–µ “õ–æ—Å—ã–ª—É “Ø—à—ñ–Ω –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑
      </p>

      <div class="notice">
        <div class="notice-ic">‚ö†Ô∏è</div>
        <div>
          <div class="notice-title" data-kz="–ï–°–ö–ï–†–¢–£" data-ru="–í–ù–ò–ú–ê–ù–ò–ï">–ï–°–ö–ï–†–¢–£</div>
          <div class="notice-text"
               data-kz="”ò–∫—ñ–º—à—ñ –±–∞—Ä–ª—ã“õ –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —Ç–µ–∫—Å–µ—Ä–µ–¥—ñ. –¢–µ–∫ —à—ã–Ω–∞–π—ã –∞“õ–ø–∞—Ä–∞—Ç –∂–∞–∑—ã“£—ã–∑ –∂”ô–Ω–µ –Ω–∞“õ—Ç—ã “õ“±–∂–∞—Ç—Ç–∞—Ä–¥—ã –∂“Ø–∫—Ç–µ“£—ñ–∑. –ñ–∞–ª“ì–∞–Ω/“õ–∞—Ç–µ –º”ô–ª—ñ–º–µ—Ç —Ç—ñ—Ä–∫–µ—É–¥–µ–Ω –±–∞—Å —Ç–∞—Ä—Ç—É“ì–∞ ”ô–∫–µ–ª—É—ñ –º“Ø–º–∫—ñ–Ω."
               data-ru="–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ. –£–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –∑–∞–≥—Ä—É–∂–∞–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã. –õ–æ–∂–Ω—ã–µ/–æ—à–∏–±–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—Ç–∫–∞–∑—É –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.">
            ”ò–∫—ñ–º—à—ñ –±–∞—Ä–ª—ã“õ –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ —Ç–µ–∫—Å–µ—Ä–µ–¥—ñ. –¢–µ–∫ —à—ã–Ω–∞–π—ã –∞“õ–ø–∞—Ä–∞—Ç –∂–∞–∑—ã“£—ã–∑ –∂”ô–Ω–µ –Ω–∞“õ—Ç—ã “õ“±–∂–∞—Ç—Ç–∞—Ä–¥—ã –∂“Ø–∫—Ç–µ“£—ñ–∑. –ñ–∞–ª“ì–∞–Ω/“õ–∞—Ç–µ –º”ô–ª—ñ–º–µ—Ç —Ç—ñ—Ä–∫–µ—É–¥–µ–Ω –±–∞—Å —Ç–∞—Ä—Ç—É“ì–∞ ”ô–∫–µ–ª—É—ñ –º“Ø–º–∫—ñ–Ω.
          </div>
        </div>
      </div>
    </div>

    <!-- Progress -->
    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-text" id="progressText">0%</div>
    </div>

    <!-- Form -->
    <form id="driverForm" enctype="multipart/form-data">
      <!-- Profile Photo -->
      <div class="form-section">
        <div class="section-title">
          <span class="section-icon">üì∏</span>
          <span data-kz="–ü—Ä–æ—Ñ–∏–ª—å —Ñ–æ—Ç–æ—Å—ã" data-ru="–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è">–ü—Ä–æ—Ñ–∏–ª—å —Ñ–æ—Ç–æ—Å—ã</span>
        </div>

        <div class="section-hint">
          <div class="hint-dot">‚ÑπÔ∏è</div>
          <div data-kz="–§–æ—Ç–æ –∞–Ω—ã“õ –±–æ–ª—É—ã –∫–µ—Ä–µ–∫: –±–µ—Ç—ñ“£—ñ–∑ –∫”©—Ä—ñ–Ω—Å—ñ–Ω, —Ñ–∏–ª—å—Ç—Ä—Å—ñ–∑. ”ò–∫—ñ–º—à—ñ —Ç–µ–∫—Å–µ—Ä—É “Ø—à—ñ–Ω “õ–∞–∂–µ—Ç."
               data-ru="–§–æ—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–µ—Ç–∫–∏–º: –ª–∏—Ü–æ –≤–∏–¥–Ω–æ, –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤. –ù—É–∂–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.">
            –§–æ—Ç–æ –∞–Ω—ã“õ –±–æ–ª—É—ã –∫–µ—Ä–µ–∫: –±–µ—Ç—ñ“£—ñ–∑ –∫”©—Ä—ñ–Ω—Å—ñ–Ω, —Ñ–∏–ª—å—Ç—Ä—Å—ñ–∑. ”ò–∫—ñ–º—à—ñ —Ç–µ–∫—Å–µ—Ä—É “Ø—à—ñ–Ω “õ–∞–∂–µ—Ç.
          </div>
        </div>

        <div class="photo-upload">
          <div class="photo-preview" id="photoPreview" onclick="document.getElementById('profilePhoto').click()">üë§</div>
          <div class="photo-label" data-kz="–°—É—Ä–µ—Ç—Ç—ñ –∂“Ø–∫—Ç–µ—É (–º–∞–∫—Å. 10MB)" data-ru="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ (–º–∞–∫—Å. 10MB)">–°—É—Ä–µ—Ç—Ç—ñ –∂“Ø–∫—Ç–µ—É (–º–∞–∫—Å. 10MB)</div>
          <input type="file" id="profilePhoto" name="profilePhoto" class="photo-input" accept="image/*" capture="environment" required>
          <div class="field-message error" id="profilePhotoError"></div>

          <div class="field-note warning">
            <div class="note-ic">‚ö†Ô∏è</div>
            <div data-kz="–ë–∞—Å“õ–∞ –∞–¥–∞–º–Ω—ã“£ —Ñ–æ—Ç–æ—Å—ã–Ω –∂“Ø–∫—Ç–µ–º–µ“£—ñ–∑. –ñ–∞–ª“ì–∞–Ω –º”ô–ª—ñ–º–µ—Ç ‚Äî —Ç—ñ—Ä–∫–µ—É–¥–µ–Ω –±–∞—Å —Ç–∞—Ä—Ç—É."
                 data-ru="–ù–µ –∑–∞–≥—Ä—É–∂–∞–π—Ç–µ —Ñ–æ—Ç–æ –¥—Ä—É–≥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞. –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äî –æ—Ç–∫–∞–∑ –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.">
              –ë–∞—Å“õ–∞ –∞–¥–∞–º–Ω—ã“£ —Ñ–æ—Ç–æ—Å—ã–Ω –∂“Ø–∫—Ç–µ–º–µ“£—ñ–∑. –ñ–∞–ª“ì–∞–Ω –º”ô–ª—ñ–º–µ—Ç ‚Äî —Ç—ñ—Ä–∫–µ—É–¥–µ–Ω –±–∞—Å —Ç–∞—Ä—Ç—É.
            </div>
          </div>
        </div>
      </div>

      <!-- Personal Info -->
      <div class="form-section">
        <div class="section-title">
          <span class="section-icon">üë§</span>
          <span data-kz="–ñ–µ–∫–µ –º”ô–ª—ñ–º–µ—Ç—Ç–µ—Ä" data-ru="–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ">–ñ–µ–∫–µ –º”ô–ª—ñ–º–µ—Ç—Ç–µ—Ä</span>
        </div>

        <div class="section-hint">
          <div class="hint-dot">‚úÖ</div>
          <div data-kz="–ê—Ç—ã-–∂”©–Ω—ñ“£—ñ–∑ “õ“±–∂–∞—Ç—Ç–∞—Ä–¥–∞“ì—ã–¥–∞–π –±–æ–ª—É—ã –∫–µ—Ä–µ–∫. “ö–∞—Ç–µ–ª—ñ–∫ –±–æ–ª—Å–∞, ”ô–∫—ñ–º—à—ñ —Ç“Ø–∑–µ—Ç—É–≥–µ “õ–∞–π—Ç–∞ –∂—ñ–±–µ—Ä–µ–¥—ñ."
               data-ru="–§–ò–û –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏. –ü—Ä–∏ –æ—à–∏–±–∫–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.">
            –ê—Ç—ã-–∂”©–Ω—ñ“£—ñ–∑ “õ“±–∂–∞—Ç—Ç–∞—Ä–¥–∞“ì—ã–¥–∞–π –±–æ–ª—É—ã –∫–µ—Ä–µ–∫. “ö–∞—Ç–µ–ª—ñ–∫ –±–æ–ª—Å–∞, ”ô–∫—ñ–º—à—ñ —Ç“Ø–∑–µ—Ç—É–≥–µ “õ–∞–π—Ç–∞ –∂—ñ–±–µ—Ä–µ–¥—ñ.
          </div>
        </div>

        <div class="form-grid">
          <div class="form-field">
            <label class="field-label" data-kz="–ê—Ç—ã" data-ru="–ò–º—è">–ê—Ç—ã</label>
            <input type="text" class="field-input" id="firstName" name="firstName" required
                   data-placeholder-kz="–ê—Ç—ã“£—ã–∑–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑" data-placeholder-ru="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
            <div class="field-message error" id="firstNameError"></div>
            <div class="field-note">
              <div class="note-ic">‚ÑπÔ∏è</div>
              <div data-kz="“ö“±–∂–∞—Ç—Ç–∞“ì—ã–¥–∞–π –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑ (–ª–∞—Ç—ã–Ω/–∫–∏—Ä–∏–ª–ª “õ–∞–ª–∞–π —Ç“±—Ä ‚Äî —Å–æ–ª–∞–π)."
                   data-ru="–í–≤–µ–¥–∏—Ç–µ –∫–∞–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ (–ª–∞—Ç–∏–Ω–∏—Ü–∞/–∫–∏—Ä–∏–ª–ª–∏—Ü–∞ ‚Äî –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ).">
                “ö“±–∂–∞—Ç—Ç–∞“ì—ã–¥–∞–π –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑ (–ª–∞—Ç—ã–Ω/–∫–∏—Ä–∏–ª–ª “õ–∞–ª–∞–π —Ç“±—Ä ‚Äî —Å–æ–ª–∞–π).
              </div>
            </div>
          </div>

          <div class="form-field">
            <label class="field-label" data-kz="–¢–µ–≥—ñ" data-ru="–§–∞–º–∏–ª–∏—è">–¢–µ–≥—ñ</label>
            <input type="text" class="field-input" id="lastName" name="lastName" required
                   data-placeholder-kz="–¢–µ–≥—ñ“£—ñ–∑–¥—ñ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑" data-placeholder-ru="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é">
            <div class="field-message error" id="lastNameError"></div>
            <div class="field-note">
              <div class="note-ic">‚ÑπÔ∏è</div>
              <div data-kz="“ö—ã—Å“õ–∞—Ä—Ç—É—Å—ã–∑, —Ç–æ–ª—ã“õ –∂–∞–∑—ã“£—ã–∑."
                   data-ru="–ü–∏—à–∏—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é, –±–µ–∑ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π.">
                “ö—ã—Å“õ–∞—Ä—Ç—É—Å—ã–∑, —Ç–æ–ª—ã“õ –∂–∞–∑—ã“£—ã–∑.
              </div>
            </div>
          </div>
        </div>

        <div class="form-field">
          <label class="field-label" data-kz="–¢—É“ì–∞–Ω –∫“Ø–Ω—ñ" data-ru="–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è">–¢—É“ì–∞–Ω –∫“Ø–Ω—ñ</label>
          <input type="date" class="field-input" id="birthday" name="birthday" required max="2006-01-01">
          <div class="field-message error" id="birthdayError"></div>
          <div class="field-note warning">
            <div class="note-ic">‚ö†Ô∏è</div>
            <div data-kz="–ñ–∞—Å—ã“£—ã–∑ –±–µ–Ω “õ“±–∂–∞—Ç—ã“£—ã–∑ —Å”ô–π–∫–µ—Å –±–æ–ª—É—ã –∫–µ—Ä–µ–∫. –ñ–∞–ª“ì–∞–Ω –¥–∞—Ç–∞ ‚Äî —Ç—ñ—Ä–∫–µ—É —Ç–æ“õ—Ç–∞—Ç—ã–ª–∞–¥—ã."
                 data-ru="–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏. –õ–æ–∂–Ω–∞—è –¥–∞—Ç–∞ ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞.">
              –ñ–∞—Å—ã“£—ã–∑ –±–µ–Ω “õ“±–∂–∞—Ç—ã“£—ã–∑ —Å”ô–π–∫–µ—Å –±–æ–ª—É—ã –∫–µ—Ä–µ–∫. –ñ–∞–ª“ì–∞–Ω –¥–∞—Ç–∞ ‚Äî —Ç—ñ—Ä–∫–µ—É —Ç–æ“õ—Ç–∞—Ç—ã–ª–∞–¥—ã.
            </div>
          </div>
        </div>

        <div class="form-field">
          <label class="field-label" data-kz="–¢–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ" data-ru="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">–¢–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ</label>
          <input type="tel" class="field-input" id="contactNumber" name="contactNumber" required
                 placeholder="+7 (___) ___-__-__" autocomplete="tel" inputmode="tel">
          <div class="field-message error" id="contactNumberError"></div>
          <div class="field-note">
            <div class="note-ic">üì≤</div>
            <div data-kz="–û—Å—ã –Ω”©–º—ñ—Ä–≥–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä/”ô–∫—ñ–º—à—ñ —Ö–∞–±–∞—Ä–ª–∞—Å—É—ã –º“Ø–º–∫—ñ–Ω. “ö–æ–ª–∂–µ—Ç—ñ–º–¥—ñ –Ω”©–º—ñ—Ä –∂–∞–∑—ã“£—ã–∑."
                 data-ru="–ù–∞ —ç—Ç–æ—Ç –Ω–æ–º–µ—Ä –º–æ–≥—É—Ç –ø–æ–∑–≤–æ–Ω–∏—Ç—å/–Ω–∞–ø–∏—Å–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏–ª–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä. –£–∫–∞–∑—ã–≤–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–π –Ω–æ–º–µ—Ä.">
              –û—Å—ã –Ω”©–º—ñ—Ä–≥–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä/”ô–∫—ñ–º—à—ñ —Ö–∞–±–∞—Ä–ª–∞—Å—É—ã –º“Ø–º–∫—ñ–Ω. “ö–æ–ª–∂–µ—Ç—ñ–º–¥—ñ –Ω”©–º—ñ—Ä –∂–∞–∑—ã“£—ã–∑.
            </div>
          </div>
        </div>

        <!-- Truck Number -->
        <div class="form-field">
          <label class="field-label" data-kz="–ö”©–ª—ñ–∫ –Ω”©–º—ñ—Ä—ñ" data-ru="–ù–æ–º–µ—Ä –º–∞—à–∏–Ω—ã">–ö”©–ª—ñ–∫ –Ω”©–º—ñ—Ä—ñ</label>
          <input type="text" class="field-input" id="truckNumber" name="truckNumber" required
                 data-placeholder-kz="–ú—ã—Å–∞–ª—ã: 777ABC01" data-placeholder-ru="–ù–∞–ø—Ä–∏–º–µ—Ä: 777ABC01"
                 autocomplete="off" inputmode="text" autocapitalize="characters" spellcheck="false">
          <div class="field-message error" id="truckNumberError"></div>
          <div class="field-message success" id="truckNumberSuccess"></div>
          <div class="field-message pending" id="truckNumberPending"></div>

          <div class="field-note warning">
            <div class="note-ic">‚ö†Ô∏è</div>
            <div data-kz="–ù”©–º—ñ—Ä –Ω–∞“õ—Ç—ã –∫”©–ª—ñ–≥—ñ“£—ñ–∑–¥—ñ–∫—ñ –±–æ–ª—É—ã –∫–µ—Ä–µ–∫. ”ò–∫—ñ–º—à—ñ “õ“±–∂–∞—Ç/—Ñ–æ—Ç–æ –∞—Ä“õ—ã–ª—ã —Ç–µ–∫—Å–µ—Ä–µ–¥—ñ."
                 data-ru="–ù–æ–º–µ—Ä –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤–∞—à–µ–º—É —Ä–µ–∞–ª—å–Ω–æ–º—É –∞–≤—Ç–æ. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º/—Ñ–æ—Ç–æ.">
              –ù”©–º—ñ—Ä –Ω–∞“õ—Ç—ã –∫”©–ª—ñ–≥—ñ“£—ñ–∑–¥—ñ–∫—ñ –±–æ–ª—É—ã –∫–µ—Ä–µ–∫. ”ò–∫—ñ–º—à—ñ “õ“±–∂–∞—Ç/—Ñ–æ—Ç–æ –∞—Ä“õ—ã–ª—ã —Ç–µ–∫—Å–µ—Ä–µ–¥—ñ.
            </div>
          </div>
        </div>
      </div>

      <!-- Truck Type -->
      <div class="form-section">
        <div class="section-title">
          <span class="section-icon">üöö</span>
          <span data-kz="–ö”©–ª—ñ–∫ —Ç“Ø—Ä—ñ" data-ru="–¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞">–ö”©–ª—ñ–∫ —Ç“Ø—Ä—ñ</span>
        </div>

        <div class="section-hint">
          <div class="hint-dot">üöõ</div>
          <div data-kz="–ö”©–ª—ñ–≥—ñ“£—ñ–∑–≥–µ —Å”ô–π–∫–µ—Å —Ç“Ø—Ä—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑. “ö–∞—Ç–µ —Ç–∞“£–¥–∞—É ‚Äî —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä–¥—ã“£ –¥“±—Ä—ã—Å –∫–µ–ª–º–µ—É—ñ–Ω–µ ”ô–∫–µ–ª–µ–¥—ñ."
               data-ru="–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –≤–∞—à–µ–º—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É. –û—à–∏–±–∫–∞ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –∑–∞–∫–∞–∑–∞–º.">
            –ö”©–ª—ñ–≥—ñ“£—ñ–∑–≥–µ —Å”ô–π–∫–µ—Å —Ç“Ø—Ä—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑. “ö–∞—Ç–µ —Ç–∞“£–¥–∞—É ‚Äî —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä–¥—ã“£ –¥“±—Ä—ã—Å –∫–µ–ª–º–µ—É—ñ–Ω–µ ”ô–∫–µ–ª–µ–¥—ñ.
          </div>
        </div>

        <div class="truck-grid">
          <div class="truck-card" data-truck="intercity" onclick="selectTruck('intercity')">
            <div class="truck-icon">üöï</div>
            <div class="truck-name" data-kz="“ö–∞–ª–∞ –∞—Ä–∞–ª—ã“õ" data-ru="–ú–µ–∂–≥–æ—Ä–æ–¥">“ö–∞–ª–∞ –∞—Ä–∞–ª—ã“õ</div>
            <div class="truck-desc" data-kz="—Ç–∞–∫—Å–∏" data-ru="—Ç–∞–∫—Å–∏">—Ç–∞–∫—Å–∏</div>
          </div>
          <div class="truck-card" data-truck="small" onclick="selectTruck('small')">
            <div class="truck-icon">üöê</div>
            <div class="truck-name" data-kz="–ö—ñ—à—ñ" data-ru="–ú–∞–ª—ã–π">–ö—ñ—à—ñ</div>
            <div class="truck-desc" data-kz="1.5—Ç –¥–µ–π—ñ–Ω" data-ru="–¥–æ 1.5—Ç">1.5—Ç –¥–µ–π—ñ–Ω</div>
          </div>
          <div class="truck-card" data-truck="medium" onclick="selectTruck('medium')">
            <div class="truck-icon">üöö</div>
            <div class="truck-name" data-kz="–û—Ä—Ç–∞—à–∞" data-ru="–°—Ä–µ–¥–Ω–∏–π">–û—Ä—Ç–∞—à–∞</div>
            <div class="truck-desc" data-kz="5—Ç –¥–µ–π—ñ–Ω" data-ru="–¥–æ 5—Ç">5—Ç –¥–µ–π—ñ–Ω</div>
          </div>
          <div class="truck-card" data-truck="large" onclick="selectTruck('large')">
            <div class="truck-icon">üöõ</div>
            <div class="truck-name" data-kz="“Æ–ª–∫–µ–Ω" data-ru="–ë–æ–ª—å—à–æ–π">“Æ–ª–∫–µ–Ω</div>
            <div class="truck-desc" data-kz="20—Ç –¥–µ–π—ñ–Ω" data-ru="–¥–æ 20—Ç">20—Ç –¥–µ–π—ñ–Ω</div>
          </div>
          <div class="truck-card" data-truck="tow" onclick="selectTruck('tow')">
            <div class="truck-icon">üîß</div>
            <div class="truck-name" data-kz="–≠–≤–∞–∫—É–∞—Ç–æ—Ä" data-ru="–≠–≤–∞–∫—É–∞—Ç–æ—Ä">–≠–≤–∞–∫—É–∞—Ç–æ—Ä</div>
            <div class="truck-desc" data-kz="—ç–≤–∞–∫—É–∞—Ü–∏—è" data-ru="—ç–≤–∞–∫—É–∞—Ü–∏—è">—ç–≤–∞–∫—É–∞—Ü–∏—è</div>
          </div>
          <div class="truck-card" data-truck="any" onclick="selectTruck('any')">
            <div class="truck-icon">üöô</div>
            <div class="truck-name" data-kz="–ö–µ–∑ –∫–µ–ª–≥–µ–Ω" data-ru="–õ—é–±–æ–π">–ö–µ–∑ –∫–µ–ª–≥–µ–Ω</div>
            <div class="truck-desc" data-kz="–∂–∞—Ä–∞–π–¥—ã" data-ru="–ø–æ–¥–æ–π–¥–µ—Ç">–∂–∞—Ä–∞–π–¥—ã</div>
          </div>
        </div>
        <input type="hidden" id="truckType" name="truckType" required>
        <div class="field-message error" id="truckTypeError"></div>
      </div>

      <!-- Documents -->
      <div class="form-section">
        <div class="section-title">
          <span class="section-icon">üìÑ</span>
          <span data-kz="“ö“±–∂–∞—Ç—Ç–∞—Ä" data-ru="–î–æ–∫—É–º–µ–Ω—Ç—ã">“ö“±–∂–∞—Ç—Ç–∞—Ä</span>
        </div>

        <div class="section-hint">
          <div class="hint-dot">üõ°Ô∏è</div>
          <div data-kz="“ö“±–∂–∞—Ç—Ç–∞—Ä –∞–Ω—ã“õ, —Ç–æ–ª—ã“õ –∫”©—Ä—ñ–Ω—Å—ñ–Ω. –ë“±–ª—ã“£“ì—ã—Ä/–∫–µ—Å—ñ–ª–≥–µ–Ω —Ñ–æ—Ç–æ ‚Äî “õ–∞–π—Ç–∞ –∂“Ø–∫—Ç–µ—É–¥—ñ —Ç–∞–ª–∞–ø –µ—Ç–µ–¥—ñ."
               data-ru="–î–æ–∫—É–º–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–µ—Ç–∫–∏–º–∏ –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–∏–¥–Ω—ã. –†–∞–∑–º—ã—Ç–æ/–æ–±—Ä–µ–∑–∞–Ω–æ ‚Äî –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞.">
            “ö“±–∂–∞—Ç—Ç–∞—Ä –∞–Ω—ã“õ, —Ç–æ–ª—ã“õ –∫”©—Ä—ñ–Ω—Å—ñ–Ω. –ë“±–ª—ã“£“ì—ã—Ä/–∫–µ—Å—ñ–ª–≥–µ–Ω —Ñ–æ—Ç–æ ‚Äî “õ–∞–π—Ç–∞ –∂“Ø–∫—Ç–µ—É–¥—ñ —Ç–∞–ª–∞–ø –µ—Ç–µ–¥—ñ.
          </div>
        </div>

        <div class="form-field">
          <label class="field-label" data-kz="–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –∫—É”ô–ª—ñ–≥—ñ (–∞–ª–¥—ã“£“ì—ã –∂–∞“ì—ã)" data-ru="–ü—Ä–∞–≤–∞ (–ª–∏—Ü–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞)">–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –∫—É”ô–ª—ñ–≥—ñ (–∞–ª–¥—ã“£“ì—ã –∂–∞“ì—ã)</label>
          <div class="file-field" id="licenseFrontField" onclick="document.getElementById('licenseFront').click()">
            <div class="file-icon">üìã</div>
            <div class="file-text" data-kz="“ö“±–∂–∞—Ç—Ç—ã –∂“Ø–∫—Ç–µ—É (–º–∞–∫—Å. 10MB)" data-ru="–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç (–º–∞–∫—Å. 10MB)">“ö“±–∂–∞—Ç—Ç—ã –∂“Ø–∫—Ç–µ—É (–º–∞–∫—Å. 10MB)</div>
          </div>
          <input type="file" id="licenseFront" name="licenseFront" class="file-input" accept="image/*,.pdf" required>
          <div class="field-message error" id="licenseFrontError"></div>

          <div class="field-note warning">
            <div class="note-ic">‚ö†Ô∏è</div>
            <div data-kz="–¢“Ø–ø–Ω“±—Å“õ–∞ “õ“±–∂–∞—Ç –∂“Ø–∫—Ç–µ“£—ñ–∑. –°–∫—Ä–∏–Ω/”©“£–¥–µ–ª–≥–µ–Ω —Ñ–∞–π–ª “õ–∞–±—ã–ª–¥–∞–Ω–±–∞—É—ã –º“Ø–º–∫—ñ–Ω."
                 data-ru="–ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç. –°–∫—Ä–∏–Ω/–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω.">
              –¢“Ø–ø–Ω“±—Å“õ–∞ “õ“±–∂–∞—Ç –∂“Ø–∫—Ç–µ“£—ñ–∑. –°–∫—Ä–∏–Ω/”©“£–¥–µ–ª–≥–µ–Ω —Ñ–∞–π–ª “õ–∞–±—ã–ª–¥–∞–Ω–±–∞—É—ã –º“Ø–º–∫—ñ–Ω.
            </div>
          </div>
        </div>

        <div class="form-field">
          <label class="field-label" data-kz="–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –∫—É”ô–ª—ñ–≥—ñ (–∞—Ä—Ç“õ—ã –∂–∞“ì—ã)" data-ru="–ü—Ä–∞–≤–∞ (–æ–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞)">–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ –∫—É”ô–ª—ñ–≥—ñ (–∞—Ä—Ç“õ—ã –∂–∞“ì—ã)</label>
          <div class="file-field" id="licenseBackField" onclick="document.getElementById('licenseBack').click()">
            <div class="file-icon">üìã</div>
            <div class="file-text" data-kz="“ö“±–∂–∞—Ç—Ç—ã –∂“Ø–∫—Ç–µ—É (–º–∞–∫—Å. 10MB)" data-ru="–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç (–º–∞–∫—Å. 10MB)">“ö“±–∂–∞—Ç—Ç—ã –∂“Ø–∫—Ç–µ—É (–º–∞–∫—Å. 10MB)</div>
          </div>
          <input type="file" id="licenseBack" name="licenseBack" class="file-input" accept="image/*,.pdf" required>
          <div class="field-message error" id="licenseBackError"></div>

          <div class="field-note">
            <div class="note-ic">üîé</div>
            <div data-kz="–ë–∞—Ä–ª—ã“õ –∂–∞–∑—É –æ“õ—ã–ª–∞—Ç—ã–Ω –±–æ–ª—Å—ã–Ω: –Ω”©–º—ñ—Ä—ñ, –º–µ—Ä–∑—ñ–º—ñ, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–ª–∞—Ä—ã."
                 data-ru="–í—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —á–∏—Ç–∞—Ç—å—Å—è: –Ω–æ–º–µ—Ä, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.">
              –ë–∞—Ä–ª—ã“õ –∂–∞–∑—É –æ“õ—ã–ª–∞—Ç—ã–Ω –±–æ–ª—Å—ã–Ω: –Ω”©–º—ñ—Ä—ñ, –º–µ—Ä–∑—ñ–º—ñ, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–ª–∞—Ä—ã.
            </div>
          </div>
        </div>
      </div>

      <!-- Location -->
      <div class="form-section">
        <div class="section-title">
          <span class="section-icon">üìç</span>
          <span data-kz="–ñ“±–º—ã—Å “õ–∞–ª–∞—Å—ã" data-ru="–ì–æ—Ä–æ–¥ —Ä–∞–±–æ—Ç—ã">–ñ“±–º—ã—Å “õ–∞–ª–∞—Å—ã</span>
        </div>

        <div class="section-hint">
          <div class="hint-dot">üìå</div>
          <div data-kz="–î“±—Ä—ã—Å “õ–∞–ª–∞ —Ç–∞“£–¥–∞“£—ã–∑ ‚Äî —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä —Å–æ–ª –∞–π–º–∞“õ –±–æ–π—ã–Ω—à–∞ –∫–µ–ª–µ–¥—ñ. ”ò–∫—ñ–º—à—ñ —Ç–µ–∫—Å–µ—Ä–µ –∞–ª–∞–¥—ã."
               data-ru="–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≥–æ—Ä–æ–¥ ‚Äî –∑–∞–∫–∞–∑—ã –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –ø–æ —ç—Ç–æ–º—É —Ä–µ–≥–∏–æ–Ω—É. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å.">
            –î“±—Ä—ã—Å “õ–∞–ª–∞ —Ç–∞“£–¥–∞“£—ã–∑ ‚Äî —Ç–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä —Å–æ–ª –∞–π–º–∞“õ –±–æ–π—ã–Ω—à–∞ –∫–µ–ª–µ–¥—ñ. ”ò–∫—ñ–º—à—ñ —Ç–µ–∫—Å–µ—Ä–µ –∞–ª–∞–¥—ã.
          </div>
        </div>

        <div class="form-field">
          <label class="field-label" data-kz="“ö–∞–ª–∞" data-ru="–ì–æ—Ä–æ–¥">“ö–∞–ª–∞</label>
          <div class="location-group">
            <input type="text" class="field-input location-input" id="startCity" name="startCity" required
                   data-placeholder-kz="“ö–∞–ª–∞–Ω—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑" data-placeholder-ru="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥">
            <button type="button" class="gps-btn" id="gpsBtn"
                    data-title-kz="–û—Ä–Ω–∞–ª–∞—Å“õ–∞–Ω –∂–µ—Ä–¥—ñ –∞–Ω—ã“õ—Ç–∞—É"
                    data-title-ru="–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ">üìç</button>
          </div>
          <div class="field-message error" id="startCityError"></div>
          <div class="field-message success" id="startCitySuccess"></div>

          <div class="field-note">
            <div class="note-ic">üõ∞Ô∏è</div>
            <div data-kz="GPS –∞—Ä“õ—ã–ª—ã –∞–≤—Ç–æ–º–∞—Ç—Ç—ã –∞–Ω—ã“õ—Ç–∞—É“ì–∞ –±–æ–ª–∞–¥—ã (—Ä“±“õ—Å–∞—Ç –±–µ—Ä—ñ“£—ñ–∑)."
                 data-ru="–ú–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ GPS (—Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø).">
              GPS –∞—Ä“õ—ã–ª—ã –∞–≤—Ç–æ–º–∞—Ç—Ç—ã –∞–Ω—ã“õ—Ç–∞—É“ì–∞ –±–æ–ª–∞–¥—ã (—Ä“±“õ—Å–∞—Ç –±–µ—Ä—ñ“£—ñ–∑).
            </div>
          </div>
        </div>
      </div>

      <!-- Submit Info -->
      <div class="submit-info">
        <div class="submit-info-icon">‚úÖ</div>
        <div class="submit-info-text"
             data-kz="–ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä“ì–∞–Ω–Ω–∞–Ω –∫–µ–π—ñ–Ω, —Ç”©–º–µ–Ω–¥–µ–≥—ñ –±–∞—Ç—ã—Ä–º–∞–Ω—ã –±–∞—Å—ã“£—ã–∑. ”ò–∫—ñ–º—à—ñ —Ç–µ–∫—Å–µ—Ä–≥–µ–Ω–Ω–µ–Ω —Å–æ“£ “ì–∞–Ω–∞ –∂“Ø–π–µ–≥–µ “õ–æ—Å—ã–ª–∞—Å—ã–∑."
             data-ru="–ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ. –î–æ—Å—Ç—É–ø –ø–æ—è–≤–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.">
          –ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä“ì–∞–Ω–Ω–∞–Ω –∫–µ–π—ñ–Ω, —Ç”©–º–µ–Ω–¥–µ–≥—ñ –±–∞—Ç—ã—Ä–º–∞–Ω—ã –±–∞—Å—ã“£—ã–∑. ”ò–∫—ñ–º—à—ñ —Ç–µ–∫—Å–µ—Ä–≥–µ–Ω–Ω–µ–Ω —Å–æ“£ “ì–∞–Ω–∞ –∂“Ø–π–µ–≥–µ “õ–æ—Å—ã–ª–∞—Å—ã–∑.
        </div>

        <div class="gps-final-note">
          <div class="ic">üõ∞Ô∏è</div>
          <div>
            <div class="t1" data-kz="GPS –†“∞“ö–°–ê–¢" data-ru="–î–û–°–¢–£–ü GPS">GPS –†“∞“ö–°–ê–¢</div>
            <div class="t2"
              data-kz="–¢–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä–¥—ã –¥”ô–ª –±–µ—Ä—É “Ø—à—ñ–Ω “õ“±—Ä—ã–ª“ì—ã“£—ã–∑–¥–∞–Ω GPS-–∫–µ —Ç–æ–ª—ã“õ “õ–æ–ª–∂–µ—Ç—ñ–º–¥—ñ–ª—ñ–∫ –±–µ—Ä—ñ“£—ñ–∑. GPS “õ–æ—Å—É–ª—ã –±–æ–ª–º–∞—Å–∞, ”©—Ç—ñ–Ω—ñ–º—ñ“£—ñ–∑ –∫–µ—à—ñ–≥—É—ñ –º“Ø–º–∫—ñ–Ω."
              data-ru="–ß—Ç–æ–±—ã —Ç–æ—á–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –∑–∞–∫–∞–∑—ã, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ GPS –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ. –ï—Å–ª–∏ GPS –≤—ã–∫–ª—é—á–µ–Ω, –∑–∞—è–≤–∫–∞ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –¥–æ–ª—å—à–µ.">
              –¢–∞–ø—Å—ã—Ä—ã—Å—Ç–∞—Ä–¥—ã –¥”ô–ª –±–µ—Ä—É “Ø—à—ñ–Ω “õ“±—Ä—ã–ª“ì—ã“£—ã–∑–¥–∞–Ω GPS-–∫–µ —Ç–æ–ª—ã“õ “õ–æ–ª–∂–µ—Ç—ñ–º–¥—ñ–ª—ñ–∫ –±–µ—Ä—ñ“£—ñ–∑. GPS “õ–æ—Å—É–ª—ã –±–æ–ª–º–∞—Å–∞, ”©—Ç—ñ–Ω—ñ–º—ñ“£—ñ–∑ –∫–µ—à—ñ–≥—É—ñ –º“Ø–º–∫—ñ–Ω.
            </div>
          </div>
        </div>
      </div>

      <!-- Hidden fields -->
      <input type="hidden" id="latitude" name="latitude">
      <input type="hidden" id="longitude" name="longitude">
      <input type="hidden" id="telegramId" name="telegramId">
      <input type="hidden" id="tgUsernameHidden" name="tgUsername">
      <input type="hidden" id="tgPhotoUrlHidden" name="tgPhotoUrl">
    </form>
  </div>

  <script>
    // Global state
    let currentLang = 'kz';
    let selectedTruckType = null;

    // Truck number availability state
    let truckNumberState = {
      lastChecked: '',
      available: false,
      checking: false
    };

    // 10MB limit (requested)
    const MAX_FILE_BYTES = 10 * 1024 * 1024;

    document.addEventListener('DOMContentLoaded', function() {
      initLanguage();
      initializeTelegram();
      setupEventListeners();
      updateProgress();
    });

    function initLanguage() {
      const urlParams = new URLSearchParams(window.location.search);
      const lang = urlParams.get('lang');
      if (lang === 'kz' || lang === 'ru') currentLang = lang;
      applyTranslations();
    }

    function applyTranslations() {
      document.querySelectorAll('[data-kz]').forEach(el => {
        const text = el.getAttribute('data-' + currentLang);
        if (text) {
          if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.placeholder = text;
          else el.textContent = text;
        }
      });

      document.querySelectorAll('[data-placeholder-kz]').forEach(el => {
        const text = el.getAttribute('data-placeholder-' + currentLang);
        if (text && (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA')) el.placeholder = text;
      });

      const gpsBtn = document.getElementById('gpsBtn');
      if (gpsBtn) {
        const t = gpsBtn.getAttribute('data-title-' + currentLang);
        if (t) gpsBtn.title = t;
      }
    }

    function applyTheme(isDark) {
      document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
    }

    function initializeTelegram() {
      if (!window.Telegram || !Telegram.WebApp) return;

      const tg = Telegram.WebApp;
      tg.ready();
      tg.expand();
      tg.enableClosingConfirmation();
      tg.disableVerticalSwipes();

      const updateHeight = () => {
        const vh = tg.viewportStableHeight || window.innerHeight;
        document.documentElement.style.setProperty('--tg-viewport-stable-height', vh + 'px');
        document.documentElement.style.setProperty('--tg-safe-top', (tg.safeAreaInset?.top || 0) + 'px');
        document.documentElement.style.setProperty('--tg-safe-bottom', (tg.safeAreaInset?.bottom || 0) + 'px');
      };
      updateHeight();
      tg.onEvent('viewportChanged', updateHeight);

      const user = tg.initDataUnsafe?.user;
      if (user) {
        document.getElementById('telegramId').value = user.id;

        // header username
        const uEl = document.getElementById('tgUsername');
        const uname = user.username ? '@' + user.username : (user.first_name || 'Telegram user');
        uEl.textContent = uname;

        // hidden
        document.getElementById('tgUsernameHidden').value = user.username ? user.username : '';
        document.getElementById('tgPhotoUrlHidden').value = user.photo_url ? user.photo_url : '';

        // header avatar
        const avatarWrap = document.getElementById('tgAvatar');
        const avatarImg = document.getElementById('tgAvatarImg');

        if (user.photo_url) {
          avatarImg.src = user.photo_url;
          avatarImg.onload = () => {
            avatarImg.style.display = 'block';
            avatarWrap.classList.remove('fallback');
            avatarWrap.textContent = '';
            avatarWrap.appendChild(avatarImg);
          };
          avatarImg.onerror = () => {
            avatarImg.style.display = 'none';
            avatarWrap.classList.add('fallback');
            avatarWrap.textContent = 'üë§';
          };
        } else {
          avatarImg.style.display = 'none';
          avatarWrap.classList.add('fallback');
          avatarWrap.textContent = 'üë§';
        }
      }

      applyTheme(tg.colorScheme === 'dark');
      tg.onEvent('themeChanged', () => applyTheme(tg.colorScheme === 'dark'));

      tg.MainButton.hide();
    }

    function setupEventListeners() {
      const form = document.getElementById('driverForm');
      const inputs = form.querySelectorAll('input[required]');

      inputs.forEach(input => {
        input.addEventListener('blur', () => validateField(input));
        input.addEventListener('input', () => updateProgress());
      });

      document.getElementById('profilePhoto').addEventListener('change', handlePhotoChange);
      document.getElementById('licenseFront').addEventListener('change', (e) => handleFileChange(e, 'licenseFrontField'));
      document.getElementById('licenseBack').addEventListener('change', (e) => handleFileChange(e, 'licenseBackField'));

      // PHONE MASK FIX: cursor inside parentheses, no "jump"
      setupPhoneMask(document.getElementById('contactNumber'));

      document.getElementById('gpsBtn').addEventListener('click', getCurrentLocation);

      const truckNumberInput = document.getElementById('truckNumber');
      truckNumberInput.addEventListener('input', () => {
        normalizeTruckNumber(truckNumberInput);
        scheduleTruckNumberCheck(truckNumberInput.value);
      });
      truckNumberInput.addEventListener('blur', () => {
        normalizeTruckNumber(truckNumberInput);
        scheduleTruckNumberCheck(truckNumberInput.value, true);
      });
    }

    function selectTruck(type) {
      selectedTruckType = type;
      document.getElementById('truckType').value = type;

      document.querySelectorAll('.truck-card').forEach(card => card.classList.remove('selected'));
      document.querySelector(`[data-truck="${type}"]`).classList.add('selected');

      const err = document.getElementById('truckTypeError');
      if (err) err.style.display = 'none';
      updateProgress();
    }

    function handlePhotoChange(e) {
      const file = e.target.files[0];
      if (file) {
        if (file.size > MAX_FILE_BYTES) {
          showError('profilePhotoError', currentLang === 'kz' ? '–§–∞–π–ª —Ç—ã–º “Ø–ª–∫–µ–Ω (–º–∞–∫—Å. 10MB)' : '–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 10MB)');
          e.target.value = '';
          return;
        }

        const reader = new FileReader();
        reader.onload = function(ev) {
          document.getElementById('photoPreview').innerHTML = `<img src="${ev.target.result}" alt="Profile">`;
          document.getElementById('photoPreview').classList.add('has-photo');
        };
        reader.readAsDataURL(file);

        validateField(e.target);
        updateProgress();
      }
    }

    function handleFileChange(e, fieldId) {
      const file = e.target.files[0];
      const field = document.getElementById(fieldId);

      if (file) {
        if (file.size > MAX_FILE_BYTES) {
          const errorId = e.target.id + 'Error';
          showError(errorId, currentLang === 'kz' ? '–§–∞–π–ª —Ç—ã–º “Ø–ª–∫–µ–Ω (–º–∞–∫—Å. 10MB)' : '–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 10MB)');
          e.target.value = '';
          return;
        }

        field.classList.add('has-file');
        field.querySelector('.file-text').textContent = file.name;
        field.querySelector('.file-icon').textContent = '‚úÖ';

        validateField(e.target);
        updateProgress();
      }
    }

    /* =========================
       PHONE MASK (FIXED CARET)
       +7 (___) ___-__-__
       - caret can go inside ()
       - no jumping after '('
    ========================= */
    function setupPhoneMask(input) {
      if (!input) return;

      const template = '+7 (___) ___-__-__';

      function onlyDigits(s) { return (s || '').replace(/\D/g, ''); }

      function build(digits) {
        // digits may include starting 7 or 8
        let d = digits;
        if (d.startsWith('8')) d = '7' + d.slice(1);
        if (!d.startsWith('7')) d = '7' + d;

        // we need 11 digits total: 7 + 10
        d = d.slice(0, 11);

        const a = d.slice(1, 4);
        const b = d.slice(4, 7);
        const c = d.slice(7, 9);
        const e = d.slice(9, 11);

        let out = '+7 (';
        out += (a + '___').slice(0, 3);
        out += ') ';
        out += (b + '___').slice(0, 3);
        out += '-';
        out += (c + '__').slice(0, 2);
        out += '-';
        out += (e + '__').slice(0, 2);
        return out;
      }

      function mapCaret(masked, caretPos) {
        // Move caret to nearest "_" on the right, or keep within allowed zone
        const first = masked.indexOf('_');
        if (first === -1) return masked.length;

        // if caret is before first editable slot, snap to first editable
        if (caretPos < first) return first;

        // if caret is on a non-editable char, snap to nearest editable to right, else keep
        if (masked[caretPos] && masked[caretPos] !== '_' && /\D/.test(masked[caretPos])) {
          const next = masked.indexOf('_', caretPos);
          if (next !== -1) return next;
        }
        return caretPos;
      }

      function setValWithCaret(newVal, caret) {
        input.value = newVal;
        requestAnimationFrame(() => {
          input.setSelectionRange(caret, caret);
        });
      }

      input.addEventListener('focus', () => {
        if (!input.value) {
          const v = build('7');
          setValWithCaret(v, v.indexOf('_'));
        } else {
          // ensure mask format
          const digits = onlyDigits(input.value);
          const v = build(digits);
          const c = mapCaret(v, input.selectionStart || v.indexOf('_'));
          setValWithCaret(v, c);
        }
      });

      input.addEventListener('keydown', (e) => {
        const pos = input.selectionStart || 0;

        // prevent deleting fixed prefix "+7 ("
        const fixedMin = 4; // "+7 (". length = 4
        if ((e.key === 'Backspace' || e.key === 'Delete') && pos <= fixedMin) {
          e.preventDefault();
          return;
        }
      });

      input.addEventListener('input', () => {
        const caretBefore = input.selectionStart || 0;
        const digits = onlyDigits(input.value);
        const v = build(digits);
        const c = mapCaret(v, caretBefore);
        setValWithCaret(v, c);
        validateField(input);
        updateProgress();
      });

      input.addEventListener('click', () => {
        const v = input.value || template;
        if (!input.value) {
          setValWithCaret(build('7'), build('7').indexOf('_'));
          return;
        }
        const pos = input.selectionStart || 0;
        const c = mapCaret(v, pos);
        if (c !== pos) requestAnimationFrame(() => input.setSelectionRange(c, c));
      });

      input.addEventListener('blur', () => {
        // if user didn't fill anything (only +7), clear
        const digits = onlyDigits(input.value);
        if (digits === '7') input.value = '';
        validateField(input);
      });
    }

    function normalizeTruckNumber(inputEl) {
      let v = (inputEl.value || '').toUpperCase();
      v = v.replace(/\s+/g, '');
      inputEl.value = v;
    }

    let truckNumberTimer = null;
    function scheduleTruckNumberCheck(value, immediate = false) {
      const tn = (value || '').toUpperCase().replace(/\s+/g, '');

      if (!tn) {
        truckNumberState = { lastChecked: '', available: false, checking: false };
        clearTruckNumberMessages();
        setTruckNumberVisualState(null);
        updateProgress();
        return;
      }

      if (tn.length < 5 || tn.length > 15) {
        truckNumberState = { lastChecked: '', available: false, checking: false };
        showTruckNumberError(currentLang === 'kz' ? '–ù”©–º—ñ—Ä —Ñ–æ—Ä–º–∞—Ç—ã –¥“±—Ä—ã—Å –µ–º–µ—Å' : '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞');
        updateProgress();
        return;
      }

      if (truckNumberTimer) clearTimeout(truckNumberTimer);
      truckNumberTimer = setTimeout(() => {
        checkTruckNumberServer(tn);
      }, immediate ? 0 : 450);
    }

    async function checkTruckNumberServer(tn) {
      if (truckNumberState.checking && truckNumberState.lastChecked === tn) return;
      if (truckNumberState.lastChecked === tn && (truckNumberState.available === true || truckNumberState.available === false)) {
        updateProgress();
        return;
      }

      truckNumberState.checking = true;
      truckNumberState.lastChecked = tn;
      clearTruckNumberMessages();
      showTruckNumberPending(currentLang === 'kz' ? '–¢–µ–∫—Å–µ—Ä—ñ–ª—É–¥–µ...' : '–ü—Ä–æ–≤–µ—Ä–∫–∞...');

      const input = document.getElementById('truckNumber');
      input.classList.remove('error', 'success');
      input.classList.add('pending');

      try {
        const res = await fetch('/api/driver/truck-number/check', {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ truck_number: tn })
        });

        const data = await res.json().catch(() => ({}));
        truckNumberState.checking = false;

        if (!res.ok || !data || data.success !== true) {
          truckNumberState.available = false;
          showTruckNumberError(currentLang === 'kz' ? '–°–µ—Ä–≤–µ—Ä “õ–∞—Ç–µ—Å—ñ' : '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
          updateProgress();
          return;
        }

        if (data.available) {
          truckNumberState.available = true;
          showTruckNumberSuccess(currentLang === 'kz' ? '–ù”©–º—ñ—Ä –±–æ—Å' : '–ù–æ–º–µ—Ä —Å–≤–æ–±–æ–¥–µ–Ω');
        } else {
          truckNumberState.available = false;
          showTruckNumberError(data.message || (currentLang === 'kz' ? '–ù”©–º—ñ—Ä –±–æ—Å –µ–º–µ—Å' : '–ù–æ–º–µ—Ä –∑–∞–Ω—è—Ç'));
        }

        updateProgress();
      } catch (e) {
        truckNumberState.checking = false;
        truckNumberState.available = false;
        showTruckNumberError(currentLang === 'kz' ? '–ñ–µ–ª—ñ “õ–∞—Ç–µ—Å—ñ' : '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
        updateProgress();
      }
    }

    function clearTruckNumberMessages() {
      const e = document.getElementById('truckNumberError');
      const s = document.getElementById('truckNumberSuccess');
      const p = document.getElementById('truckNumberPending');
      if (e) e.style.display = 'none';
      if (s) s.style.display = 'none';
      if (p) p.style.display = 'none';
    }

    function setTruckNumberVisualState(state) {
      const input = document.getElementById('truckNumber');
      input.classList.remove('error', 'success', 'pending');
      if (state === 'error') input.classList.add('error');
      if (state === 'success') input.classList.add('success');
      if (state === 'pending') input.classList.add('pending');
    }

    function showTruckNumberError(msg) {
      clearTruckNumberMessages();
      setTruckNumberVisualState('error');
      const el = document.getElementById('truckNumberError');
      el.textContent = msg;
      el.classList.add('error');
      el.style.display = 'block';
    }

    function showTruckNumberSuccess(msg) {
      clearTruckNumberMessages();
      setTruckNumberVisualState('success');
      const el = document.getElementById('truckNumberSuccess');
      el.textContent = msg;
      el.classList.add('success');
      el.style.display = 'block';
    }

    function showTruckNumberPending(msg) {
      clearTruckNumberMessages();
      setTruckNumberVisualState('pending');
      const el = document.getElementById('truckNumberPending');
      el.textContent = msg;
      el.classList.add('pending');
      el.style.display = 'block';
    }

    function getCurrentLocation() {
      const btn = document.getElementById('gpsBtn');
      const input = document.getElementById('startCity');

      if (!navigator.geolocation) {
        showError('startCityError', currentLang === 'kz' ? '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è “õ–æ–ª–¥–∞—É –∫”©—Ä—Å–µ—Ç—ñ–ª–º–µ–π–¥—ñ' : '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
        return;
      }

      btn.classList.add('loading');
      btn.textContent = '‚è≥';

      navigator.geolocation.getCurrentPosition(
        async function(position) {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;

          try {
            const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&addressdetails=1`);
            const data = await response.json();

            if (data && data.address) {
              const city = data.address.city || data.address.town || data.address.village || data.address.state;
              input.value = city || (data.display_name ? data.display_name.split(',')[0] : '');
              document.getElementById('latitude').value = lat;
              document.getElementById('longitude').value = lon;

              btn.classList.remove('loading');
              btn.classList.add('success');
              btn.textContent = '‚úÖ';

              showSuccess('startCitySuccess', currentLang === 'kz' ? '–û—Ä–Ω–∞–ª–∞—Å“õ–∞–Ω –∂–µ—Ä –∞–Ω—ã“õ—Ç–∞–ª–¥—ã' : '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ');

              setTimeout(() => {
                btn.classList.remove('success');
                btn.textContent = 'üìç';
              }, 2000);

              validateField(input);
              updateProgress();
            }
          } catch (error) {
            console.error('Reverse geocoding error:', error);
            showError('startCityError', currentLang === 'kz' ? '“ö–∞–ª–∞–Ω—ã –∞–Ω—ã“õ—Ç–∞—É–¥–∞ “õ–∞—Ç–µ' : '–û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞');
            btn.classList.remove('loading');
            btn.textContent = 'üìç';
          }
        },
        function(error) {
          console.error('Geolocation error:', error);
          let errorMsg = currentLang === 'kz' ? '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è “õ–∞—Ç–µ—Å—ñ' : '–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏';

          switch(error.code) {
            case error.PERMISSION_DENIED:
              errorMsg = currentLang === 'kz' ? '–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è“ì–∞ –∫—ñ—Ä—É —Ç—ã–π—ã–º —Å–∞–ª—ã–Ω“ì–∞–Ω' : '–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω';
              break;
            case error.POSITION_UNAVAILABLE:
              errorMsg = currentLang === 'kz' ? '–û—Ä–Ω–∞–ª–∞—Å“õ–∞–Ω –∂–µ—Ä “õ–æ–ª–∂–µ—Ç—ñ–º–¥—ñ –µ–º–µ—Å' : '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
              break;
            case error.TIMEOUT:
              errorMsg = currentLang === 'kz' ? '–ö“Ø—Ç—É —É–∞“õ—ã—Ç—ã –∞—è“õ—Ç–∞–ª–¥—ã' : '–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ';
              break;
          }

          showError('startCityError', errorMsg);
          btn.classList.remove('loading');
          btn.textContent = 'üìç';
        },
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    }

    function validateField(field) {
      const value = (field.value || '').trim();
      const fieldId = field.id;
      let isValid = true;
      let errorMsg = '';

      field.classList.remove('error', 'success');
      const errEl = document.getElementById(fieldId + 'Error');
      if (errEl) errEl.style.display = 'none';

      if (field.hasAttribute('required') && !value && field.type !== 'file') {
        isValid = false;
        errorMsg = currentLang === 'kz' ? '–ë“±–ª ”©—Ä—ñ—Å –º—ñ–Ω–¥–µ—Ç—Ç—ñ' : '–≠—Ç–æ –ø–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ';
      }

      if (field.type === 'file' && field.hasAttribute('required')) {
        if (field.files.length === 0) {
          isValid = false;
          errorMsg = currentLang === 'kz' ? '–§–∞–π–ª –º—ñ–Ω–¥–µ—Ç—Ç—ñ' : '–§–∞–π–ª –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω';
        } else {
          const file = field.files[0];
          if (file.size > MAX_FILE_BYTES) {
            isValid = false;
            errorMsg = currentLang === 'kz' ? '–§–∞–π–ª —Ç—ã–º “Ø–ª–∫–µ–Ω (–º–∞–∫—Å. 10MB)' : '–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 10MB)';
          }
        }
      }

      switch (fieldId) {
        case 'firstName':
        case 'lastName':
          if (value && (value.length < 2 || value.length > 50)) {
            isValid = false;
            errorMsg = currentLang === 'kz' ? '2-–¥–µ–Ω 50-–≥–µ –¥–µ–π—ñ–Ω —Å–∏–º–≤–æ–ª' : '–û—Ç 2 –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤';
          }
          break;

        case 'birthday':
          if (value) {
            const birthDate = new Date(value);
            const age = new Date().getFullYear() - birthDate.getFullYear();
            if (age < 18 || age > 80) {
              isValid = false;
              errorMsg = currentLang === 'kz' ? '–ñ–∞—Å—ã 18-–¥–µ–Ω 80-–≥–µ –¥–µ–π—ñ–Ω –±–æ–ª—É—ã –∫–µ—Ä–µ–∫' : '–í–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 18 –¥–æ 80 –ª–µ—Ç';
            }
          }
          break;

        case 'contactNumber':
          // allow partial while typing, strict on submit
          if (value && value.length < 18) {
            isValid = false;
            errorMsg = currentLang === 'kz' ? '–ù”©–º—ñ—Ä–¥—ñ —Ç–æ–ª—ã“õ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑' : '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é';
          } else if (value) {
            const phoneRegex = /^\+7 \(\d{3}\) \d{3}-\d{2}-\d{2}$/;
            if (!phoneRegex.test(value)) {
              isValid = false;
              errorMsg = currentLang === 'kz' ? '–ù”©–º—ñ—Ä —Ñ–æ—Ä–º–∞—Ç—ã –¥“±—Ä—ã—Å –µ–º–µ—Å' : '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞';
            }
          }
          break;

        case 'truckType':
          if (!selectedTruckType) {
            isValid = false;
            errorMsg = currentLang === 'kz' ? '–ö”©–ª—ñ–∫ —Ç“Ø—Ä—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑' : '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞';
          }
          break;

        case 'truckNumber':
          if (value) {
            const v = value.toUpperCase().replace(/\s+/g, '');
            if (v.length < 5 || v.length > 15) {
              isValid = false;
              errorMsg = currentLang === 'kz' ? '–ù”©–º—ñ—Ä —Ñ–æ—Ä–º–∞—Ç—ã –¥“±—Ä—ã—Å –µ–º–µ—Å' : '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞';
            }
          }
          break;
      }

      if (isValid && (value || (field.files && field.files.length > 0))) {
        field.classList.add('success');
      } else if (!isValid) {
        field.classList.add('error');
        if (document.getElementById(fieldId + 'Error')) showError(fieldId + 'Error', errorMsg);
      }

      return isValid;
    }

    function showError(elementId, message) {
      const el = document.getElementById(elementId);
      if (el) {
        el.textContent = message;
        el.classList.add('error');
        el.style.display = 'block';
      }
    }

    function showSuccess(elementId, message) {
      const el = document.getElementById(elementId);
      if (el) {
        el.textContent = message;
        el.classList.add('success');
        el.style.display = 'block';
        setTimeout(() => { el.style.display = 'none'; }, 3000);
      }
    }

    function updateProgress() {
      const form = document.getElementById('driverForm');
      const requiredFields = form.querySelectorAll('input[required]');
      let filledFields = 0;

      requiredFields.forEach(field => {
        if (field.type === 'file') {
          if (field.files.length > 0) filledFields++;
        } else if (field.id === 'truckType') {
          if (selectedTruckType) filledFields++;
        } else if (field.id === 'truckNumber') {
          const v = (field.value || '').trim();
          if (v && truckNumberState.available === true && truckNumberState.checking === false) filledFields++;
        } else if ((field.value || '').trim()) {
          filledFields++;
        }
      });

      const progress = Math.round((filledFields / requiredFields.length) * 100);
      document.getElementById('progressFill').style.width = progress + '%';
      document.getElementById('progressText').textContent = progress + '%';

      if (window.Telegram && Telegram.WebApp) {
        if (progress === 100) {
          const buttonText = currentLang === 'kz' ? '–¢—ñ—Ä–∫–µ–ª—É' : '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è';
          Telegram.WebApp.MainButton.setText(buttonText);
          Telegram.WebApp.MainButton.show();
          Telegram.WebApp.MainButton.offClick(submitForm);
          Telegram.WebApp.MainButton.onClick(submitForm);
        } else {
          Telegram.WebApp.MainButton.hide();
        }
      }
    }

    async function submitForm() {
      const form = document.getElementById('driverForm');

      const tn = (document.getElementById('truckNumber').value || '').toUpperCase().replace(/\s+/g,'');
      if (!tn) {
        showTruckNumberError(currentLang === 'kz' ? '–ë“±–ª ”©—Ä—ñ—Å –º—ñ–Ω–¥–µ—Ç—Ç—ñ' : '–≠—Ç–æ –ø–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ');
        return;
      }
      if (truckNumberState.checking) {
        showTruckNumberPending(currentLang === 'kz' ? '–¢–µ–∫—Å–µ—Ä—ñ–ª—É–¥–µ...' : '–ü—Ä–æ–≤–µ—Ä–∫–∞...');
        return;
      }
      if (!truckNumberState.available) {
        showTruckNumberError(currentLang === 'kz' ? '–ù”©–º—ñ—Ä –±–æ—Å –µ–º–µ—Å' : '–ù–æ–º–µ—Ä –∑–∞–Ω—è—Ç');
        return;
      }

      const telegramId = document.getElementById('telegramId').value;
      if (!telegramId) {
        if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
          document.getElementById('telegramId').value = Telegram.WebApp.initDataUnsafe.user.id;
        } else {
          alert(currentLang === 'kz' ? '“ö–∞—Ç–µ: Telegram –ø–∞–π–¥–∞–ª–∞–Ω—É—à—ã ID –∞–ª—ã–Ω–±–∞–¥—ã' : '–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram');
          return;
        }
      }

      // strict phone check on submit
      const phoneValue = (document.getElementById('contactNumber').value || '').trim();
      const phoneRegex = /^\+7 \(\d{3}\) \d{3}-\d{2}-\d{2}$/;
      if (!phoneRegex.test(phoneValue)) {
        showError('contactNumberError', currentLang === 'kz' ? '–¢–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ–Ω —Ç–æ–ª—ã“õ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑' : '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é');
        return;
      }

      let isFormValid = true;
      const requiredFields = form.querySelectorAll('input[required]');

      requiredFields.forEach(field => {
        if (field.id === 'truckNumber') return;
        if (!validateField(field)) isFormValid = false;
      });

      if (!selectedTruckType) {
        isFormValid = false;
        showError('truckTypeError', currentLang === 'kz' ? '–ö”©–ª—ñ–∫ —Ç“Ø—Ä—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑' : '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞');
      }

      if (!isFormValid) {
        alert(currentLang === 'kz' ? '–ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ –¥“±—Ä—ã—Å —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑' : '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
        return;
      }

      showLoading(currentLang === 'kz' ? '–¢—ñ—Ä–∫–µ–ª—É–¥–µ...' : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...');

      try {
        const formData = new FormData(form);

        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 90000);

        const response = await fetch('/api/driver/register', {
          method: 'POST',
          body: formData,
          signal: controller.signal
        });

        clearTimeout(timeoutId);
        const result = await response.json();

        hideLoading();

        if (response.ok && result.success) {
          const successMsg = currentLang === 'kz'
            ? '–¢—ñ—Ä–∫–µ–ª—É —Å”ô—Ç—Ç—ñ! –†–∞—Å—Ç–∞—É–¥—ã –∫“Ø—Ç—ñ“£—ñ–∑.'
            : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.';

          if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.showAlert(successMsg, () => Telegram.WebApp.close());
          } else {
            alert(successMsg);
          }
        } else {
          throw new Error(result.message || 'Registration failed');
        }
      } catch (error) {
        hideLoading();
        console.error('Registration error:', error);

        let errorMsg;
        if (error.name === 'AbortError') {
          errorMsg = currentLang === 'kz'
            ? '–ñ“Ø–∫—Ç–µ—É —É–∞“õ—ã—Ç—ã –∞—è“õ—Ç–∞–ª–¥—ã. –§–∞–π–ª –∫”©–ª–µ–º—ñ–Ω –∞–∑–∞–π—Ç—ã–ø –∫”©—Ä—ñ“£—ñ–∑.'
            : '–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–µ–∫–ª–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤.';
        } else {
          errorMsg = currentLang === 'kz'
            ? `–¢—ñ—Ä–∫–µ–ª—É “õ–∞—Ç–µ—Å—ñ: ${error.message}`
            : `–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${error.message}`;
        }

        if (window.Telegram && Telegram.WebApp) Telegram.WebApp.showAlert(errorMsg);
        else alert(errorMsg);
      }
    }

    function showLoading(text) {
      document.getElementById('loadingText').textContent = text;
      document.getElementById('loadingOverlay').classList.add('active');
      if (window.Telegram && Telegram.WebApp) Telegram.WebApp.MainButton.showProgress();
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').classList.remove('active');
      if (window.Telegram && Telegram.WebApp) Telegram.WebApp.MainButton.hideProgress();
    }

    window.selectTruck = selectTruck;
  </script>
</body>
</html>
